<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Log Gamma</title>
<link rel="stylesheet" href="../../../../../../../../doc/html/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_2006-12-17_0120">
<link rel="start" href="../../../index.html" title="Math Toolkit">
<link rel="up" href="../sf_gamma.html" title="Gamma Functions">
<link rel="prev" href="tgamma.html" title="Gamma">
<link rel="next" href="digamma.html" title="Digamma">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tgamma.html"><img src="../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../sf_gamma.html"><img src="../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="digamma.html"><img src="../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div><h4 class="title">
<a name="math_toolkit.special.sf_gamma.lgamma"></a><a href="lgamma.html" title="Log Gamma"> Log Gamma</a>
</h4></div></div></div>
<a name="math_toolkit.special.sf_gamma.lgamma.synopsis"></a>
<h5>
<a name="id653810"></a>
          <a href="lgamma.html#math_toolkit.special.sf_gamma.lgamma.synopsis">概要</a>
  </h5>
<p>
          
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">math</span><span class="special">/</span><span class="identifier">special_functions</span><span class="special">/</span><span class="identifier">gamma</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
  </p>
<pre class="programlisting"><span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">{</span> <span class="keyword">namespace</span> <span class="identifier">math</span><span class="special">{</span>

<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span>
<a href="../../main_overview/result_type.html" title="Calculation of the Type of the Result"><span class="emphasis"><em>calculated-result-type</em></span></a> <span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">z</span><span class="special">);</span>

<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">class</span> <a href="../../policy.html" title="Policies">Policy</a><span class="special">&gt;</span>
<a href="../../main_overview/result_type.html" title="Calculation of the Type of the Result"><span class="emphasis"><em>calculated-result-type</em></span></a> <span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">z</span><span class="special">,</span> <span class="keyword">const</span> <a href="../../policy.html" title="Policies">Policy</a><span class="special">&amp;);</span>

<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span>
<a href="../../main_overview/result_type.html" title="Calculation of the Type of the Result"><span class="emphasis"><em>calculated-result-type</em></span></a> <span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">z</span><span class="special">,</span> <span class="keyword">int</span><span class="special">*</span> <span class="identifier">sign</span><span class="special">);</span>

<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">,</span> <span class="keyword">class</span> <a href="../../policy.html" title="Policies">Policy</a><span class="special">&gt;</span>
<a href="../../main_overview/result_type.html" title="Calculation of the Type of the Result"><span class="emphasis"><em>calculated-result-type</em></span></a> <span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">z</span><span class="special">,</span> <span class="keyword">int</span><span class="special">*</span> <span class="identifier">sign</span><span class="special">,</span> <span class="keyword">const</span> <a href="../../policy.html" title="Policies">Policy</a><span class="special">&amp;);</span>

<span class="special">}}</span> <span class="comment">// namespaces
</span></pre>
<a name="math_toolkit.special.sf_gamma.lgamma.description"></a>
<h5>
<a name="id654344"></a>
          <a href="lgamma.html#math_toolkit.special.sf_gamma.lgamma.description">说明</a>
  </h5>
<p>          <a href="http://en.wikipedia.org/wiki/Gamma_function" target="_top">lgamma 函数</a>
          定义如下:
  </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/lgamm1.png"></span>
  </p>
<p>
          这个函数的第二种形式带有一个指向一个整数的指针，如果这个指针不为空，那么它就作为存储tgamma(z)函数符号的输出参数。</p>
<p>
  </p>
<p>
            最后一个<a href="../../policy.html" title="Policies">策略</a> 参数是可选的并且可以用来控制函数的行为: 如何处理错误, 使用哪种层次的精度等等. 参见<a href="../../policy.html" title="Policies">策略文档</a>了解更多信息。</p>
<p>
  </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../graphs/lgamma.png" align="middle"></span>
  </p>
<p>
          在库的内部，这个函数有两个高效的版本：一个完全通用的版本，运行速度慢一些但是更精确一些, 以及一个更高效的使用逼近方法的版本，当T的有效数字的个数与一个特定的 <a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a>对应时。实际上，任何一个你所遇到的内建的浮点类型都有一个适当的<a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a> 定义. 给定足够的运算时间，也有可能使用libs/math/tools/lanczos_generator.cpp产生其它的<a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a> . </p>
<p>
          函数的返回值的类型使用<a href="../../main_overview/result_type.html" title="Calculation of the Type of the Result"><span class="emphasis"><em>函数返回值推导法则</em></span></a> 来确定：如果T是整型，那么结果的类型是double,否则结果的类型是T.
  </p>
<a name="math_toolkit.special.sf_gamma.lgamma.accuracy"></a>
<h5>
<a name="id654546"></a>
          <a href="lgamma.html#math_toolkit.special.sf_gamma.lgamma.accuracy">精确性</a>
  </h5>
<p>
          下面的表显示了输入参数的不同定义域的峰值误差,
          以及与<a href="http://www.gnu.org/software/gsl/" target="_top">GSL-1.9</a> 库和<a href="http://www.netlib.org/cephes/" target="_top">Cephes</a> 库的比较. 注意：在一些平台上使用宽浮点类型来表示窄浮点类型的结果具有<a href="../../backgrounders/relative_error.html#zero_error">有效的零误差</a>. </p>
<p>
          注意：在lgamma函数正根附近的相对误差很小，但是对于负值参数，lgamma函数有无限多个无理根: 在这个负根的附近仅可以保证较低的绝对误差.
  </p>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th width="39">
                <p>有效数字位数
            </p>
          </th>
<th width="66">
                <p>
                  平台和编译器</p>
          </th>
<th width="108">
                <p>
                  阶乘和半阶乘</p>
          </th>
<th width="110">
                <p>
                  接近于0的值</p>
          </th>
<th width="133">
                <p>
                  接近于 1 或 2的值
                </p>
          </th>
<th width="111">
                <p>
                  接近于一个负极点的值</p>
          </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  53
                </p>
          </td>
<td>
                <p>
                  Win32 Visual C++ 8
                </p>
          </td>
<td>
                <p>
                  峰值=0.88 均值=0.14
                </p>
                <p>
                  (GSL=33) (<a href="http://www.netlib.org/cephes/" target="_top">Cephes</a>=1.5)
                </p>
          </td>
<td>
                <p>
                  峰值=0.96 均值=0.46
                </p>
                <p>
                  (GSL=5.2) (<a href="http://www.netlib.org/cephes/" target="_top">Cephes</a>=1.1)
                </p>
          </td>
<td>
                <p>
                  峰值=0.86 均值=0.46
                </p>
                <p>
                  (GSL=1168) (<a href="http://www.netlib.org/cephes/" target="_top">Cephes</a>~500000)
                </p>
          </td>
<td>
                <p>
                  峰值=4.2 均值=1.3
                </p>
                <p>
                  (GSL=25) (<a href="http://www.netlib.org/cephes/" target="_top">Cephes</a>=1.6)
                </p>
          </td>
</tr>
<tr>
<td>
                <p>
                  64
                </p>
          </td>
<td>
                <p>
                  Linux IA32 / GCC
                </p>
          </td>
<td>
                <p>
                  峰值=1.9 均值=0.43
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值=1.7 均值=0.49)
                </p>
          </td>
<td>
                <p>
                  峰值=1.4 均值=0.57
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值= 0.96 均值=0.54)
                </p>
          </td>
<td>
                <p>
                  峰值=0.86 均值=0.35
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值=0.74 均值=0.26)
                </p>
          </td>
<td>
                <p>
                  峰值=6.0 均值=1.8
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值=3.0 均值=0.86)
                </p>
          </td>
</tr>
<tr>
<td>
                <p>
                  64
                </p>
          </td>
<td>
                <p>
                  Linux IA64 / GCC
                </p>
          </td>
<td>
                <p>
                  峰值=0.99 均值=0.12
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值 0)
                </p>
          </td>
<td>
                <p>
                  峰值=1.2 均值=0.6
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值 0)
          </p>          </td>
<td>
                <p>
                  峰值=0.86 均值=0.16
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值 0)
                </p>
          </td>
<td>
                <p>
                  峰值=2.3 均值=0.69
                </p>
                <p>
                  (<a href="http://www.gnu.org/software/libc/" target="_top">GNU C Lib</a>
                  峰值 0)
                </p>
          </td>
</tr>
<tr>
<td>
                <p>
                  113
                </p>
          </td>
<td>
                <p>
                  HPUX IA64, aCC A.06.06
                </p>
          </td>
<td>
                <p>
                  峰值=0.96 均值=0.13
                </p>
                <p>
                  (<a href="http://docs.hp.com/en/B9106-90010/index.html" target="_top">HP-UX
                  C Library</a> 峰值 0)
                </p>
          </td>
<td>
                <p>
                  峰值=0.99 均值=0.53
                </p>
                <p>
                  (<a href="http://docs.hp.com/en/B9106-90010/index.html" target="_top">HP-UX
                  C Library</a> 峰值 0)
                </p>
          </td>
<td>
                <p>
                  峰值=0.9 均值=0.4
                </p>
                <p>
                  (<a href="http://docs.hp.com/en/B9106-90010/index.html" target="_top">HP-UX
                  C Library</a> 峰值 0)
                </p>
          </td>
<td>
                <p>
                  峰值=3.0 均值=0.9
                </p>
                <p>
                  (<a href="http://docs.hp.com/en/B9106-90010/index.html" target="_top">HP-UX
                  C Library</a> 峰值 0)
                </p>
          </td>
</tr>
</tbody>
</table></div>
<a name="math_toolkit.special.sf_gamma.lgamma.testing"></a>
<h5>
<a name="id655069"></a>
          <a href="lgamma.html#math_toolkit.special.sf_gamma.lgamma.testing">测试</a>
  </h5>
<p>
  这些函数的主要测试包含与阶乘的对数的比较，这些阶乘可以独立地计算到非常高的精度。</p>
<p>
          随机测试同样也使用了关键问题域(key problem areas)。</p>
<a name="math_toolkit.special.sf_gamma.lgamma.implementation"></a>
<h5>
<a name="id655105"></a>
          <a href="lgamma.html#math_toolkit.special.sf_gamma.lgamma.implementation">实现</a>
  </h5>
<p>
          通过合并针对于不完全γ函数的级数和连分数来实现这个函数的通用版本:
  </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/lgamm2.png"></span>
  </p>
<p>
          其中<span class="emphasis"><em>l</em></span> 是一个任意的积分限制: 选择<code class="literal">l = max(10, a)</code> 看起来效果很好. 对于负数<span class="emphasis"><em>z</em></span> ，使用对数版本的反射方程： </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/lgamm3.png"></span>
  </p>
<p>
          对于精度已知的类型，使用<a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a>  ，一个 特性类(traits class ) <code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">lanczos</span><span class="special">::</span><span class="identifier">lanczos_traits</span></code>
          用来将类型T与一个合适的逼近方法相关联。对数版本的<a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a>
          是:
  </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/lgamm4.png"></span>
  </p>
<p>
          其中 L<sub>e,g</sub> 是兰克泽斯和, scaled by e<sup>g</sup>.
  </p>
<p>
          与前面一样，当<span class="emphasis"><em>z &lt; 0</em></span>时使用这种方法。</p>
<p>
          当 z非常接近于 1 或 2, 对数版本的<a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a> 产生很大的消去误差:实际上，对于非常接近于1或2的值，可能产生任意大的相对误差(尽管绝对误差很小).
  </p>
<p>
          对于精度高达113bit的类型(超过且包含128bit的long double 类型)，在区间[1,2]和[2,3]上使用由<a href="../../backgrounders/implementation.html#math_toolkit.backgrounders.implementation.rational_approximations_used">JM </a>发明的根保留(root-preserving)有理逼近。超过区间[2,3]时使用的逼近形式如下:
  </p>
<pre class="programlisting"><span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">)</span> <span class="special">=</span> <span class="special">(</span><span class="identifier">z</span><span class="special">-</span><span class="number">2</span><span class="special">)(</span><span class="identifier">z</span><span class="special">+</span><span class="number">1</span><span class="special">)(</span><span class="identifier">Y</span> <span class="special">+</span> <span class="identifier">R</span><span class="special">(</span><span class="identifier">z</span><span class="special">-</span><span class="number">2</span><span class="special">));</span>
</pre>
<p>
  其中 Y 是一个常量,  R(z-2)是有理逼近: 已经经过了优化，使得其绝对误差与Y相比很小.些外，对于大于3的较小的z值可以使用下面的关系来进行参数简化：</p>
<pre class="programlisting"><span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">+</span><span class="number">1</span><span class="special">)</span> <span class="special">=</span> <span class="identifier">log</span><span class="special">(</span><span class="identifier">z</span><span class="special">)</span> <span class="special">+</span> <span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">);</span>
</pre>
<p>
  在 区间[1,2]上，必须使用两个逼近，一个是针对于较小的z值：</p>
<pre class="programlisting"><span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">)</span> <span class="special">=</span> <span class="special">(</span><span class="identifier">z</span><span class="special">-</span><span class="number">1</span><span class="special">)(</span><span class="identifier">z</span><span class="special">-</span><span class="number">2</span><span class="special">)(</span><span class="identifier">Y</span> <span class="special">+</span> <span class="identifier">R</span><span class="special">(</span><span class="identifier">z</span><span class="special">-</span><span class="number">1</span><span class="special">));</span>
</pre>
<p>
  Y是一个常量，R(z-1)针对于与Y相比的绝对误差进行了优化。对于z&gt;1.5 ，上面的形式不会收敛于一个极值解，但是下面的一个类似的形式可以做到这一点：</p>
<pre class="programlisting"><span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">)</span> <span class="special">=</span> <span class="special">(</span><span class="number">2</span><span class="special">-</span><span class="identifier">z</span><span class="special">)(</span><span class="number">1</span><span class="special">-</span><span class="identifier">z</span><span class="special">)(</span><span class="identifier">Y</span> <span class="special">+</span> <span class="identifier">R</span><span class="special">(</span><span class="number">2</span><span class="special">-</span><span class="identifier">z</span><span class="special">));</span>
</pre>
<p>
          最后，对于 z &lt; 1 下面的递推关系可以用来调整到 z &gt;
          1:
  </p>
<pre class="programlisting"><span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">)</span> <span class="special">=</span> <span class="identifier">lgamma</span><span class="special">(</span><span class="identifier">z</span><span class="special">+</span><span class="number">1</span><span class="special">)</span> <span class="special">-</span> <span class="identifier">log</span><span class="special">(</span><span class="identifier">z</span><span class="special">);</span>
</pre>
<p>
          注意：尽管这里涉及到减法运算，但是并没有产生消去误差：当z从开始递减，-log(z)项变为正值的速度比lgamma(z+1)变为负值的速度更快一些。因此，在这个特例中，有效数字是得到保留而不是消去。</p>
<p>
          对于那些有相对应的<a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a> 的类型，当前的解决方案如下：对于虚部，我们通过将幂项除以它在z=l处的值来平衡在          <a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a> 中的两项, 然而我们将兰克泽斯系数乘以相同的值。现在每一项都会在z = l处有1 这个值，且我们可以用过log1p的形式来重组这些幂项。类似地，如果我们从兰克泽斯和中减去1 (在代数上，, 通过在<span class="emphasis"><em>z = 1</em></span>将每一项减去这个值), 我们可以获得一个用于传递给log1p的新值。关键地，所有的这些项都趋向于0 ，因为 <span class="emphasis"><em>z -&gt; 1</em></span>:
  </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/lgamm5.png"></span>
  </p>
<p> 上面表达式中的C<sub>k</sub>项与          <a href="../../backgrounders/lanczos.html" title="The Lanczos Approximation">兰克泽斯逼近</a>中的C<sub>k</sub>项是一样的。</p>
<p>
          可以在<span class="emphasis"><em>z = 2</em></span>处进行类似的重排：:
  </p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/lgamm6.png"></span>
  </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright ?2006 , 2007, 2008 John Maddock, Paul A. Bristow, Hubert
      Holin, Xiaogang Zhang and Bruno Lalande<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tgamma.html"><img src="../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../sf_gamma.html"><img src="../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="digamma.html"><img src="../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
