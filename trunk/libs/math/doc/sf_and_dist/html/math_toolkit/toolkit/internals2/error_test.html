<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Relative Error and Testing</title>
<link rel="stylesheet" href="../../../../../../../../doc/html/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_2006-12-17_0120">
<link rel="start" href="../../../index.html" title="Math Toolkit">
<link rel="up" href="../internals2.html" title="Testing and Development">
<link rel="prev" href="minimax.html" title="Minimax Approximations and the Remez Algorithm">
<link rel="next" href="test_data.html" title="Graphing, Profiling, and Generating Test Data for Special Functions">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../../../../boost.png"></td>
<td align="center"><a href="../../../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="minimax.html"><img src="../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../internals2.html"><img src="../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="test_data.html"><img src="../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div>
  <h4 class="title">
<a name="math_toolkit.toolkit.internals2.error_test"></a><a href="error_test.html" title="Relative Error and Testing"> 相对误差以及测试(Relative
        Error and Testing)</a>
</h4>
</div></div></div>
<a name="math_toolkit.toolkit.internals2.error_test.synopsis"></a>
<h5>
<a name="id797628"></a>
        <a href="error_test.html#math_toolkit.toolkit.internals2.error_test.synopsis">概要</a></h5>
<p>
          
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">math</span><span class="special">/</span><span class="identifier">tools</span><span class="special">/</span><span class="identifier">test</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
  </p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="identifier">T</span> <span class="identifier">relative_error</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">T</span> <span class="identifier">b</span><span class="special">);</span>

<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">A</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">F1</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">F2</span><span class="special">&gt;</span>
<span class="identifier">test_result</span><span class="special">&lt;</span><span class="identifier">see</span><span class="special">-</span><span class="identifier">below</span><span class="special">&gt;</span> <span class="identifier">test</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">A</span><span class="special">&amp;</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">F1</span> <span class="identifier">test_func</span><span class="special">,</span> <span class="identifier">F2</span> <span class="identifier">expect_func</span><span class="special">);</span>
</pre>
<a name="math_toolkit.toolkit.internals2.error_test.description"></a>
<h5>
<a name="id797979"></a>
          <a href="error_test.html#math_toolkit.toolkit.internals2.error_test.description">说明</a>
  </h5>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="identifier">T</span> <span class="identifier">relative_error</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">T</span> <span class="identifier">v</span><span class="special">);</span>
</pre>
<p>
          使用一般的方程来返回<span class="emphasis"><em>a</em></span> 与 <span class="emphasis"><em>v</em></span>
          之间的相对误差：</p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/error1.png"></span>
  </p>
<p>
  除此之外，如果出现下面情况，则返回0：</p>
<div class="itemizedlist"><ul type="disc">
<li>            <span class="emphasis"><em>a</em></span> 和 <span class="emphasis"><em>v</em></span> 都是无限值。 </li>
<li>            <span class="emphasis"><em>a</em></span> 和 <span class="emphasis"><em>v</em></span> 都是 denormalised
            numbers 或者为0。</li>
</ul></div>
<p>
          否则，如果<span class="emphasis"><em>a</em></span> 或 <span class="emphasis"><em>v</em></span>
          之一为0，那么返回 1。</p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">A</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">F1</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">F2</span><span class="special">&gt;</span>
<span class="identifier">test_result</span><span class="special">&lt;</span><span class="identifier">see</span><span class="special">-</span><span class="identifier">below</span><span class="special">&gt;</span> <span class="identifier">test</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">A</span><span class="special">&amp;</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">F1</span> <span class="identifier">test_func</span><span class="special">,</span> <span class="identifier">F2</span> <span class="identifier">expect_func</span><span class="special">);</span>
</pre>
<p>
  这个函数用于使用一个已制成表的测试数据来测试一个函数。</p>
<p>
          返回值类型包含相对误差的统计数据 (最大值，均值，方差，以及测试次数等等)，以及产生最大相对误差的测试数据所在行。类型
          test_result 的公有成员函数为：</p>
<div class="variablelist">
<p class="title"><b></b></p>
<dl>
<dt><span class="term"><code class="computeroutput"><span class="keyword">unsigned</span>
          <span class="identifier">worst</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
            返回最大误差出现的行。</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">T</span>
          <span class="identifier">min</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
              返回最小相对误差。</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">T</span>
          <span class="identifier">max</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
              返回最大相对误差。</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">T</span>
          <span class="identifier">mean</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
              返回平均误差</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">boost</span><span class="special">::</span><span class="identifier">uintmax_t</span>
          <span class="identifier">count</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
              返回测试次数</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">T</span>
          <span class="identifier">variance</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
              返回误差的方差</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">T</span>
          <span class="identifier">variance1</span><span class="special">()</span><span class="keyword">const</span><span class="special">;</span></code></span></dt>
<dd>
  <p>
            返回误差的无偏方差(unbiased variance)。</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">T</span>
          <span class="identifier">rms</span><span class="special">()</span><span class="keyword">const</span></code></span></dt>
<dd>
  <p>
            返回均方根( Root Mean Square)，或者误差的二次平均( quadratic mean )。</p>
</dd>
<dt><span class="term"><code class="computeroutput"><span class="identifier">test_result</span><span class="special">&amp;</span> <span class="keyword">operator</span><span class="special">+=(</span><span class="keyword">const</span> <span class="identifier">test_result</span><span class="special">&amp;</span>
          <span class="identifier">t</span><span class="special">)</span></code></span></dt>
<dd>
  <p>
              将两个 test_result合并为一个测试结果。</p>
</dd>
</dl>
</div>
<p>
          test_result的模板参数与传递给函数<span class="emphasis"><em>test</em></span>的二维数组的类型是一样的，,粗略地说就是<code class="computeroutput"><span class="identifier">A</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">::</span><span class="identifier">value_type</span></code>.
  </p>
<p>
  参数<span class="emphasis"><em>a</em></span> 是测试数据的一个矩阵：并且必须为标准库的序列类型，包含另外一个序列类型：典型情况下是一个二维的<code class="literal">boost::array</code>实例。矩阵<span class="emphasis"><em>a</em></span> 的每一行应当包含所有的传递给正在测试的函数的所有参数以及预期的结果。</p>
<p>          参数<span class="emphasis"><em>test_func</em></span> 是正在进行测试的函数，对矩阵<span class="emphasis"><em>a</em></span>中的每行数据调用这个函数。典型情况下，类型 F1 使用 Boost.Lambda来生成：参看下面的例子：</p>
<p>
          参数<span class="emphasis"><em>expect_func</em></span> 是一个从矩阵<span class="emphasis"><em>a</em></span>中提取数据的函数对象。典型情况下 类型F2使用 Boost.Lambda来生成：参看下面的例子：</p>
<p>
          如果预期返回一个有限值，但测试的函数返回一个无限值，或者如果发现了过失误差(gross error )，那么报错消息被发送到<code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">cerr</span></code>，并调用 BOOST_ERROR()
  (要包含这个头文件要求你使用 Boost.Test)。这主要是一个调试/开发的辅助(一个设置断点的好地方)。</p>
<a name="math_toolkit.toolkit.internals2.error_test.example"></a>
<h5>
<a name="id798930"></a>
          <a href="error_test.html#math_toolkit.toolkit.internals2.error_test.example">例子</a>
  </h5>
<p>
  假设我们想要测试函数 tgamma 和 lgamma ，我们可以生成一个测试数据的二维矩阵，每一行是一个测试用例，并包含三个元素：输出数据，分别为tgamma和lgamma函数的预期结果。</p>
<pre class="programlisting"><span class="keyword">static</span> <span class="keyword">const</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">array</span><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">array</span><span class="special">&lt;</span><span class="identifier">TestType</span><span class="special">,</span> <span class="number">3</span><span class="special">&gt;,</span> <span class="identifier">NumberOfTests</span><span class="special">&gt;</span> 
   <span class="identifier">factorials</span> <span class="special">=</span> <span class="special">{</span>
      <span class="comment">/*大量的测试数据 */</span>
   <span class="special">};</span>
</pre>
<p>
          现在我们调用测试函数来测试函数 tgamma：</p>
<pre class="programlisting"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">tools</span><span class="special">;</span>
<span class="keyword">using</span> <span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">lambda</span><span class="special">;</span>

<span class="comment">// 获取正在测试的函数的指针:
</span><span class="identifier">TestType</span> <span class="special">(*</span><span class="identifier">funcp</span><span class="special">)(</span><span class="identifier">TestType</span><span class="special">)</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">tgamma</span><span class="special">;</span>

<span class="comment">// 声明一个对象来存储结果:
</span><span class="identifier">test_result</span><span class="special">&lt;</span><span class="identifier">TestType</span><span class="special">&gt;</span> <span class="identifier">result</span><span class="special">;</span>
<span class="comment">//
</span><span class="comment">//测试tgamma函数:
</span><span class="comment">//
</span><span class="identifier">result</span> <span class="special">=</span> <span class="identifier">test</span><span class="special">(</span>
   <span class="identifier">factorials</span><span class="special">,</span> 
   <span class="identifier">bind</span><span class="special">(</span><span class="identifier">funcp</span><span class="special">,</span> <span class="identifier">ret</span><span class="special">&lt;</span><span class="identifier">TestType</span><span class="special">&gt;(</span><span class="identifier">_1</span><span class="special">[</span><span class="number">0</span><span class="special">])),</span> <span class="comment">// 使用factorials[row][0]来调用函数
</span>   <span class="identifier">ret</span><span class="special">&lt;</span><span class="identifier">TestType</span><span class="special">&gt;(</span><span class="identifier">_1</span><span class="special">[</span><span class="number">1</span><span class="special">])</span>               <span class="comment">// 从 factorials[row][1]中提取预期结果
</span><span class="special">);</span>
<span class="comment">//
</span><span class="comment">// 打印一些结果:
</span><span class="comment">//
</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"The Mean was "</span> <span class="special">&lt;&lt;</span> <span class="identifier">result</span><span class="special">.</span><span class="identifier">mean</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"The worst error was "</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">result</span><span class="special">.</span><span class="identifier">max</span><span class="special">)()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"The worst error was at row "</span> <span class="special">&lt;&lt;</span> <span class="identifier">result</span><span class="special">.</span><span class="identifier">worst_case</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="comment">//
</span><span class="comment">// 测试lgamma函数:
</span><span class="comment">//
</span><span class="identifier">funcp</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">lgamma</span><span class="special">;</span>
<span class="identifier">result</span> <span class="special">=</span> <span class="identifier">test</span><span class="special">(</span>
   <span class="identifier">factorials</span><span class="special">,</span> 
   <span class="identifier">bind</span><span class="special">(</span><span class="identifier">funcp</span><span class="special">,</span> <span class="identifier">ret</span><span class="special">&lt;</span><span class="identifier">TestType</span><span class="special">&gt;(</span><span class="identifier">_1</span><span class="special">[</span><span class="number">0</span><span class="special">])),</span> <span class="comment">// 使用factorials[row][0]来调用函数</span>
   <span class="identifier">ret</span><span class="special">&lt;</span><span class="identifier">TestType</span><span class="special">&gt;(</span><span class="identifier">_1</span><span class="special">[</span><span class="number">2</span><span class="special">])</span>               <span class="comment">// </span><span class="comment">从 factorials[row][2]中提取预期结果
</span><span class="comment">//
</span><span class="comment">// etc ...
</span><span class="comment">//
</span></pre>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright ?2006 , 2007, 2008 John Maddock, Paul A. Bristow, Hubert
      Holin, Xiaogang Zhang and Bruno Lalande<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="minimax.html"><img src="../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../internals2.html"><img src="../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="test_data.html"><img src="../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
