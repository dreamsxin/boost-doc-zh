<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Additional information</title>

<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="../../index.html" title="Chapter&nbsp;1.&nbsp;Boost.Bimap">
<link rel="up" href="../the_tutorial.html" title="The tutorial">
<link rel="prev" href="unconstrained_sets.html" title="Unconstrained Sets">
<link rel="next" href="complete_instantiation_scheme.html" title="Complete instantiation scheme"></head>
<body style="color: black; background-color: white;" alink="#0000ff" link="#0000ff" vlink="#840084">
<table cellpadding="2" width="100%">
<tbody>
<tr>
<td valign="top"><img alt="Boost C++ Libraries" src="../../../../../../boost.png" height="86" width="277"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/people/people.htm">People</a></td>
<td align="center"><a href="http://www.boost.org/more/faq.htm">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr>
</tbody>
</table>
<hr>
<div class="spirit-nav"><a accesskey="p" href="unconstrained_sets.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../the_tutorial.html"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="complete_instantiation_scheme.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="boost_bimap.the_tutorial.additional_information"></a><a class="link" href="additional_information.html" title="Additional information">Additional information 更多的信息</a>
</h3>
</div>
</div>
</div>
<p> Bidirectional maps may have associated information about each
relation. Suppose we want to represent a books and author bidirectional
map. </p>
<p> 双向映射可以具有关于每个关系的关联信息。假设我们想表示一个书籍与作者的双向映射。</p>
<p> </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span><br><span class="identifier">multiset_of</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;,</span> <span class="comment">// author 作者<br></span> <span class="identifier">set_of</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;</span> <span class="comment">// title 题目<br></span><br><span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="keyword">typedef</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span> <span class="identifier">book</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">book</span><span class="special">(</span> <span class="string">"Bjarne Stroustrup"</span> <span class="special">,</span> <span class="string">"The C++ Programming Language"</span> <span class="special">)</span> <span class="special">);</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">book</span><span class="special">(</span> <span class="string">"Scott Meyers"</span> <span class="special">,</span> <span class="string">"Effective C++"</span> <span class="special">)</span> <span class="special">);</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">book</span><span class="special">(</span> <span class="string">"Andrei Alexandrescu"</span> <span class="special">,</span> <span class="string">"Modern C++ Design"</span> <span class="special">)</span> <span class="special">);</span><br><span class="comment">// Print the author of Modern C++ 打印 Modern C++ 的作者<br></span><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span> <span class="string">"Modern C++ Design"</span> <span class="special">);</span>
</pre>
<p> <br>
Suppose now that we want to store abstract of each book. We have two
options:</p>
<p>假设现在我们想保存每本书的摘要。我们有两个选择： </p>
<div class="orderedlist">
<ol type="1">
<li> Books name are unique identifiers, so we can create a
separate <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">map</span><span class="special">&lt;</span>
<span class="identifier">string</span><span class="special">,</span> <span class="identifier">string</span>
<span class="special">&gt;</span></code>
that relates books names with abstracts. <br>因为书名为唯一标识，所以我们可以创建一个单独的 <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">map</span><span class="special">&lt;</span> <span class="identifier">string</span><span class="special">,</span> <span class="identifier">string</span>
<span class="special">&gt;</span></code>
将书名和摘要关系起来。 </li>
<li> We can use <a href="http://www.boost.org/libs/multi_index/doc/index.html" target="_top"><span class="bold"><strong>Boost.MultiIndex</strong></span></a>
for the new beast. <br>我们可以为此使用 <a href="http://www.boost.org/libs/multi_index/doc/index.html" target="_top"><span class="bold"><strong>Boost.MultiIndex</strong></span></a>. </li>
</ol>
</div>
<p> Option 1 is the wrong approach, if we go this path we lost
what bimap has won us. We now have to maintain the logic of two
interdependent containers, there is an extra string stored for each
book name, and the performance will be worse. This is far away from
being a good solution.&nbsp;</p><p>选择1是错误的方法，如果我们照此去做，将失去 bimap 带给我们的好处。我们现在必须维护两个独立容器的逻辑，每个书名都保存有一个额外的字符串，而且性能也会变差。这不是一个好的解决方案。</p>
<p> Option 2 is correct. We start thinking books as entries in a
table. So it makes sense to start using Boost.MultiIndex. We can then
add the year of publication, the price, etc... and we can index this
new items too. So Boost.MultiIndex is a sound solution for our problem.</p><p>选择2是正确的。我们将书视为一张表中的项。所以显然应该使用 Boost.MultiIndex。我们可以增加出版年份、价格等等...我们还可以对新增项进行索引。所以对于我们的问题，Boost.MultiIndex 是正确的解决方案。
</p>
<p> The thing is that there are cases where we want to maintain
bimap semantics (use <code class="computeroutput"><span class="identifier">at</span><span class="special">()</span></code>
to find an author given a book name and the other way around) and add
information about the relations that we are sure we will not want to
index later (like the abstracts). Option 1 is not possible, option 2
neither.</p><p>问题是，在有些情况下，我们希望保持 bimap 的语义时(使用 <code class="computeroutput"><span class="identifier">at</span><span class="special">()</span></code> 查找给定书名的作者或其它方式)并且增加与关系相关的信息，我们确保这些信息是不需要索引的(如摘要)。选择1 是不可能的，选择2也不行。 </p>
<p> Boost.Bimap provides support for this kind of situations by
means of an embedded information member. You can pass an extra
parameter to a bimap: <code class="computeroutput"><span class="identifier">with_info</span><span class="special">&lt;</span> <span class="identifier">InfoType</span> <span class="special">&gt;</span></code> and an <code class="computeroutput"><span class="identifier">info</span></code>
member of type <code class="computeroutput"><span class="identifier">InfoType</span></code> will
appear in the relation and bimap pairs.</p><p> Boost.Bimap 通过一个嵌入的信息成员为这种情形提供了支持。你可以传递给 bimap 一个额外的参数：<code class="computeroutput"><span class="identifier">with_info</span><span class="special">&lt;</span> <span class="identifier">InfoType</span> <span class="special">&gt;</span></code>，一个类型为 <code class="computeroutput"><span class="identifier">InfoType</span></code> 的 <code class="computeroutput"><span class="identifier">info</span></code>
成员会出现在关系和 bimap 对中。 </p>
<p> <span class="inlinemediaobject"><img src="../../images/bimap/relation.and.pair.with.info.png" alt="relation.and.pair.with.info"></span> </p>
<p> Relations and bimap pairs constructors will take an extra
argument. If only two arguments are used, the information will be
initialized with their default constructor. </p>
<p> 关系和 bimap 对的构造函数将接受一个额外的参数。如果只使用两个参数，则该信息将被它们的缺省构造函数所初始化。</p>
<p> </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span><br><span class="identifier">multiset_of</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;,</span> <span class="comment">// author 作者<br></span> <span class="identifier">set_of</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;,</span> <span class="comment">// title 题目<br></span><br><span class="identifier">with_info</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;</span> <span class="comment">// abstract 摘要<br></span><br><span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="keyword">typedef</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span> <span class="identifier">book</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span><br><span class="identifier">book</span><span class="special">(</span> <span class="string">"Bjarne Stroustrup"</span> <span class="special">,</span> <span class="string">"The C++ Programming Language"</span><span class="special">,</span><br><span class="string">"For C++ old-timers, the first edition of this book is"</span><br><span class="string">"the one that started it all—the font of our knowledge."</span> <span class="special">)</span><br><span class="special">);</span><br><span class="comment">// Print the author of the bible 打印C++圣经的作者<br></span><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="string">"The C++ Programming Language"</span><span class="special">);</span><br><span class="comment">// Print the abstract of this book 打印这本书的摘要<br></span><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">i</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">find</span><span class="special">(</span><span class="string">"Bjarne Stroustrup"</span><span class="special">);</span><br><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">i</span><span class="special">-&gt;</span><span class="identifier">info</span><span class="special">;</span>
</pre>


<p> <br>Contrary to the two key types, the information will be
mutable using iterators. </p>
<p> 与两个键类型不同，该信息可以通过迭代器进行修改。</p>
<p> </p>
<pre class="programlisting"><span class="identifier">i</span><span class="special">-&gt;</span><span class="identifier">info</span> <span class="special">+=</span> <span class="string">"More details about this book"</span><span class="special">;</span>
</pre>


<p> <br>A new function is included in <span class="emphasis"><em>unique</em></span>
map views: <code class="computeroutput"><span class="identifier">info_at</span><span class="special">(</span><span class="identifier">key</span><span class="special">)</span></code>, that mimics the
standard <code class="computeroutput"><span class="identifier">at</span><span class="special">(</span><span class="identifier">key</span><span class="special">)</span></code>
function but returned the associated information instead of the data. </p>
<p> 在唯一映射视图中将新增一个函数：<code class="computeroutput"><span class="identifier">info_at</span><span class="special">(</span><span class="identifier">key</span><span class="special">)</span></code>，它模仿标准的 <code class="computeroutput"><span class="identifier">at</span><span class="special">(</span><span class="identifier">key</span><span class="special">)</span></code> 函数，但返回的是相关联的信息而不是数据。</p>
<p> </p>
<pre class="programlisting"><span class="comment">// Print the new abstract 打印新的摘要<br></span><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">info_at</span><span class="special">(</span><span class="string">"The C++ Programming Language"</span><span class="special">);</span>
</pre>


<p> <br>The info member can be tagged just as the left or the right
member. The following is a rewrite of the above example using user
defined names: </p>
<p> 成员 info 可以象 left 和 right 成员那样加标签。以下使用用户自定义名字重写上述例子：</p>
<p> </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span><br><span class="identifier">multiset_of</span><span class="special">&lt;</span> <span class="identifier">tagged</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="identifier">author</span> <span class="special">&gt;</span> <span class="special">&gt;,</span><br><span class="identifier">set_of</span><span class="special">&lt;</span> <span class="identifier">tagged</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="identifier">title</span> <span class="special">&gt;</span> <span class="special">&gt;,</span><br><span class="identifier">with_info</span><span class="special">&lt;</span> <span class="identifier">tagged</span><span class="special">&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span> <span class="identifier">abstract</span> <span class="special">&gt;</span> <span class="special">&gt;</span><br><span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="keyword">typedef</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span> <span class="identifier">book</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span><br><span class="identifier">book</span><span class="special">(</span> <span class="string">"Bjarne Stroustrup"</span> <span class="special">,</span> <span class="string">"The C++ Programming Language"</span><span class="special">,</span><br><span class="string">"For C++ old-timers, the first edition of this book is"</span><br><span class="string">"the one that started it all—the font of our knowledge."</span> <span class="special">)</span><br><span class="special">);</span><br><span class="comment">// Print the author of the bible 打印C++圣经的作者<br></span><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">by</span><span class="special">&lt;</span><span class="identifier">title</span><span class="special">&gt;().</span><span class="identifier">at</span><span class="special">(</span><span class="string">"The C++ Programming Language"</span><span class="special">);</span><br><span class="comment">// Print the abstract of this book 打印这本书的摘要<br></span><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">map_by</span><span class="special">&lt;</span><span class="identifier">author</span><span class="special">&gt;::</span><span class="identifier">iterator</span> <span class="identifier">i</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">by</span><span class="special">&lt;</span><span class="identifier">author</span><span class="special">&gt;().</span><span class="identifier">find</span><span class="special">(</span><span class="string">"Bjarne Stroustrup"</span><span class="special">);</span><br><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">i</span><span class="special">-&gt;</span><span class="identifier">get</span><span class="special">&lt;</span><span class="identifier">abstract</span><span class="special">&gt;();</span><br><span class="comment">// Contrary to the two key types, the information will be mutable<br></span><span class="comment">// using iterators. 与两个键类型不同，信息可以通过迭代器修改<br></span><br><span class="identifier">i</span><span class="special">-&gt;</span><span class="identifier">get</span><span class="special">&lt;</span><span class="identifier">abstract</span><span class="special">&gt;()</span> <span class="special">+=</span> <span class="string">"More details about this book"</span><span class="special">;</span><br><span class="comment">// Print the new abstract 打印新的摘要<br></span><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">by</span><span class="special">&lt;</span><span class="identifier">title</span><span class="special">&gt;().</span><span class="identifier">info_at</span><span class="special">(</span><span class="string">"The C++ Programming Language"</span><span class="special">);</span>
</pre>


<p> <a href="../../../../example/tutorial_info_hook.cpp" target="_top">Go to source code 察看源代码</a> </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%">
<tbody>
<tr>
<td align="left"></td>
<td align="right">
<div class="copyright-footer">Copyright © 2006 -2007
Matias Capeletto
<p> Distributed under the Boost Software License, Version
1.0. (See accompanying file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
</p>
</div>
</td>
</tr>
</tbody>
</table>
<hr>
<div class="spirit-nav"><a accesskey="p" href="unconstrained_sets.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../the_tutorial.html"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="complete_instantiation_scheme.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body></html>