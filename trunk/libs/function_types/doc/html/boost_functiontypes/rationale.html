<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Rationale &#21407;&#29702;</title>
<link rel="stylesheet" href="../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Boost.FunctionTypes 2.5">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Boost.FunctionTypes 2.5">
<link rel="prev" href="reference/macros.html" title="Macros &#23439;">
<link rel="next" href="acknowledgements.html" title="Acknowledgements &#40483;&#35874;">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../boost.png"></td>
<td align="center"><a href="../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="reference/macros.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="acknowledgements.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="boost_functiontypes.rationale"></a><a class="link" href="rationale.html" title="Rationale &#21407;&#29702;"> Rationale &#21407;&#29702;</a>
</h2></div></div></div>
<a name="boost_functiontypes.rationale.error_handling_rationale___________________"></a><h4>
<a name="id5104049"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.error_handling_rationale___________________">Error
      handling rationale &#38169;&#35823;&#22788;&#29702;&#21407;&#29702;</a>
    </h4>
<p>
      The library does not define the required members of class templates in case
      of an error. This technique causes the compiler to stop displaying diagnostics
      in client code, at the point where the error actually is, instead of tracing
      template instantiations into the implementation of the library. <br> &#26412;&#24211;&#22312;&#20986;&#38169;&#26102;&#27809;&#26377;&#23450;&#20041;&#25152;&#38656;&#30340;&#31867;&#27169;&#26495;&#25104;&#21592;&#12290;&#36825;&#19968;&#25216;&#26415;&#20250;&#35753;&#32534;&#35793;&#22120;&#22312;&#23458;&#25143;&#20195;&#30721;&#20013;&#26174;&#31034;&#35770;&#26029;&#20449;&#24687;&#65292;
      &#22312;&#23454;&#38469;&#21457;&#29983;&#38169;&#35823;&#30340;&#28857;&#19978;&#65292;&#32780;&#19981;&#26159;&#36319;&#36394;&#27169;&#26495;&#30340;&#23454;&#20363;&#32780;&#36827;&#20837;&#21040;&#24211;&#30340;&#23454;&#29616;&#20013;&#12290;
    </p>
<p>
      The library's components have limited error conditions, so problematic input
      can be spotted easily.<br> &#26412;&#24211;&#30340;&#32452;&#20214;&#24050;&#38480;&#21046;&#20102;&#38169;&#35823;&#26465;&#20214;&#65292;&#25152;&#20197;&#21487;&#20197;&#24456;&#23481;&#26131;&#25214;&#21040;&#26377;&#38382;&#39064;&#30340;&#36755;&#20837;&#12290;
    </p>
<a name="boost_functiontypes.rationale.why_mpl_sequences__________________mpl__________"></a><h4>
<a name="id5104101"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.why_mpl_sequences__________________mpl__________">Why
      MPL Sequences? &#20026;&#20160;&#20040;&#20351;&#29992; MPL &#24207;&#21015;&#65311;</a>
    </h4>
<p>
      MPL provides algorithms on Sequences, so transformations (such as turning by-value
      parameter types into const references for optimized forwarding or computing
      a signature to specialize <a href="../../../../function/index.html" target="_top"><code class="literal">boost::function</code></a>
      after applying <a href="../../../../bind/index.html" target="_top"><code class="literal">boost::bind</code></a>)
      can be expressed more easily. The MPL Sequence concept is compatible with several
      other Boost libraries (most importantly <a href="../../../../fusion/index.html" target="_top">Fusion</a>),
      so another reason is interoperability.<br> MPL &#25552;&#20379;&#20102;&#24207;&#21015;&#30340;&#31639;&#27861;&#65292;&#36825;&#26679;&#21487;&#20197;&#26356;&#23481;&#26131;&#22320;&#36827;&#34892;&#36716;&#25442;(&#22914;&#65306;&#23558;&#25353;&#20540;&#20256;&#36882;&#30340;&#21442;&#25968;&#31867;&#22411;&#36716;&#25442;&#20026;
      const &#24341;&#29992;&#20197;&#20248;&#21270;&#20256;&#36882;&#65292;&#25110;&#32773;&#22312;&#20351;&#29992; <a href="../../../../bind/index.html" target="_top"><code class="literal">boost::bind</code></a>
      &#21518;&#35745;&#31639;&#20986;&#19968;&#20010;&#31614;&#21517;&#20197;&#29305;&#21270; <a href="../../../../function/index.html" target="_top"><code class="literal">boost::function</code></a>)&#12290;
      MPL &#24207;&#21015;&#30340;&#27010;&#24565;&#19982;&#21478;&#22806;&#20960;&#20010; Boost &#24211;&#30456;&#20860;&#23481;(&#26368;&#20027;&#35201;&#26159; <a href="../../../../fusion/index.html" target="_top">Fusion</a>)&#65292;&#25152;&#20197;&#21478;&#19968;&#20010;&#21407;&#22240;&#23601;&#26159;&#20114;&#25805;&#20316;&#24615;&#12290;
    </p>
<a name="boost_functiontypes.rationale.pointer_to_member_object_types____________________________"></a><h4>
<a name="id5104194"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.pointer_to_member_object_types____________________________">Pointer
      to member object types &#25104;&#21592;&#23545;&#35937;&#31867;&#22411;&#30340;&#25351;&#38024;</a>
    </h4>
<p>
      Despite their syntax, pointer to member object types can be seen as dereferencing
      functionals. <br> &#19981;&#31649;&#23427;&#20204;&#30340;&#35821;&#27861;&#65292;&#25104;&#21592;&#23545;&#35937;&#31867;&#22411;&#30340;&#25351;&#38024;&#21487;&#20197;&#34987;&#35270;&#20026;&#35299;&#24341;&#29992;&#21151;&#33021;&#12290;
    </p>
<a name="boost_functiontypes.rationale.the_classtransform_template_parameter__classtransform____________"></a><h4>
<a name="id5104229"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.the_classtransform_template_parameter__classtransform____________">The
      ClassTransform template parameter ClassTransform&#27169;&#26495;&#21442;&#25968;</a>
    </h4>
<p>
      <code class="literal">This</code>-pointer, <code class="literal">this</code>-reference or just
      the object (or maybe even a smart pointer to the object) plus adjustments of
      cv-qualification - all these cases have their place, somewhere and there is
      no single best answer.<br> <code class="literal">This</code>-&#25351;&#38024;&#65292;<code class="literal">this</code>-&#24341;&#29992;&#25110;&#26159;&#20165;&#20165;&#36825;&#20010;&#23545;&#35937;&#26412;&#36523;(&#25110;&#32773;&#21487;&#33021;&#26159;&#25351;&#21521;&#35813;&#23545;&#35937;&#30340;&#26234;&#33021;&#25351;&#38024;)&#65292;
      &#20877;&#21152;&#19978; cv-&#38480;&#23450;&#31526;&#30340;&#35843;&#25972; - &#25152;&#26377;&#36825;&#20123;&#24773;&#20917;&#37117;&#20250;&#23384;&#22312;&#65292;&#20219;&#20309;&#22320;&#26041;&#65292;&#27809;&#26377;&#21807;&#19968;&#30340;&#26368;&#20339;&#31572;&#26696;&#12290;
    </p>
<p>
      Special treatment of the class type within the sequence can significantly complicate
      client code. A custom <code class="literal">ClassTransform</code> argument allows the
      client to adjust the class type before the sequence is formed and then treat
      all parameters uniformly.<br> &#29305;&#27530;&#23545;&#24453;&#24207;&#21015;&#20013;&#30340;&#31867;&#31867;&#22411;&#20250;&#26174;&#33879;&#22686;&#21152;&#23458;&#25143;&#20195;&#30721;&#30340;&#22797;&#26434;&#24230;&#12290;&#19968;&#20010;&#23450;&#21046;&#30340;
      <code class="literal">ClassTransform</code> &#21442;&#25968;&#21487;&#20197;&#35753;&#23458;&#25143;&#20195;&#30721;&#22312;&#24418;&#25104;&#35813;&#24207;&#21015;&#20043;&#21069;&#35843;&#25972;&#36825;&#20123;&#31867;&#30340;&#31867;&#22411;&#65292;
      &#28982;&#21518;&#32479;&#19968;&#23545;&#24453;&#25152;&#26377;&#21442;&#25968;&#12290;
    </p>
<a name="boost_functiontypes.rationale.why_tag_types________________________________"></a><h4>
<a name="id5104318"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.why_tag_types________________________________">Why
      tag types? &#20026;&#20160;&#20040;&#20351;&#29992;&#26631;&#31614;&#31867;&#22411;&#65311;</a>
    </h4>
<p>
      Let's consider the alternatives.<br> &#25105;&#20204;&#26469;&#24819;&#19968;&#19979;&#20854;&#23427;&#30340;&#26041;&#27861;&#12290;
    </p>
<p>
      The first one is just using more templates so every property has to be asked
      for explicitly. This approach results in more complicated client code if more
      than one propery has to be checked and in a exponentially larger library interface.<br>
      &#31532;&#19968;&#20010;&#26041;&#27861;&#26159;&#20351;&#29992;&#26356;&#22810;&#30340;&#27169;&#26495;&#65292;&#27599;&#20010;&#23646;&#24615;&#37117;&#24517;&#39035;&#34987;&#26126;&#30830;&#22320;&#26597;&#38382;&#12290;&#22914;&#26524;&#35201;&#26816;&#26597;&#19968;&#20010;&#20197;&#19978;&#30340;&#23646;&#24615;&#65292;
      &#37027;&#20040;&#36825;&#19968;&#26041;&#27861;&#20250;&#20351;&#23458;&#25143;&#20195;&#30721;&#26356;&#20026;&#22797;&#26434;&#65292;&#24182;&#19988;&#24211;&#30340;&#25509;&#21475;&#34987;&#25351;&#25968;&#32423;&#25918;&#22823;&#12290;
    </p>
<p>
      The second alternative is having the client pass in bit patterns via non-type
      template parameters. The logic has to be performed by the client and there
      are much more error conditions. Further, class templates with non-type template
      parameters do not work within MPL lambda expressions and can cause problems
      with older compilers.<br> &#31532;&#20108;&#20010;&#26041;&#27861;&#26159;&#30001;&#23458;&#25143;&#20195;&#30721;&#20197;&#38750;&#31867;&#22411;&#27169;&#26495;&#21442;&#25968;&#30340;&#26041;&#24335;&#20256;&#20837;&#19968;&#20010;&#20301;&#32452;&#21512;&#12290;&#30456;&#20851;&#36923;&#36753;&#24517;&#39035;&#30001;&#23458;&#25143;&#20195;&#30721;&#25191;&#34892;&#65292;&#20855;&#26377;&#26356;&#22810;&#30340;&#38169;&#35823;&#26465;&#20214;&#12290;
      &#27492;&#22806;&#65292;&#24102;&#26377;&#38750;&#31867;&#22411;&#27169;&#26495;&#21442;&#25968;&#30340;&#31867;&#27169;&#26495;&#19981;&#33021;&#19982; MPL lambda &#34920;&#36798;&#24335;&#19968;&#36215;&#20351;&#29992;&#65292;&#22312;&#32769;&#30340;&#32534;&#35793;&#22120;&#19978;&#20250;&#20986;&#29616;&#38382;&#39064;&#12290;
    </p>
<a name="boost_functiontypes.rationale.is_it_safe_to_have_the_synthesis_templates_take_a_callable__builtin_type_or_an_mpl_sequence_as_the_first_template_argument_________________________________________________________________mpl_________________________________________________"></a><h4>
<a name="id5104389"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.is_it_safe_to_have_the_synthesis_templates_take_a_callable__builtin_type_or_an_mpl_sequence_as_the_first_template_argument_________________________________________________________________mpl_________________________________________________">Is
      it safe to have the synthesis templates take a callable builtin type or an
      MPL sequence as the first template argument? &#35753;&#21512;&#25104;&#27169;&#26495;&#25509;&#21463;&#19968;&#20010;&#21487;&#35843;&#29992;&#20869;&#24314;&#31867;&#22411;&#25110;&#32773;&#19968;&#20010;
      MPL &#24207;&#21015;&#20316;&#20026;&#31532;&#19968;&#20010;&#27169;&#26495;&#21442;&#25968;&#26159;&#21542;&#23433;&#20840;&#65311;</a>
    </h4>
<p>
      Yes, but it isn't immediately obvious as the set of possible MPL sequences
      isn't inherently disjoint from the set of callable builtin types.<br> &#26159;&#30340;&#65292;&#20294;&#36825;&#19981;&#26159;&#38750;&#24120;&#26126;&#26174;&#65292;&#22240;&#20026;&#21487;&#33021;&#30340;MPL&#24207;&#21015;&#38598;&#19981;&#26159;&#20174;&#21487;&#35843;&#29992;&#20869;&#24314;&#31867;&#22411;&#38598;&#20013;&#33258;&#28982;&#22320;&#20998;&#35299;&#20986;&#26469;&#30340;&#12290;
    </p>
<p>
      However, any attempt to make a builtin type work as an MPL sequence is a bad
      idea, because builtin types are accessible before the headers that make the
      type a sequence have been included, which can easily violate the ODR. <br>
      &#19981;&#36807;&#65292;&#23558;&#19968;&#20010;&#20869;&#24314;&#31867;&#22411;&#20316;&#20026;&#19968;&#20010;MPL&#24207;&#21015;&#26469;&#20351;&#29992;&#26159;&#19981;&#22909;&#30340;&#65292;&#22240;&#20026;&#20869;&#24314;&#31867;&#22411;&#22312;&#23558;&#31867;&#22411;&#21019;&#24314;&#20026;&#24207;&#21015;&#30340;&#22836;&#25991;&#20214;&#34987;&#21253;&#21547;&#20043;&#21069;&#23601;&#21487;&#20197;&#34987;&#35775;&#38382;&#65292;&#36825;&#24456;&#23481;&#26131;&#36829;&#21453;
      ODR&#12290;
    </p>
<a name="boost_functiontypes.rationale.why_does_the_hidden__literal_this__literal__parameter_count_for_the__function_arity_of_member_functions______________________literal_this__literal___________________________________________________"></a><h4>
<a name="id5104460"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.why_does_the_hidden__literal_this__literal__parameter_count_for_the__function_arity_of_member_functions______________________literal_this__literal___________________________________________________">Why
      does the hidden <code class="literal">this</code> parameter count for the function arity
      of member functions? &#20026;&#20160;&#20040;&#38544;&#34255;&#30340; <code class="literal">this</code> &#21442;&#25968;&#35201;&#35745;&#20837;&#25104;&#21592;&#20989;&#25968;&#30340;&#21442;&#25968;&#25968;&#37327;&#20013;&#65311;
      </a>
    </h4>
<p>
      It was found preferable that the following condition holds:<br> &#36825;&#26159;&#26368;&#22909;&#30340;&#26041;&#27861;&#65292;&#20197;&#20445;&#35777;&#20197;&#19979;&#26465;&#20214;&#25104;&#31435;&#65306;
    </p>
<pre class="programlisting"><span class="identifier">mpl</span><span class="special">::</span><span class="identifier">size</span><span class="special">&lt;</span> <a class="link" href="reference/decomposition.html#boost_functiontypes.reference.decomposition.parameter_types" title="parameter_types">parameter_types</a><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="special">&gt;::</span><span class="identifier">value</span> <span class="special">==</span> <a class="link" href="reference/decomposition.html#boost_functiontypes.reference.decomposition.function_arity" title="function_arity">function_arity</a><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">value</span>
</pre>
<a name="boost_functiontypes.rationale.why_ignore_top_level_cv_qualifiers_on_pointers____________________________________cv_____________"></a><h4>
<a name="id5104595"></a>
      <a class="link" href="rationale.html#boost_functiontypes.rationale.why_ignore_top_level_cv_qualifiers_on_pointers____________________________________cv_____________">Why
      ignore top-level cv-qualifiers on pointers? &#20026;&#20160;&#20040;&#35201;&#24573;&#30053;&#25351;&#38024;&#30340;&#39030;&#23618;
      cv-&#38480;&#23450;&#31526;&#65311;</a>
    </h4>
<p>
      A cv-qualified pointer is still a pointer. It usually doesn't matter and even
      if it does, it's a job for <a href="../../../../type_traits/index.html" target="_top">Boost.TypeTraits</a>.
      <br> &#19968;&#20010; cv-&#38480;&#23450;&#30340;&#25351;&#38024;&#36824;&#26159;&#19968;&#20010;&#25351;&#38024;&#12290;&#21363;&#20351;&#36825;&#26679;&#20570;&#20102;&#36890;&#24120;&#20063;&#19981;&#20250;&#26377;&#38382;&#39064;&#65292;&#36825;&#26159;
      <a href="../../../../type_traits/index.html" target="_top">Boost.TypeTraits</a> &#30340;&#19968;&#20010;&#32844;&#36131;&#12290;
    </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2004 -2007 Tobias Schwinger<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="reference/macros.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="acknowledgements.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
