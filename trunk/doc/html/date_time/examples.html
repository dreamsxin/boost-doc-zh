<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>



  
  
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">




  
  
  
  
  <title>Examples</title>
  <link rel="stylesheet" href="../boostbook.css" type="text/css">



  
  
  <meta name="generator" content="DocBook XSL Stylesheets V1.68.1">



  
  
  <link rel="start" href="../index.html" title="The Boost C++ Libraries BoostBook Documentation Subset">



  
  
  <link rel="up" href="../date_time.html" title="Chapter&nbsp;4.&nbsp;Boost.Date_Time">



  
  
  <link rel="prev" href="details.html" title="Details">



  
  
  <link rel="next" href="doxy.html" title="Library Reference">
</head>


<body alink="#0000ff" bgcolor="white" link="#0000ff" text="black" vlink="#840084">



<table cellpadding="2" width="100%">



  <tbody>


    <tr>


      <td valign="top"><img alt="Boost C++ Libraries" src="../../../boost.png" height="86" width="277"></td>



      <td align="center"><a href="../../../index.htm">Home</a></td>



      <td align="center"><a href="../../../libs/libraries.htm">Libraries</a></td>



      <td align="center"><a href="../../../people/people.htm">People</a></td>



      <td align="center"><a href="../../../more/faq.htm">FAQ</a></td>



      <td align="center"><a href="../../../more/index.htm">More</a></td>



    </tr>


  
  
  </tbody>
</table>



<hr>
<div class="spirit-nav">
<a accesskey="p" href="details.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../date_time.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="doxy.html"><img src="../images/next.png" alt="Next"></a>
</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both;">
<a name="date_time.examples"></a>例子</h2>


</div>


</div>


</div>



<div class="toc">
<dl>



  <dt><span class="section"><a href="examples.html#date_time.examples.dates_as_strings">字符串表示的日期</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.days_alive">已生活的日子</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.days_between_new_year">距离新年的日子</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.end_of_month_day">每个月的最后一天</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.localization">本地化示例</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.date_period_calc">日期段计算</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.print_holidays">打印假日</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.print_month">打印月份</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.month_add">月份加法</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.time_math">时间的算术</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.print_hours">打印小时</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.local_utc_conversion">本地时间与 UTC 的转换</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.time_periods">时间段</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.simple_time_zone">简单的时区</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.calc_rules">夏时制计算规则</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.flight">飞行时间例子</a></span></dt>



  <dt><span class="section"><a href="examples.html#date_time.examples.seconds_since_epoch">从纪元起计的秒数</a></span></dt>



</dl>


</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.dates_as_strings"></a>字符串表示的日期</h3>


</div>


</div>


</div>



<p>多个字符串的分析和输出。
  </p>



<pre class="programlisting">    <br><br>  /* 以下例子示范了 date 和 std::string 之间的转换。<br>   * <br>   * 正常输出：<br>   * 2001-Oct-09<br>   * 2001-10-09<br>   * Tuesday October 9, 2001<br>   * 有一个异常：<br>   * Exception: Month number is out of range 1..12<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;iostream&gt;<br>  #include &lt;string&gt;<br><br>  int<br>  main() <br>  {<br><br>    using namespace boost::gregorian;<br><br>    try {<br>      // 以下日期以 ISO 8601 扩展格式表示 (CCYY-MM-DD)<br>      std::string s("2001-10-9"); //2001-October-09<br>      date d(from_simple_string(s));<br>      std::cout &lt;&lt; to_simple_string(d) &lt;&lt; std::endl;<br>      <br>      // 读入 ISO 标准格式(CCYYMMDD) 并输出 ISO 扩展格式<br>      std::string ud("20011009"); //2001-Oct-09<br>      date d1(from_undelimited_string(ud));<br>      std::cout &lt;&lt; to_iso_extended_string(d1) &lt;&lt; std::endl;<br>      <br>      // 输出 date 的各个部分 - Tuesday October 9, 2001<br>      date::ymd_type ymd = d1.year_month_day();<br>      greg_weekday wd = d1.day_of_week();<br>      std::cout &lt;&lt; wd.as_long_string() &lt;&lt; " "<br>                &lt;&lt; ymd.month.as_long_string() &lt;&lt; " "<br>                &lt;&lt; ymd.day &lt;&lt; ", " &lt;&lt; ymd.year<br>                &lt;&lt; std::endl;<br><br>      // 我们传入月份 25 以创造一个异常<br>      std::string bad_date("20012509"); //2001-??-09<br>      std::cout &lt;&lt; "An expected exception is next: " &lt;&lt; std::endl;<br>      date wont_construct(from_undelimited_string(bad_date));<br>      //use wont_construct so compiler doesn't complain, but you wont get here!<br>      std::cout &lt;&lt; "oh oh, you shouldn't reach this line: " <br>                &lt;&lt; to_iso_string(wont_construct) &lt;&lt; std::endl;<br>    }<br>    catch(std::exception&amp; e) {<br>      std::cout &lt;&lt; "  Exception: " &lt;&lt;  e.what() &lt;&lt; std::endl;<br>    }<br><br><br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.days_alive"></a>已生活的日子</h3>


</div>


</div>


</div>



<p>使用时间长度和日期来计算你已经活过的天数。
  </p>



<pre class="programlisting"><code class="literal">
<span class="comment">/* 以下短例计算你出生后的天数。<br> * 示范了时间长度的比较，使用 day_clock, 以及从字符串分析 date.<br> */</span><span class="preprocessor">

#include</span><span class="string"> "boost/date_time/gregorian/gregorian.hpp"</span><span class="preprocessor">
#include</span><span class="special"> &lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span><span class="keyword">

int</span><span class="identifier">
main</span><span class="special">()</span><span class="special"> <br>{</span><span class="keyword">
  
  using</span><span class="keyword"> namespace</span><span class="identifier"> boost</span><span class="special">::</span><span class="identifier">gregorian</span><span class="special">;</span><span class="identifier">
  std</span><span class="special">::</span><span class="identifier">string</span><span class="identifier"> s</span><span class="special">;</span><span class="identifier">
  std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "Enter birth day YYYY-MM-DD (eg: 2002-02-01): "</span><span class="special">;</span><span class="identifier">
  std</span><span class="special">::</span><span class="identifier">cin</span><span class="special"> &gt;&gt;</span><span class="identifier"> s</span><span class="special">;</span><span class="keyword">
  try</span><span class="special"> {</span><span class="identifier">
    date</span><span class="identifier"> birthday</span><span class="special">(</span><span class="identifier">from_simple_string</span><span class="special">(</span><span class="identifier">s</span><span class="special">));</span><span class="identifier">
    date</span><span class="identifier"> today</span><span class="special"> =</span><span class="identifier"> day_clock</span><span class="special">::</span><span class="identifier">local_day</span><span class="special">();</span><span class="identifier">
    days</span><span class="identifier"> days_alive</span><span class="special"> =</span><span class="identifier"> today</span><span class="special"> -</span><span class="identifier"> birthday</span><span class="special">;</span><span class="identifier">
    days</span><span class="identifier"> one_day</span><span class="special">(</span><span class="number">1</span><span class="special">);</span><span class="keyword">
    if</span><span class="special"> (</span><span class="identifier">days_alive</span><span class="special"> ==</span><span class="identifier"> one_day</span><span class="special">)</span><span class="special"> {</span><span class="identifier">
      std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "Born yesterday, very funny"</span><span class="special"> &lt;&lt;</span><span class="identifier"> std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="special">
    }</span><span class="keyword">
    else</span><span class="keyword"> if</span><span class="special"> (</span><span class="identifier">days_alive</span><span class="special"> &lt;</span><span class="identifier"> days</span><span class="special">(</span><span class="number">0</span><span class="special">))</span><span class="special"> {</span><span class="identifier">
      std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "Not born yet, hmm: "</span><span class="special"> &lt;&lt;</span><span class="identifier"> days_alive</span><span class="special">.</span><span class="identifier">days</span><span class="special">()</span><span class="special"> <br>                &lt;&lt;</span><span class="string"> " days"</span><span class="special"> &lt;&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="special">
    }</span><span class="keyword">
    else</span><span class="special"> {</span><span class="identifier">
      std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "Days alive: "</span><span class="special"> &lt;&lt;</span><span class="identifier"> days_alive</span><span class="special">.</span><span class="identifier">days</span><span class="special">()</span><span class="special"> &lt;&lt;</span><span class="identifier"> std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="special">
    }</span><span class="special">

  }</span><span class="keyword">
  catch</span><span class="special">(...)</span><span class="special"> {</span><span class="identifier">
    std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "Bad date entered: "</span><span class="special"> &lt;&lt;</span><span class="identifier"> s</span><span class="special"> &lt;&lt;</span><span class="identifier"> std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="special">
  }</span><span class="keyword">
  return</span><span class="number"> 0</span><span class="special">;</span><span class="special">
}</span>
</code>
</pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.days_between_new_year"></a>距离新年的日子</h3>


</div>


</div>


</div>



<p>计算到新年的天数。
  </p>



<pre class="programlisting">    <br>  /* 以下例子使用一个 date_generator, 以及简单的数学操作，<br>   * 来计算距离今年新年的天数，以及到下一个新年的天数。<br>   *<br>   * 正常结果：<br>   * 两个天数相加为 365 (闰年则为 366)。<br>   */<br>  #include &lt;iostream&gt;<br>  #include "boost/date_time/gregorian/gregorian.hpp"<br><br>  int<br>  main() <br>  {<br>    <br>    using namespace boost::gregorian;<br><br>    date today = day_clock::local_day();<br>    partial_date new_years_day(1,Jan);<br>    //Subtract two dates to get a duration<br>    days days_since_year_start = today - new_years_day.get_date(today.year());<br>    std::cout &lt;&lt; "Days since Jan 1: " &lt;&lt; days_since_year_start.days() <br>              &lt;&lt; std::endl;<br>    <br>    days days_until_year_start = new_years_day.get_date(today.year()+1) - today;<br>    std::cout &lt;&lt; "Days until next Jan 1: " &lt;&lt; days_until_year_start.days() <br>              &lt;&lt; std::endl;<br>    return 0;<br>  };<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.end_of_month_day"></a>每个月的最后一天</h3>


</div>


</div>


</div>



<p>以下例子让用户输入一个月份和年份，找出该年所剩每个月的最后一天。
  </p>



<pre class="programlisting">    <br>  /* 该例找出给定月份的最后一天，然后显示给定年份所剩各月的最后一天。<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main()<br>  {<br>    using namespace boost::gregorian;<br>    <br>    greg_year year(1400);<br>    greg_month month(1);<br><br>    // 用户给定一个月份和年份<br>    try {<br>      int y, m;<br>      std::cout &lt;&lt; "   Enter Year(ex: 2002): ";<br>      std::cin &gt;&gt; y;<br>      year = greg_year(y);<br>      std::cout &lt;&lt; "   Enter Month(1..12): ";<br>      std::cin &gt;&gt; m;<br>      month = greg_month(m);<br>    }<br>    catch(bad_year by) {<br>      std::cout &lt;&lt; "Invalid Year Entered: " &lt;&lt; by.what() &lt;&lt; '\n'<br>        &lt;&lt; "Using minimum values for month and year." &lt;&lt; std::endl;<br>    }<br>    catch(bad_month bm) {<br>      std::cout &lt;&lt; "Invalid Month Entered" &lt;&lt; bm.what() &lt;&lt; '\n'<br>        &lt;&lt; "Using minimum value for month. " &lt;&lt; std::endl;<br>    }<br>    <br>    date start_of_next_year(year+1, Jan, 1);<br>    date d(year, month, 1);<br>    <br>    // 将一个月增加到 d 直到下一年。<br>    while (d &lt; start_of_next_year){<br>      std::cout &lt;&lt; to_simple_string(d.end_of_month()) &lt;&lt; std::endl;<br>      d += months(1);<br>    }<br><br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.localization"></a>本地化示例</h3>


</div>


</div>


</div>



<p> boost::date_time 库提供了创建定制 locale facets 的能力。日期的顺序、语言、分隔符和缩写均可定制。 </p>



<pre class="programlisting">    <br>  /* 下面示范了创建一个以德语输出日期的 facet (请原谅我的德语中的错误 --<br>   * 我的母语不是德语)。<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;iostream&gt;<br>  #include &lt;algorithm&gt;<br><br>  /* 定义一系列字符数据，分别为与德语日期输出相关的缩写和全名字符串<br>   * (从该 locale 中取出的将是 US 名)。 */<br>  const char* const de_short_month_names[] = <br>  {<br>    "Jan", "Feb", "Mar", "Apr", "Mai", "Jun",<br>    "Jul", "Aug", "Sep", "Okt", "Nov", "Dez", "NAM" <br>  };<br>  const char* const de_long_month_names[] =<br>  {<br>    "Januar", "Februar", "Marz", "April", "Mai",<br>    "Juni", "Juli", "August", "September", "Oktober",<br>    "November", "Dezember", "NichtDerMonat"<br>  };<br>  const char* const de_long_weekday_names[] = <br>  {<br>    "Sonntag", "Montag", "Dienstag", "Mittwoch",<br>    "Donnerstag", "Freitag", "Samstag"<br>  };<br>  const char* const de_short_weekday_names[] =<br>  {<br>    "Son", "Mon", "Die","Mit", "Don", "Fre", "Sam"<br>  };<br><br><br>  int main() <br>  {<br>    using namespace boost::gregorian;<br>   <br>    // 创建一些输出用的格里历对象<br>    date d1(2002, Oct, 1);<br>    greg_month m = d1.month();<br>    greg_weekday wd = d1.day_of_week();<br>    <br>    // 为德语日期创建一个 facet 和一个 locale<br>    date_facet* german_facet = new date_facet();<br>    std::cout.imbue(std::locale(std::locale::classic(), german_facet));<br><br>    // 创建德语名字集合<br>    date_facet::input_collection_type short_months, long_months, <br>                                      short_weekdays, long_weekdays;<br>    std::copy(&amp;de_short_month_names[0], &amp;de_short_month_names[11],<br>              std::back_inserter(short_months));<br>    std::copy(&amp;de_long_month_names[0], &amp;de_long_month_names[11],<br>              std::back_inserter(long_months));<br>    std::copy(&amp;de_short_weekday_names[0], &amp;de_short_weekday_names[6],<br>              std::back_inserter(short_weekdays));<br>    std::copy(&amp;de_long_weekday_names[0], &amp;de_long_weekday_names[6],<br>              std::back_inserter(long_weekdays));<br><br>    // 替换我们的缺省名字<br>    // 注：date_generators 和 special_values 未被替换，因为本例中未使用<br>    german_facet-&gt;short_month_names(short_months);<br>    german_facet-&gt;long_month_names(long_months);<br>    german_facet-&gt;short_weekday_names(short_weekdays);<br>    german_facet-&gt;long_weekday_names(long_weekdays);<br>    <br>    // 以德语的月份缩写输出日期<br>    german_facet-&gt;format("%d.%m.%Y");<br>    std::cout &lt;&lt; d1 &lt;&lt; std::endl; //01.10.2002<br>    <br>    german_facet-&gt;month_format("%B");<br>    std::cout &lt;&lt; m &lt;&lt; std::endl; //Oktober<br>    <br>    german_facet-&gt;weekday_format("%A");<br>    std::cout &lt;&lt; wd &lt;&lt; std::endl; //Dienstag<br><br><br>    // 以 US 名输出相同的格里历对象<br>    date_facet* us_facet = new date_facet();<br>    std::cout.imbue(std::locale(std::locale::classic(), us_facet)); <br><br>    us_facet-&gt;format("%m/%d/%Y");<br>    std::cout &lt;&lt; d1 &lt;&lt; std::endl; //  10/01/2002<br>    <br>    // 英文名，iso 顺序(年-月-日)，'-' 分隔符<br>    us_facet-&gt;format("%Y-%b-%d");<br>    std::cout &lt;&lt; d1 &lt;&lt; std::endl; //  2002-Oct-01<br>    <br>    return 0;<br><br>  }<br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.date_period_calc"></a>日期段计算</h3>


</div>


</div>


</div>



<p>用时间段计算函数计算某个日期是否位于一个&lsquo;无规则&rsquo;的时间段集合中。
  </p>



<pre class="programlisting">    <br>  /*<br>  本例示范了使用时间段来计算日期信息。<br><br>  本例计算一个给定的日期是否在一个给定的周末或假日集合中。即，每个周末或假日<br>  作为一个时间间隔放入一个集合中。如果给定的日期被某一个间隔所包含则认为它是<br>  在这个排除集合之中，是一个休息日。<br><br>  输出：<br>  Number Excluded Periods: 5<br>  20020202/20020203<br>  20020209/20020210<br>  20020212/20020212<br>  20020216/20020217<br>  In Exclusion Period: 20020216 --&gt; 20020216/20020217<br>  20020223/20020224<br><br>  */<br><br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;set&gt;<br>  #include &lt;algorithm&gt;<br>  #include &lt;iostream&gt;<br><br>  typedef std::set&lt;boost::gregorian::date_period&gt; date_period_set;<br><br>  //生成排除集合<br>  date_period_set<br>  generateExclusion()<br>  {<br>    using namespace boost::gregorian;<br>    date_period periods_array[] = <br>      { date_period(date(2002,Feb,2), date(2002,Feb,4)),//weekend of 2nd-3rd<br>        date_period(date(2002,Feb,9), date(2002,Feb,11)),<br>        date_period(date(2002,Feb,16), date(2002,Feb,18)),<br>        date_period(date(2002,Feb,23), date(2002,Feb,25)),<br>        date_period(date(2002,Feb,12), date(2002,Feb,13))//a random holiday 2-12<br>      };<br>    const int num_periods = sizeof(periods_array)/sizeof(date_period);<br><br>    date_period_set ps;<br>    //将时间段插入到集合中<br>    std::insert_iterator&lt;date_period_set&gt; itr(ps, ps.begin());<br>    std::copy(periods_array, periods_array+num_periods, itr );<br>    return ps;<br>    <br>  }<br><br><br>  int main() <br>  {<br>    using namespace boost::gregorian;<br>    <br>    date_period_set ps = generateExclusion();<br>    std::cout &lt;&lt; "Number Excluded Periods: "  &lt;&lt; ps.size() &lt;&lt; std::endl;<br><br>    date d(2002,Feb,16);<br>    date_period_set::const_iterator i = ps.begin();<br>    //打印时间段，并检查包含性<br>    for (;i != ps.end(); i++) {<br>      std::cout &lt;&lt; to_iso_string(*i) &lt;&lt; std::endl;<br>      //如果 date 位于于排除时间段中则打印它<br>      if (i-&gt;contains(d)) {<br>        std::cout &lt;&lt; "In Exclusion Period: "<br>            &lt;&lt; to_iso_string(d) &lt;&lt; " --&gt; " &lt;&lt; to_iso_string(*i)<br>            &lt;&lt; std::endl;<br>      }<br>    }<br><br>    return 0;  <br><br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.print_holidays"></a>打印假日</h3>


</div>


</div>


</div>



<p>这是一个用函数对象来定义假日时间表的例子。
  </p>



<pre class="programlisting">    <br><br>  /* 使用一组日期生成器来生成一组日期<br>   * 输出如下：<br>   * Enter Year: 2002<br>   * 2002-Jan-01 [Tue]<br>   * 2002-Jan-21 [Mon]<br>   * 2002-Feb-12 [Tue]<br>   * 2002-Jul-04 [Thu]<br>   * 2002-Sep-02 [Mon]<br>   * 2002-Nov-28 [Thu]<br>   * 2002-Dec-25 [Wed]<br>   * Number Holidays: 7<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;algorithm&gt;<br>  #include &lt;functional&gt;<br>  #include &lt;vector&gt;<br>  #include &lt;iostream&gt;<br>  #include &lt;set&gt;<br><br>  void<br>  print_date(boost::gregorian::date d) <br>  {<br>    using namespace boost::gregorian;<br>  #if defined(BOOST_DATE_TIME_NO_LOCALE)<br>    std::cout &lt;&lt; to_simple_string(d) &lt;&lt; " [" &lt;&lt; d.day_of_week() &lt;&lt; "]\n";<br>  #else<br>    std::cout &lt;&lt; d &lt;&lt; " [" &lt;&lt; d.day_of_week() &lt;&lt; "]\n";<br>  #endif<br>  }<br><br><br>  int<br>  main() {<br><br>    std::cout &lt;&lt; "Enter Year: ";<br>    int year;<br>    std::cin &gt;&gt; year;<br><br>    using namespace boost::gregorian;<br><br>    //定义一组固定月份和日期的假日<br>    std::vector&lt;year_based_generator*&gt; holidays;<br>    holidays.push_back(new partial_date(1,Jan)); //新年<br>    holidays.push_back(new partial_date(4,Jul)); //美国独立日<br>    holidays.push_back(new partial_date(25, Dec));//圣诞节<br><br><br>    //为 nth_day_of_the_week_in_month 函数对象定义一个缩写<br>    typedef nth_day_of_the_week_in_month nth_dow;<br>    <br>    //美国劳动节<br>    holidays.push_back(new nth_dow(nth_dow::first,  Monday,   Sep)); <br>    //MLK Day<br>    holidays.push_back(new nth_dow(nth_dow::third,  Monday,   Jan)); <br>    //Pres day<br>    holidays.push_back(new nth_dow(nth_dow::second, Tuesday,  Feb)); <br>    //感恩节<br>    holidays.push_back(new nth_dow(nth_dow::fourth, Thursday, Nov)); <br><br>    typedef std::set&lt;date&gt; date_set;<br>    date_set all_holidays;<br>    <br>    for(std::vector&lt;year_based_generator*&gt;::iterator it = holidays.begin();<br>        it != holidays.end(); ++it)<br>    {<br>      all_holidays.insert((*it)-&gt;get_date(year));<br>    }<br><br>    //将假日打印到屏幕<br>    std::for_each(all_holidays.begin(), all_holidays.end(), print_date);<br>    std::cout &lt;&lt; "Number Holidays: " &lt;&lt; all_holidays.size() &lt;&lt; std::endl;<br><br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.print_month"></a>打印月份</h3>


</div>


</div>


</div>



<p>一个简单的工具，打印一个月的所有日期。示范了日期迭代器(date_time::date_itr).
  </p>



<pre class="programlisting">    <br>  /* 本例打印一个月的所有日期。它示范了迭代器和 gregorian_calendar 函数的使用<br>   * <br>   * 输出：<br>   * Enter Year: 2002<br>   * Enter Month(1..12): 2<br>   * 2002-Feb-01 [Fri]<br>   * 2002-Feb-02 [Sat]<br>   * 2002-Feb-03 [Sun]<br>   * 2002-Feb-04 [Mon]<br>   * 2002-Feb-05 [Tue]<br>   * 2002-Feb-06 [Wed]<br>   * 2002-Feb-07 [Thu]<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main()<br>  {<br>    std::cout &lt;&lt; "Enter Year: ";<br>    int year, month;<br>    std::cin &gt;&gt; year;<br>    std::cout &lt;&lt; "Enter Month(1..12): ";<br>    std::cin &gt;&gt; month;<br><br>    using namespace boost::gregorian;<br>    try {<br>      //使用 calendar 取得该月的最后一天<br>      int eom_day = gregorian_calendar::end_of_month_day(year,month);<br>      date endOfMonth(year,month,eom_day);<br><br>      //构造一个迭代器，从该月的第一天开始<br>      day_iterator ditr(date(year,month,1));<br>      //loop thru the days and print each one<br>      for (; ditr &lt;= endOfMonth; ++ditr) {<br>  #if defined(BOOST_DATE_TIME_NO_LOCALE) <br>        std::cout &lt;&lt; to_simple_string(*ditr) &lt;&lt; " ["<br>  #else<br>        std::cout &lt;&lt; *ditr &lt;&lt; " ["<br>  #endif<br>                  &lt;&lt; ditr-&gt;day_of_week() &lt;&lt; "]"<br>                  &lt;&lt; std::endl; <br>      }<br>    }<br>    catch(std::exception&amp; e) {<br><br>      std::cout &lt;&lt; "Error bad date, check your entry: \n"<br>                &lt;&lt; "  Details: " &lt;&lt; e.what() &lt;&lt; std::endl;<br>    }<br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.month_add"></a>月份加法</h3>


</div>


</div>


</div>



<p>不使用迭代器，将一个月加到某天上。
  </p>



<pre class="programlisting">    <br>  /* 本程序使用格里历来步进刚好一个月，无论这个月有多少天。<br>   *<br>   * 本方法可作为迭代器之外的另一个选择<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main()<br>  {<br><br>    using namespace boost::gregorian;<br><br>    date d = day_clock::local_day();<br>    add_month mf(1);<br>    date d2 = d + mf.get_offset(d);<br>    std::cout &lt;&lt; "Today is: " &lt;&lt; to_simple_string(d) &lt;&lt; ".\n"<br>      &lt;&lt; "One month from today will be: " &lt;&lt; to_simple_string(d2) <br>      &lt;&lt; std::endl;<br><br>    return 0;<br>  }<br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.time_math"></a>时间的算术</h3>


</div>


</div>


</div>



<p>时间和时长的多种运算。  
  </p>



<pre class="programlisting">    <br>  /* 有关时间的构造和运算的一些简单例子<br>   * 输出：<br>   * 2002-Feb-01 00:00:00 - 2002-Feb-01 05:04:02.001000000 = -5:04:02.001000000<br>   */<br><br>  #include "boost/date_time/posix_time/posix_time.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main() <br>  {<br>    using namespace boost::posix_time;<br>    using namespace boost::gregorian;<br><br>    date d(2002,Feb,1); //任意一个日期<br>    //通过加上一个时长来构造一个时间<br>    ptime t1(d, hours(5)+minutes(4)+seconds(2)+millisec(1));<br>    //通过减去一个时间来构造新的时间<br>    ptime t2 = t1 - hours(5)- minutes(4)- seconds(2)- millisec(1);<br>    //构造一个表示两个时间的差距的时长<br>    time_duration td = t2 - t1;<br>      <br>    std::cout &lt;&lt; to_simple_string(t2) &lt;&lt; " - " <br>              &lt;&lt; to_simple_string(t1) &lt;&lt; " = "<br>              &lt;&lt; to_simple_string(td) &lt;&lt; std::endl;<br>    <br>    return 0;<br>  }<br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.print_hours"></a>打印小时</h3>


</div>


</div>


</div>



<p>示范时间迭代器，时钟取回，以及简单的运算。 
  </p>



<pre class="programlisting">    <br>  /* 打印一天中剩余的小时<br>   * 使用时钟取出本地时间<br>   * 使用一个迭代器来遍历剩余的小时<br>   * 从时间中取出日期部分<br>   *<br>   * 期望的输出如下：<br>   *<br>   * 2002-Mar-08 16:30:59<br>   * 2002-Mar-08 17:30:59<br>   * 2002-Mar-08 18:30:59<br>   * 2002-Mar-08 19:30:59<br>   * 2002-Mar-08 20:30:59<br>   * 2002-Mar-08 21:30:59<br>   * 2002-Mar-08 22:30:59<br>   * 2002-Mar-08 23:30:59<br>   * Time left till midnight: 07:29:01<br>   */<br><br>  #include "boost/date_time/posix_time/posix_time.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main() <br>  {<br>    using namespace boost::posix_time;<br>    using namespace boost::gregorian;<br><br>    //从时钟取出当前时间 -- 秒解析度<br>    ptime now = second_clock::local_time();<br>    //取出时间的日期部分<br>    date today = now.date();<br>    date tommorrow = today + days(1);<br>    ptime tommorrow_start(tommorrow); //午夜 <br><br>    //迭代器，每次加一个小时<br>    time_iterator titr(now,hours(1)); <br>    for (; titr &lt; tommorrow_start; ++titr) {<br>      std::cout &lt;&lt; to_simple_string(*titr) &lt;&lt; std::endl;<br>    }<br>    <br>    time_duration remaining = tommorrow_start - now;<br>    std::cout &lt;&lt; "Time left till midnight: " <br>              &lt;&lt; to_simple_string(remaining) &lt;&lt; std::endl;<br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.local_utc_conversion"></a>本地时间到 UTC 的转换</h3>


</div>


</div>


</div>



<p>示范 utc 到本地时间以及本地时间到 utc 的转换，包括 dst.
  </p>



<pre class="programlisting">    <br><br>  /* 示范在本地时间和 utc 之间的转换<br>   * 输出：<br>   * <br>   * UTC &lt;--&gt; New York while DST is NOT active (5 hours)<br>   * 2001-Dec-31 19:00:00 in New York is 2002-Jan-01 00:00:00 UTC time <br>   * 2002-Jan-01 00:00:00 UTC is 2001-Dec-31 19:00:00 New York time <br>   * <br>   * UTC &lt;--&gt; New York while DST is active (4 hours)<br>   * 2002-May-31 20:00:00 in New York is 2002-Jun-01 00:00:00 UTC time <br>   * 2002-Jun-01 00:00:00 UTC is 2002-May-31 20:00:00 New York time <br>   * <br>   * UTC &lt;--&gt; Arizona (7 hours)<br>   * 2002-May-31 17:00:00 in Arizona is 2002-Jun-01 00:00:00 UTC time <br>   */<br><br>  #include "boost/date_time/posix_time/posix_time.hpp"<br>  #include "boost/date_time/local_time_adjustor.hpp"<br>  #include "boost/date_time/c_local_time_adjustor.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main() <br>  {<br>    using namespace boost::posix_time;<br>    using namespace boost::gregorian;<br><br>    //本地时间调整器取决于机器的 TZ 设置 -- 高度危险！<br>    typedef boost::date_time::c_local_adjustor&lt;ptime&gt; local_adj;<br>    ptime t10(date(2002,Jan,1), hours(7)); <br>    ptime t11 = local_adj::utc_to_local(t10);<br>    std::cout &lt;&lt; "UTC &lt;--&gt; Zone base on TZ setting" &lt;&lt; std::endl;<br>    std::cout &lt;&lt; to_simple_string(t11) &lt;&lt; " in your TZ is " <br>              &lt;&lt; to_simple_string(t10) &lt;&lt; " UTC time "<br>              &lt;&lt; std::endl;<br>    time_duration td = t11 - t10;<br>    std::cout &lt;&lt; "A difference of: " <br>              &lt;&lt; to_simple_string(td) &lt;&lt; std::endl;<br><br><br>    //东部时区为 utc-5<br>    typedef boost::date_time::local_adjustor&lt;ptime, -5, us_dst&gt; us_eastern;<br><br>    ptime t1(date(2001,Dec,31), hours(19)); //纽约时间的午夜前5个小时<br><br>    std::cout &lt;&lt; "\nUTC &lt;--&gt; New York while DST is NOT active (5 hours)" <br>              &lt;&lt; std::endl;<br>    ptime t2 =  us_eastern::local_to_utc(t1);<br>    std::cout &lt;&lt; to_simple_string(t1) &lt;&lt; " in New York is " <br>              &lt;&lt; to_simple_string(t2) &lt;&lt; " UTC time "<br>              &lt;&lt; std::endl;<br><br>    ptime t3 = us_eastern::utc_to_local(t2);//转换回去，应该相同<br>    std::cout &lt;&lt; to_simple_string(t2) &lt;&lt; " UTC is " <br>              &lt;&lt; to_simple_string(t3) &lt;&lt; " New York time "<br>              &lt;&lt; "\n\n";<br><br>    ptime t4(date(2002,May,31), hours(20)); //纽约时间的午夜前4个小时<br>    std::cout &lt;&lt; "UTC &lt;--&gt; New York while DST is active (4 hours)" &lt;&lt; std::endl;<br>    ptime t5 = us_eastern::local_to_utc(t4);<br>    std::cout &lt;&lt; to_simple_string(t4) &lt;&lt; " in New York is " <br>              &lt;&lt; to_simple_string(t5) &lt;&lt; " UTC time "<br>              &lt;&lt; std::endl;<br><br>    ptime t6 = us_eastern::utc_to_local(t5);//转换回去，应该相同<br>    std::cout &lt;&lt; to_simple_string(t5) &lt;&lt; " UTC is " <br>              &lt;&lt; to_simple_string(t6) &lt;&lt; " New York time "<br>              &lt;&lt; "\n" &lt;&lt; std::endl;<br><br>      <br>    //亚利桑那时区为 utc-7 无 dst<br>    typedef boost::date_time::local_adjustor&lt;ptime, -7, no_dst&gt; us_arizona;<br><br>    ptime t7(date(2002,May,31), hours(17)); <br>    std::cout &lt;&lt; "UTC &lt;--&gt; Arizona (7 hours)" &lt;&lt; std::endl;<br>    ptime t8 = us_arizona::local_to_utc(t7);<br>    std::cout &lt;&lt; to_simple_string(t7) &lt;&lt; " in Arizona is " <br>              &lt;&lt; to_simple_string(t8) &lt;&lt; " UTC time "<br>              &lt;&lt; std::endl;<br><br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.time_periods"></a>时间段</h3>


</div>


</div>


</div>



<p>示范有关时间段的一些简单使用。 
  </p>



<pre class="programlisting">    <br><br>  /* 有关构造和计算时间的一些简单例子<br>   * 返回：<br>   * [2002-Feb-01 00:00:00/2002-Feb-01 23:59:59.999999999] <br>   * contains 2002-Feb-01 03:00:05<br>   * [2002-Feb-01 00:00:00/2002-Feb-01 23:59:59.999999999] <br>   * intersected with<br>   * [2002-Feb-01 00:00:00/2002-Feb-01 03:00:04.999999999] <br>   * is <br>   * [2002-Feb-01 00:00:00/2002-Feb-01 03:00:04.999999999]<br>   */<br><br>  #include "boost/date_time/posix_time/posix_time.hpp"<br>  #include &lt;iostream&gt;<br><br>  using namespace boost::posix_time;<br>  using namespace boost::gregorian;<br><br>  //创建一个简单的 period 类，包括一天中的所有时间<br>  class day_period : public time_period<br>  {<br>  public:<br>    day_period(date d) : time_period(ptime(d),//午夜<br>                                     ptime(d,hours(24)))<br>    {}<br><br>  };<br><br>  int<br>  main() <br>  {<br><br>    date d(2002,Feb,1); //任意一天<br>    //表示一天的时间段<br>    day_period dp(d);<br>    ptime t(d, hours(3)+seconds(5)); //那天的任意一个时间<br>    if (dp.contains(t)) {<br>      std::cout &lt;&lt; to_simple_string(dp) &lt;&lt; " contains "<br>                &lt;&lt; to_simple_string(t)  &lt;&lt; std::endl;<br>    }<br>    //表示一天的一部分的时间段<br>    time_period part_of_day(ptime(d, hours(0)), t);<br>    //计算两个时间的段的交集并打印结果<br>    if (part_of_day.intersects(dp)) {<br>      time_period result = part_of_day.intersection(dp);<br>      std::cout &lt;&lt; to_simple_string(dp) &lt;&lt; " intersected with\n"<br>                &lt;&lt; to_simple_string(part_of_day) &lt;&lt; " is \n"<br>                &lt;&lt; to_simple_string(result) &lt;&lt; std::endl;<br>    }<br>      <br>    <br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.simple_time_zone"></a>简单的时区</h3>


</div>


</div>


</div>



<p>使用 custom_time_zone 和 posix_time_zone 的例子。
  </p>



<pre class="programlisting">    <br>  /* 使用 custom_time_zone 和 posix_time_zone 的简单例子。<br>   */<br><br>  #include "boost/date_time/local_time/local_time.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main() <br>  {<br>    using namespace boost;<br>    using namespace local_time;<br>    using namespace gregorian;<br>    using posix_time::time_duration;<br><br>    /***** custom_time_zone *****/<br>    <br>    // 为 custom_time_zone 创建相关的对象<br>    time_zone_names tzn("Eastern Standard Time", "EST",<br>                        "Eastern Daylight Time", "EDT");<br>    time_duration utc_offset(-5,0,0);<br>    dst_adjustment_offsets adj_offsets(time_duration(1,0,0), <br>                                       time_duration(2,0,0), <br>                                       time_duration(2,0,0));<br>    // 本时区的夏时制规则是：<br>    // 从四月第一个星期天的 2 am 开始<br>    // 到十月最后一个星期天的 2 am 结束<br>    // 所以我们使用 first_last_dst_rule<br>    first_day_of_the_week_in_month start_rule(Sunday, Apr);<br>    last_day_of_the_week_in_month    end_rule(Sunday, Oct);<br>    shared_ptr&lt;dst_calc_rule&gt; nyc_rules(new first_last_dst_rule(start_rule, <br>                                                                end_rule));<br>    // 为无夏时制的 custom_time_zone 创建更多的相关对象<br>    time_zone_names tzn2("Mountain Standard Time", "MST",<br>                         "", ""); // 无 dst 使用空的 dst 字符串<br>    time_duration utc_offset2(-7,0,0);<br>    dst_adjustment_offsets adj_offsets2(time_duration(0,0,0), <br>                                        time_duration(0,0,0), <br>                                        time_duration(0,0,0));<br>    // 无 dst 意味着我们需要空指针来表示规则<br>    shared_ptr&lt;dst_calc_rule&gt; phx_rules;<br><br>    // 创建 custom_time_zones<br>    time_zone_ptr nyc_1(new custom_time_zone(tzn, utc_offset, <br>                                             adj_offsets, nyc_rules));<br>    time_zone_ptr phx_1(new custom_time_zone(tzn2, utc_offset2, <br>                                             adj_offsets2, phx_rules));<br><br>    /***** posix_time_zone *****/<br><br>    // 创建以上 custom_time_zones 的复制品 posix_time_zones.<br>    // 有关时区名的更多细节请见 posix_time_zone 文档。<br>    std::string nyc_string, phx_string;<br>    nyc_string = "EST-05:00:00EDT+01:00:00,M4.1.0/02:00:00,M10.5.0/02:00:00";<br>    // nyc_string = "EST-05EDT,M4.1.0,M10.5.0"; // 使用缺省值时更短<br>    phx_string = "MST-07"; // 无 dst<br>    time_zone_ptr nyc_2(new posix_time_zone(nyc_string));<br>    time_zone_ptr phx_2(new posix_time_zone(phx_string));<br>   <br><br>    /***** 显示两个设置相等 *****/<br><br>    std::cout &lt;&lt; "The first zone is in daylight savings from:\n " <br>      &lt;&lt; nyc_1-&gt;dst_local_start_time(2004) &lt;&lt; " through "<br>      &lt;&lt; nyc_1-&gt;dst_local_end_time(2004) &lt;&lt; std::endl;<br><br>    std::cout &lt;&lt; "The second zone is in daylight savings from:\n " <br>      &lt;&lt; nyc_2-&gt;dst_local_start_time(2004) &lt;&lt; " through "<br>      &lt;&lt; nyc_2-&gt;dst_local_end_time(2004) &lt;&lt; std::endl;<br><br>    std::cout &lt;&lt; "The third zone (no daylight savings):\n " <br>      &lt;&lt; phx_1-&gt;std_zone_abbrev() &lt;&lt; " and "<br>      &lt;&lt; phx_1-&gt;base_utc_offset() &lt;&lt; std::endl;<br><br>    std::cout &lt;&lt; "The fourth zone (no daylight savings):\n " <br>      &lt;&lt; phx_2-&gt;std_zone_abbrev() &lt;&lt; " and "<br>      &lt;&lt; phx_2-&gt;base_utc_offset() &lt;&lt; std::endl;<br><br>    return 0;<br>  }<br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.calc_rules"></a>夏时制计算规则</h3>


</div>


</div>


</div>



<p>创建多个夏时制计算规则对象的例子。
  </p>



<pre class="programlisting">    <br>  /* 一个简单例子，创建多个 dst_calc_rule 实例<br>   */<br><br>  #include "boost/date_time/gregorian/gregorian.hpp"<br>  #include "boost/date_time/local_time/local_time.hpp"<br>  #include &lt;iostream&gt;<br><br>  int<br>  main() <br>  {<br>    using namespace boost;<br>    using namespace local_time;<br>    using namespace gregorian;<br><br>    /***** 创建所需的 date_generator 对象 *****/<br>    // 开始日期生成器<br>    first_day_of_the_week_in_month fd_start(Sunday, May);<br>    last_day_of_the_week_in_month ld_start(Sunday, May);<br>    nth_day_of_the_week_in_month nkd_start(nth_day_of_the_week_in_month::third, <br>                                           Sunday, May);<br>    partial_date pd_start(1, May);<br>    // 结束日期生成器<br>    first_day_of_the_week_in_month fd_end(Sunday, Oct);<br>    last_day_of_the_week_in_month ld_end(Sunday, Oct);<br>    nth_day_of_the_week_in_month nkd_end(nth_day_of_the_week_in_month::third, <br>                                         Sunday, Oct);<br>    partial_date pd_end(31, Oct);<br><br>    /***** 创建多个 dst_calc_rule 对象 *****/<br>    dst_calc_rule_ptr pdr(new partial_date_dst_rule(pd_start, pd_end));<br>    dst_calc_rule_ptr flr(new first_last_dst_rule(fd_start, ld_end));<br>    dst_calc_rule_ptr llr(new last_last_dst_rule(ld_start, ld_end));<br>    dst_calc_rule_ptr nlr(new nth_last_dst_rule(nkd_start, ld_end));<br>    dst_calc_rule_ptr ndr(new nth_day_of_the_week_in_month_dst_rule(nkd_start, <br>                                                                    nkd_end));<br><br>    return 0;<br>  }<br><br>    <br>  </pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.flight"></a>飞行时间例子</h3>


</div>


</div>


</div>



<p>本例示范了如何计算飞机从凤凰城飞到纽约的到达时间。在飞行中，纽约恰好转入了夏时制(因为亚利桑那州不使用夏时制，所以凤凰城也不使用)。</p>



<pre class="programlisting"><code class="literal"><br><span class="preprocessor">#include</span><span class="string"> "boost/date_time/local_time/local_time.hpp"</span><span class="preprocessor"><br>#include</span><span class="special"> &lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span><span class="comment"><br><br>/* 本例示范了如何计算飞机从凤凰城飞到纽约的到达时间。在飞行中，纽约刚好转入夏时制<br> * </span></code><code class="literal"><span class="comment">(因为亚利桑那州不使用夏时制，所以凤凰也不使用</span></code><code class="literal"><span class="comment">)。  <br> *<br> * <br> */</span><span class="keyword"><br><br>int</span><span class="identifier"> main</span><span class="special">()</span><span class="special"><br>{</span><span class="keyword"><br>  using</span><span class="keyword"> namespace</span><span class="identifier"> boost</span><span class="special">::</span><span class="identifier">gregorian</span><span class="special">;</span><span class="keyword"> <br>  using</span><span class="keyword"> namespace</span><span class="identifier"> boost</span><span class="special">::</span><span class="identifier">local_time</span><span class="special">;</span><span class="keyword"><br>  using</span><span class="keyword"> namespace</span><span class="identifier"> boost</span><span class="special">::</span><span class="identifier">posix_time</span><span class="special">;</span><span class="comment"><br><br><br>  //设置一些时区，以创建和调整本地时间<br>  //从 libs/date_time/data 查找可由用户编辑的文件<br></span><span class="identifier">  tz_database</span><span class="identifier"> tz_db</span><span class="special">;</span><span class="identifier"><br>  tz_db</span><span class="special">.</span><span class="identifier">load_from_file</span><span class="special">(</span><span class="string">"date_time_zonespec.csv"</span><span class="special">);</span><span class="identifier"><br>  time_zone_ptr</span><span class="identifier"> nyc_tz</span><span class="special"> =</span><span class="identifier"> tz_db</span><span class="special">.</span><span class="identifier">time_zone_from_region</span><span class="special">(</span><span class="string">"America/New_York"</span><span class="special">);</span><span class="comment"><br></span><span class="identifier">  time_zone_ptr</span><span class="identifier"> phx_tz</span><span class="special">(</span><span class="keyword">new</span><span class="identifier"> posix_time_zone</span><span class="special">(</span><span class="string">"MST-07:00:00"</span><span class="special">));</span><span class="comment"><br><br></span></code><code class="literal"><span class="comment">  //使用凤凰城的本地时间作为出发时间<br></span><span class="identifier"></span></code><code class="literal"><span class="comment">  // 11 pm on april 2 2005 <br>  // (纽约将在 apr 3 的 2 am 转入夏时制)<br></span><span class="identifier">  local_date_time</span><span class="identifier"> phx_departure</span><span class="special">(</span><span class="identifier">date</span><span class="special">(</span><span class="number">2005</span><span class="special">,</span><span class="identifier"> Apr</span><span class="special">,</span><span class="number"> 2</span><span class="special">),</span><span class="identifier"> hours</span><span class="special">(</span><span class="number">23</span><span class="special">),</span><span class="identifier"> <br>                                phx_tz</span><span class="special">,</span><span class="identifier"> <br>                                local_date_time</span><span class="special">::</span><span class="identifier">NOT_DATE_TIME_ON_ERROR</span><span class="special">);</span><span class="identifier">

  time_duration</span><span class="identifier"> flight_length</span><span class="special"> =</span><span class="identifier"> hours</span><span class="special">(</span><span class="number">4</span><span class="special">)</span><span class="special"> +</span><span class="identifier"> minutes</span><span class="special">(</span><span class="number">30</span><span class="special">);</span><span class="identifier">
  local_date_time</span><span class="identifier"> phx_arrival</span><span class="special"> =</span><span class="identifier"> phx_departure</span><span class="special"> +</span><span class="identifier"> flight_length</span><span class="special">;</span><span class="identifier">
  local_date_time</span><span class="identifier"> nyc_arrival</span><span class="special"> =</span><span class="identifier"> phx_arrival</span><span class="special">.</span><span class="identifier">local_time_in</span><span class="special">(</span><span class="identifier">nyc_tz</span><span class="special">);</span><span class="identifier">

  std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "departure phx time: "</span><span class="special"> &lt;&lt;</span><span class="identifier"> phx_departure</span><span class="special"> &lt;&lt;</span><span class="identifier"> std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="identifier">
  std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "arrival phx time:   "</span><span class="special"> &lt;&lt;</span><span class="identifier"> phx_arrival</span><span class="special"> &lt;&lt;</span><span class="identifier"> std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="identifier">
  std</span><span class="special">::</span><span class="identifier">cout</span><span class="special"> &lt;&lt;</span><span class="string"> "arrival nyc time:   "</span><span class="special"> &lt;&lt;</span><span class="identifier"> nyc_arrival</span><span class="special"> &lt;&lt;</span><span class="identifier"> std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span><span class="special">

}</span>
</code>
</pre>



</div>



<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.examples.seconds_since_epoch"></a>从纪元起计的秒数</h3>


</div>


</div>


</div>



<p>这个例子使用 local_date_time 计算从纪元(1970-Jan-1)以来的秒数。
  </p>



<pre class="programlisting">    <br>  /* 本例示范了使用时区数据库和本地时间来计算从 UTC<br>   * time_t 纪元 1970-01-01 00:00:00 起计的秒数。注意选用的时区<br>   * 可以是时区数据库文件中支持的任意时区，该数据库文件可由用户修改和更新。<br>   *<br>   * 为解决这个问题，需要以下步骤：<br>   * 1) 从 tz 数据库中取出本地时间的时区<br>   * 2) 使用该时区构造一个本地时间<br>   * 3) 为 time_t 纪元时间构造一个 posix_time::ptime<br>   * 4) 将 local_time 转换为 utc 并减去纪元时间<br>   * <br>   */<br><br>  #include "boost/date_time/local_time/local_time.hpp"<br>  #include &lt;iostream&gt;<br><br>  int main()<br>  {<br>    using namespace boost::gregorian; <br>    using namespace boost::local_time;<br>    using namespace boost::posix_time;<br>    <br>    tz_database tz_db;<br>    try {<br>      tz_db.load_from_file("../data/date_time_zonespec.csv");<br>    }catch(data_not_accessible dna) {<br>      std::cerr &lt;&lt; "Error with time zone data file: " &lt;&lt; dna.what() &lt;&lt; std::endl;<br>      exit(EXIT_FAILURE);<br>    }catch(bad_field_count bfc) {<br>      std::cerr &lt;&lt; "Error with time zone data file: " &lt;&lt; bfc.what() &lt;&lt; std::endl;<br>      exit(EXIT_FAILURE);<br>    }<br><br>    time_zone_ptr nyc_tz = tz_db.time_zone_from_region("America/New_York");<br>    date in_date(2004,10,04);<br>    time_duration td(12,14,32);<br>    // 构造本地时间值<br>    // 如果无效则创建 not-a-date-time (如：在夏时制转换中)<br>    local_date_time nyc_time(in_date, <br>                             td, <br>                             nyc_tz, <br>                             local_date_time::NOT_DATE_TIME_ON_ERROR);<br><br>    std::cout &lt;&lt; nyc_time &lt;&lt; std::endl;<br><br>    ptime time_t_epoch(date(1970,1,1)); <br>    std::cout &lt;&lt; time_t_epoch &lt;&lt; std::endl;<br><br>    // 通过 utc_time() 将 nyc_time 转换为 utc 并减去 ptime.<br>    time_duration diff = nyc_time.utc_time() - time_t_epoch;<br><br>    //正确结果 1096906472<br>    std::cout &lt;&lt; "Seconds diff: " &lt;&lt; diff.total_seconds() &lt;&lt; std::endl;<br><br>  }<br>    <br>  </pre>



</div>



</div>



<table width="100%">


  <tbody>


    <tr>



      <td align="left"></td>



      <td align="right"><small>Copyright &copy; 2001-2005 CrystalClear Software, Inc</small></td>



    </tr>


  
  
  </tbody>
</table>



<hr>
<div class="spirit-nav">
<a accesskey="p" href="details.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../date_time.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="doxy.html"><img src="../images/next.png" alt="Next"></a>
</div>



</body>
</html>
