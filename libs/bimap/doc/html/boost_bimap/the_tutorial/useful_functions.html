<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Useful functions</title>

<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="../../index.html" title="Chapter&nbsp;1.&nbsp;Boost.Bimap">
<link rel="up" href="../the_tutorial.html" title="The tutorial">
<link rel="prev" href="differences_with_standard_maps.html" title="Differences with standard maps">
<link rel="next" href="bimaps_with_user_defined_names.html" title="Bimaps with user defined names"></head>
<body style="color: black; background-color: white;" alink="#0000ff" link="#0000ff" vlink="#840084">
<table cellpadding="2" width="100%">
<tbody>
<tr>
<td valign="top"><img alt="Boost C++ Libraries" src="../../../../../../boost.png" height="86" width="277"></td>
<td align="center"><a href="../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/people/people.htm">People</a></td>
<td align="center"><a href="http://www.boost.org/more/faq.htm">FAQ</a></td>
<td align="center"><a href="../../../../../../more/index.htm">More</a></td>
</tr>
</tbody>
</table>
<hr>
<div class="spirit-nav"><a accesskey="p" href="differences_with_standard_maps.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../the_tutorial.html"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="bimaps_with_user_defined_names.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="boost_bimap.the_tutorial.useful_functions"></a><a class="link" href="useful_functions.html" title="Useful functions">Useful functions 有用的函数</a>
</h3>
</div>
</div>
</div>
<div class="toc">
<dl>
<dt><span class="section"><a href="useful_functions.html#boost_bimap.the_tutorial.useful_functions.projection_of_iterators">Projection
of iterators 迭代器的投射</a></span></dt>
<dt><span class="section"><a href="useful_functions.html#boost_bimap.the_tutorial.useful_functions.replace_and_modify">replace
and modify 替换和修改</a></span></dt>
<dt><span class="section"><a href="useful_functions.html#boost_bimap.the_tutorial.useful_functions.retrieval_of_ranges">Retrieval
of ranges 区间的取回</a></span></dt>
</dl>
</div>
<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="boost_bimap.the_tutorial.useful_functions.projection_of_iterators"></a><a class="link" href="useful_functions.html#boost_bimap.the_tutorial.useful_functions.projection_of_iterators" title="Projection of iterators">Projection of iterators 有用的函数</a>
</h4>
</div>
</div>
</div>
<p> Iterators can be projected to any of the three views of the
bimap. A bimap provides three member functions to cope with projection:
<code class="computeroutput"><span class="identifier">project_left</span></code>,
<code class="computeroutput"><span class="identifier">project_right</span></code>
and <code class="computeroutput"><span class="identifier">project_up</span></code>,
with projects iterators to the <span class="emphasis"><em>left
map view</em></span>, the <span class="emphasis"><em>right
map view</em></span> and the <span class="emphasis"><em>collection
of relations view</em></span>. These functions take any
iterator from the bimap and retrieve an iterator over the projected
view pointing to the same element.</p>
<p>迭代器可以被投射到 bimap 的三个视图中的任一个。bimap 提供了三个成员函数来执行投射：<code class="computeroutput"><span class="identifier">project_left</span></code>,
<code class="computeroutput"><span class="identifier">project_right</span></code>
和 <code class="computeroutput"><span class="identifier">project_up</span></code>,
分别将迭代器投射到 <span class="emphasis"><em>左映射视图、右映射视图</em></span><span class="emphasis"><em></em></span> 和 <span class="emphasis"><em>关系组合视图</em></span>。这些函
数从 bimap 接受一个迭代器，并返回一个指向同一元素的被投射视图的迭代器。 </p>
<p> Here is an example that uses projection:&nbsp;</p>
<p>以下是一个使用投射的例子：</p>
<p> <a href="../../../../example/projection.cpp" target="_top">Go to source code 察看源代码</a></p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">,</span><span class="identifier">multiset_of</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">greater</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;</span> <span class="special">&gt;</span> <span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="string">"John"</span> <span class="special">,</span><span class="number">34</span><span class="special">)</span> <span class="special">);</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="string">"Peter"</span><span class="special">,</span><span class="number">24</span><span class="special">)</span> <span class="special">);</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="string">"Mary"</span> <span class="special">,</span><span class="number">12</span><span class="special">)</span> <span class="special">);</span><br><span class="comment">// Find the name of the next younger person after Peter<br>// 查找比 Peter 年轻的下一个人的名字<br></span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_const_iterator</span> <span class="identifier">name_iter</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">find</span><span class="special">(</span><span class="string">"Peter"</span><span class="special">);</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">right_const_iterator</span> <span class="identifier">years_iter</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">project_right</span><span class="special">(</span><span class="identifier">name_iter</span><span class="special">);</span><br><span class="special">++</span><span class="identifier">years_iter</span><span class="special">;</span><br><span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"The next younger person after Peter is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">years_iter</span><span class="special">-&gt;</span><span class="identifier">second</span><span class="special">;</span>
</pre>
<p> </p>
<p> </p>
</div>
<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="boost_bimap.the_tutorial.useful_functions.replace_and_modify"></a><a class="link" href="useful_functions.html#boost_bimap.the_tutorial.useful_functions.replace_and_modify" title="replace and modify">replace and modify 替换和修改</a>
</h4>
</div>
</div>
</div>
<p> These functions are members of the views of a bimap that are
not founded in their standard counterparts.</p>
<p>这些函数是 bimap 视图的成员函数，但在标准的对照物中是没有的。 </p>
<p> The <code class="computeroutput"><span class="identifier">replace</span></code> family
member functions performs in-place replacement of a given element as
the following example shows:</p>
<p><code class="computeroutput"><span class="identifier">replace</span></code>
族成员函数对一个综合元素执行就地替换，如下列所示： </p>
<p> <a href="../../../../example/tutorial_modify_and_replace.cpp" target="_top">Go to source code 察看源代码</a></p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span> <span class="keyword">int</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="number">1</span><span class="special">,</span><span class="string">"one"</span><span class="special">)</span> <span class="special">);</span><br><span class="comment">// Replace (1,"one") with (1,"1") using the right map view<br>// 用右映射视图以</span><span class="comment">(1,"1")</span><span class="comment">替换</span><span class="comment">(1,"one")</span><span class="comment"> <br></span><span class="special">{</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">right_iterator</span> <span class="identifier">it</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">find</span><span class="special">(</span><span class="string">"one"</span><span class="special">);</span><br><span class="keyword">bool</span> <span class="identifier">successful_replace</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">replace_key</span><span class="special">(</span> <span class="identifier">it</span><span class="special">,</span> <span class="string">"1"</span> <span class="special">);</span><br><span class="identifier">assert</span><span class="special">(</span> <span class="identifier">successful_replace</span> <span class="special">);</span><br><span class="special">}</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="number">2</span><span class="special">,</span><span class="string">"two"</span><span class="special">)</span> <span class="special">);</span><br><span class="comment">// Fail to replace (1,"1") with (1,"two") using the left map view<br>// 用左映射视图</span><span class="comment">以</span><span class="comment">(1,"1")</span><span class="comment">替换</span><span class="comment">(1,"one")</span><span class="comment">，失败 <br></span><span class="special">{</span><br><span class="identifier">assert</span><span class="special">(</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="number">2</span> <span class="special">);</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">it</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">find</span><span class="special">(</span><span class="number">1</span><span class="special">);</span><br><span class="keyword">bool</span> <span class="identifier">successful_replace</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">replace_data</span><span class="special">(</span> <span class="identifier">it</span><span class="special">,</span> <span class="string">"two"</span> <span class="special">);</span>
<span class="line_callout_bug"><a class="co" name="boost_bimap9co" href="useful_functions.html#boost_bimap9"><img src="../../images/callouts/1.png" alt="1" border="0"></a></span><span class="identifier">assert</span><span class="special">(</span> <span class="special">!</span> <span class="identifier">successful_replace</span> <span class="special">);</span><br><span class="identifier">assert</span><span class="special">(</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="number">2</span> <span class="special">);</span><br><span class="special">}</span>
</pre>
<p> </p>
<p> </p>
<p> </p>
<div class="calloutlist">
<table summary="Callout list" border="0">
<tbody>
<tr>
<td align="left" valign="top" width="5%">
<p><a name="boost_bimap9"></a><a href="#boost_bimap9co"><img src="../../images/callouts/1.png" alt="1" border="0"></a>
</p>
</td>
<td align="left" valign="top">
<p> <code class="computeroutput"><span class="identifier">it</span></code> is still
valid here, and the bimap was left unchanged<code class="computeroutput"><span class="identifier"></span></code></p>
<p><code class="computeroutput"><span class="identifier">it</span></code> 仍然有效，而 bimap
保持不变 </p>
</td>
</tr>
</tbody>
</table>
</div>
<p> <code class="computeroutput"><span class="identifier">replace</span></code>
functions performs this substitution in such a manner that:<code class="computeroutput"><span class="identifier"></span></code></p>
<p><code class="computeroutput"><span class="identifier">replace</span></code>
函数按以下方式执行替换： </p>
<div class="itemizedlist">
<ul type="disc">
<li> The complexity is constant time if the changed element
retains its original order with respect to all views; it is logarithmic
otherwise. <br>如果被替换元素对于所有视图都保持原有顺序，则复杂度为常量时间；否则为对数时间。 </li>
<li> Iterator and reference validity are preserved. <br>迭代器和引用的有效性被保持。 </li>
<li> The operation is strongly exception-safe, i.e. the <code class="computeroutput"><span class="identifier">bimap</span></code>
remains unchanged if some exception (originated by the system or the
user's data types) is thrown. <br>该操作是强异常安全的，即如果有异常抛出(由系统或用户数据类型产生)，则 <code class="computeroutput"><span class="identifier">bimap</span></code> 保持不变。 </li>
</ul>
</div>
<p> <code class="computeroutput"><span class="identifier">replace</span></code>
functions are powerful operations not provided by standard STL
containers, and one that is specially handy when strong
exception-safety is required.</p><p><code class="computeroutput"><span class="identifier">replace</span></code>
函数是标准STL容器没有提供的强大操作，当需要强异常安全时，它尤其方便。 </p>
<p> The observant reader might have noticed that the convenience
of replace comes at a cost: namely the whole element has to be copied <span class="emphasis"><em>twice</em></span> to
do the updating (when retrieving it and inside <code class="computeroutput"><span class="identifier">replace</span></code>).
If elements are expensive to copy, this may be quite a computational
cost for the modification of just a tiny part of the object. To cope
with this situation, Boost.Bimap provides an alternative updating
mechanism: <code class="computeroutput"><span class="identifier">modify</span></code>
functions.&nbsp;</p><p>细心的读者可能已经注意到，替换操作的方便性是有代价的：即在进行更新时，整个元素必须被复制两次(一次取出，一次内部 <code class="computeroutput"><span class="identifier">replace</span></code>)。如果元素的复制很昂贵，那么即使是对对象的一小部分进行修改也需要较大的代价。为了应付这一情况，Boost.Bimap 提供了另一个更新机制：<code class="computeroutput"><span class="identifier">modify</span></code> 函数。</p>
<p> <code class="computeroutput"><span class="identifier">modify</span></code>
functions accepts a functor (or pointer to function) taking a reference
to the data to be changed, thus eliminating the need for spurious
copies. Like <code class="computeroutput"><span class="identifier">replace</span></code>
functions, <code class="computeroutput"><span class="identifier">modify</span></code>
functions does preserve the internal orderings of all the indices of
the <code class="computeroutput"><span class="identifier">bimap</span></code>. However,
the semantics of modify functions are not entirely equivalent to
replace functions. Consider what happens if a collision occurs as a
result of modifying the element, i.e. the modified element clashes with
another with respect to some unique view. In the case of <code class="computeroutput"><span class="identifier">replace</span></code>
functions, the original value is kept and the method returns without
altering the container, but <code class="computeroutput"><span class="identifier">modify</span></code>
functions cannot afford such an approach, since the modifying functor
leaves no trace of the previous value of the element. Integrity
constraints thus lead to the following policy: when a collision happens
in the process of calling a modify functions, the element is erased and
the method returns false. This difference in behavior between <code class="computeroutput"><span class="identifier">replace</span></code>
and <code class="computeroutput"><span class="identifier">modify</span></code>
functions has to be considered by the programmer on a case-by-case
basis.</p><p><code class="computeroutput"><span class="identifier">modify</span></code> 函数接受一个函数对象(或函数指针)和一个被修改数据的引用，从而消除多余的复制。象&nbsp;<code class="computeroutput"><span class="identifier">replace</span></code> 函数一样，<code class="computeroutput"><span class="identifier">modify</span></code> 函数保持&nbsp;<code class="computeroutput"><span class="identifier">bimap</span></code> 的所有索引的内部有序性。但是，修改函数的语义并不完全等同于替换函数。考虑一下如果修改某个元素会发生冲突，即修改后的元素与某个唯一视图的另一个元素冲突，那么会发生什么？在&nbsp;<code class="computeroutput"><span class="identifier">replace</span></code> 函数中，原值将被保留，函数返回时没有对容器进行修改，而&nbsp;<code class="computeroutput"><span class="identifier">modify</span></code> 函数则不提供这一方式，因为修改用的函数对象并没有保存元素的原来值。所以，完整性约束将导致以下策略：在调用修改函数的过程中如果发生冲突，被修改元素将被删除而函数返回 false。<code class="computeroutput"><span class="identifier">replace</span></code> 和 <code class="computeroutput"><span class="identifier">modify</span></code>&nbsp;函数间的行为差异必须由程序员根据实际情况来考虑使用。 </p>
<p> Boost.Bimap defines new placeholders named <code class="computeroutput"><span class="identifier">_key</span></code>
and <code class="computeroutput"><span class="identifier">_data</span></code> to allow
a sounder solution. You have to include <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">bimap</span><span class="special">/</span><span class="identifier">support</span><span class="special">/</span><span class="identifier">lambda</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code> to use
them.</p><p> Boost.Bimap 定义了新的占位符 <code class="computeroutput"><span class="identifier">_key</span></code> 和 <code class="computeroutput"><span class="identifier">_data</span></code>，以提供更漂亮的解决方案。要使用它们，你必须包含 <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">bimap</span><span class="special">/</span><span class="identifier">support</span><span class="special">/</span><span class="identifier">lambda</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>. </p>


<p> <a href="../../../../example/tutorial_modify_and_replace.cpp" target="_top">Go to source code 察看源代码</a>&nbsp;</p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span> <span class="keyword">int</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="number">1</span><span class="special">,</span><span class="string">"one"</span><span class="special">)</span> <span class="special">);</span><br><span class="comment">// Modify (1,"one") to (1,"1") using the right map view<br>// 用右映射视图将</span><span class="comment">(1,"one")修改为(1,"1")</span><span class="comment"> <br></span><span class="special">{</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">right_iterator</span> <span class="identifier">it</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">find</span><span class="special">(</span><span class="string">"one"</span><span class="special">);</span><br><span class="keyword">bool</span> <span class="identifier">successful_modify</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">right</span><span class="special">.</span><span class="identifier">modify_key</span><span class="special">(</span> <span class="identifier">it</span> <span class="special">,</span> <span class="identifier">_key</span> <span class="special">=</span> <span class="string">"1"</span> <span class="special">);</span><br><span class="identifier">assert</span><span class="special">(</span> <span class="identifier">successful_modify</span> <span class="special">);</span><br><span class="special">}</span><br><span class="identifier">bm</span><span class="special">.</span><span class="identifier">insert</span><span class="special">(</span> <span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">value_type</span><span class="special">(</span><span class="number">2</span><span class="special">,</span><span class="string">"two"</span><span class="special">)</span> <span class="special">);</span><br><span class="comment">// Fail to modify (1,"1") to (1,"two") using the left map view<br>// 用左映射视图将</span><span class="comment">(1,"one")修改为(1,"1")，失败</span><span class="comment"> <br></span><span class="special">{</span><br><span class="identifier">assert</span><span class="special">(</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="number">2</span> <span class="special">);</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">it</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">find</span><span class="special">(</span><span class="number">1</span><span class="special">);</span><br><span class="keyword">bool</span> <span class="identifier">successful_modify</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">modify_data</span><span class="special">(</span> <span class="identifier">it</span><span class="special">,</span> <span class="identifier">_data</span> <span class="special">=</span> <span class="string">"two"</span> <span class="special">);</span>
<span class="line_callout_bug"><a class="co" name="boost_bimap10co" href="useful_functions.html#boost_bimap10"><img src="../../images/callouts/1.png" alt="1" border="0"></a></span><span class="identifier">assert</span><span class="special">(</span> <span class="special">!</span> <span class="identifier">successful_modify</span> <span class="special">);</span><br><span class="identifier">assert</span><span class="special">(</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="number">1</span> <span class="special">);</span><br><span class="special">}</span>
</pre>
<p> </p>
<p> </p>
<p> </p>
<div class="calloutlist">
<table summary="Callout list" border="0">
<tbody>
<tr>
<td align="left" valign="top" width="5%">
<p><a name="boost_bimap10"></a><a href="#boost_bimap10co"><img src="../../images/callouts/1.png" alt="1" border="0"></a>
</p>
</td>
<td align="left" valign="top">
<p> <code class="computeroutput"><span class="identifier">it</span></code> is not
longer valid and <code class="computeroutput"><span class="special">(</span><span class="number">1</span><span class="special">,</span><span class="string">"1"</span><span class="special">)</span></code> is removed from
the bimap<code class="computeroutput"><span class="identifier"></span></code></p><p><code class="computeroutput"><span class="identifier">it</span></code> 不再有效，而 <code class="computeroutput"><span class="special">(</span><span class="number">1</span><span class="special">,</span><span class="string">"1"</span><span class="special">)</span></code> 被从 bimap 中删除 </p>
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p> </p>
</div>
<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="boost_bimap.the_tutorial.useful_functions.retrieval_of_ranges"></a><a class="link" href="useful_functions.html#boost_bimap.the_tutorial.useful_functions.retrieval_of_ranges" title="Retrieval of ranges">Retrieval of ranges 区间的取回</a>
</h4>
</div>
</div>
</div>
<p> Standard <code class="computeroutput"><span class="identifier">lower_bound</span></code> and
<code class="computeroutput"><span class="identifier">upper_bound</span></code>
functions can be used to lookup for all the elements in a given range.</p><p>标准的 <code class="computeroutput"><span class="identifier">lower_bound</span></code> 和
<code class="computeroutput"><span class="identifier">upper_bound</span></code>
函数可以用于给定范围的所有元素。 </p>
<p> Suppose we want to retrieve the elements from a <code class="computeroutput"><span class="identifier">bimap</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span></code> where the
left value is in the range <code class="computeroutput"><span class="special">[</span><span class="number">20</span><span class="special">,</span><span class="number">50</span><span class="special">]</span></code> </p>
<p> 假设我们想从一个 <code class="computeroutput"><span class="identifier">bimap</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span></code> 中取出范围为 <code class="computeroutput"><span class="special">[</span><span class="number">20</span><span class="special">,</span><span class="number">50</span><span class="special">]</span></code> 的左值<code class="computeroutput"><span class="special"></span></code></p>
<p> </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="comment">// ...<br></span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">iter_first</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">lower_bound</span><span class="special">(</span><span class="number">20</span><span class="special">);</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">iter_second</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">upper_bound</span><span class="special">(</span><span class="number">50</span><span class="special">);</span><br><span class="comment">// range [iter_first,iter_second) contains the elements in [20,50]<br>// 区间</span><span class="comment"> [iter_first,iter_second) 包含了 [20,50]</span><span class="comment"> 中的元素</span></pre>
<p> </p>

<p> Subtle changes to the code are required when strict
inequalities are considered. To retrieve the elements greater than 20
and less than 50, the code has to be rewritten as </p>
<p> 如果要求严格的不等性，则需要一些修改。比如，要取出大于20小于50的元素，代码要改为 </p>
<p> </p>
<pre class="programlisting"><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">iter_first</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">upper_bound</span><span class="special">(</span><span class="number">20</span><span class="special">);</span><br><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_iterator</span> <span class="identifier">iter_second</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">lower_bound</span><span class="special">(</span><span class="number">50</span><span class="special">);</span><br><span class="comment">// range [iter_first,iter_second) contains the elements in (20,50)</span><br><span class="comment">// 区间</span><span class="comment"> [iter_first,iter_second) 包含了 (20,50)</span><span class="comment"> 中的元素</span></pre>
<p> </p>

<p> To add to this complexity, the careful programmer has to take
into account that the lower and upper bounds of the interval searched
be compatible: for instance, if the lower bound is 50 and the upper
bound is 20, the iterators <code class="computeroutput"><span class="identifier">iter_first</span></code> and <code class="computeroutput"><span class="identifier">iter_second</span></code>
produced by the code above will be in reverse order, with possibly
catastrophic results if a traversal from <code class="computeroutput"><span class="identifier">iter_first</span></code>
to <code class="computeroutput"><span class="identifier">iter_second</span></code> is
tried. All these details make range searching a tedious and error prone
task.</p><p>由于增加了这一复杂性，细心的程序员必须考虑查找区间的下界和上界必须兼容：例如，如果下界是50是上界是20，则以上代码产生的迭代器 <code class="computeroutput"><span class="identifier">iter_first</span></code> 和 <code class="computeroutput"><span class="identifier">iter_second</span></code> 是反序的，如果尝试从 <code class="computeroutput"><span class="identifier">iter_first</span></code> 到 <code class="computeroutput"><span class="identifier">iter_second</span></code> 进行遍历，就可能产生空难性的后果。所有这些细节使得区间查找成为了一件乏味而易错的工作。 </p>
<p> The range member function, often in combination with lambda
expressions, can greatly help alleviate this situation: </p>
<p> range 成员函数，通常与 lambda 表达式一起使用，可以极大地避免这一情形：</p>
<p> </p>
<pre class="programlisting"><span class="keyword">typedef</span> <span class="identifier">bimap</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">&gt;</span> <span class="identifier">bm_type</span><span class="special">;</span><br><span class="identifier">bm_type</span> <span class="identifier">bm</span><span class="special">;</span><br><span class="comment">// ...<br></span><br><span class="line_callout_bug"><a class="co" name="boost_bimap11co" href="useful_functions.html#boost_bimap11"><img src="../../images/callouts/1.png" alt="1" border="0"></a></span><span class="identifier">bm_type</span><span class="special">::</span><span class="identifier">left_range_type</span> <span class="identifier">r</span><span class="special">;</span>
<span class="line_callout_bug"><a class="co" name="boost_bimap12co" href="useful_functions.html#boost_bimap12"><img src="../../images/callouts/2.png" alt="2" border="0"></a></span><span class="identifier">r</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">range</span><span class="special">(</span> <span class="number">20</span> <span class="special">&lt;=</span> <span class="identifier">_key</span><span class="special">,</span> <span class="identifier">_key</span> <span class="special">&lt;=</span> <span class="number">50</span> <span class="special">);</span> <span class="comment">// [20,50]<br></span><br><span class="identifier">r</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">range</span><span class="special">(</span> <span class="number">20</span> <span class="special">&lt;</span> <span class="identifier">_key</span><span class="special">,</span> <span class="identifier">_key</span> <span class="special">&lt;</span> <span class="number">50</span> <span class="special">);</span> <span class="comment">// (20,50)<br></span><br><span class="identifier">r</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">range</span><span class="special">(</span> <span class="number">20</span> <span class="special">&lt;=</span> <span class="identifier">_key</span><span class="special">,</span> <span class="identifier">_key</span> <span class="special">&lt;</span> <span class="number">50</span> <span class="special">);</span> <span class="comment">// [20,50)<br></span></pre>
<p> </p>
<p> </p>
<p> </p>
<div class="calloutlist">
<table summary="Callout list" border="0">
<tbody>
<tr>
<td align="left" valign="top" width="5%">
<p><a name="boost_bimap11"></a><a href="#boost_bimap11co"><img src="../../images/callouts/1.png" alt="1" border="0"></a>
</p>
</td>
<td align="left" valign="top">
<p> <code class="computeroutput"><span class="identifier">range_type</span></code> is a
handy typedef equal to <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">iterator</span><span class="special">,</span><span class="identifier">iterator</span><span class="special">&gt;</span></code>. <code class="computeroutput"><span class="identifier">const_range_type</span></code>
is provided too, and it is equal to <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">const_iterator</span><span class="special">,</span><span class="identifier">const_iterator</span><span class="special">&gt;</span><br><span class="identifier">range_type</span></code> 是一个 typedef，相当于 <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">iterator</span><span class="special">,</span><span class="identifier">iterator</span><span class="special">&gt;</span></code>. <code class="computeroutput"><span class="identifier">const_range_type</span></code>
也提供了，相当于 <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">const_iterator</span><span class="special">,</span><span class="identifier">const_iterator</span><span class="special">&gt;</span></code> </p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a name="boost_bimap12"></a><a href="#boost_bimap12co"><img src="../../images/callouts/2.png" alt="2" border="0"></a>
</p>
</td>
<td align="left" valign="top">
<p> _key is a Boost.Lambda placeholder. To use it you have
to include <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">bimap</span><span class="special">/</span><span class="identifier">support</span><span class="special">/</span><span class="identifier">lambda</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code></p><p><code class="computeroutput"><span class="special"></span></code> _key 是一个 Boost.Lambda 占位符。要使用它，你必须包含 <code class="computeroutput"><span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">bimap</span><span class="special">/</span><span class="identifier">support</span><span class="special">/</span><span class="identifier">lambda</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code> </p>
</td>
</tr>
</tbody>
</table>
</div>


<p> <br><code class="computeroutput"><span class="identifier">range</span></code> simply
accepts predicates specifying the lower and upper bounds of the
interval searched. Please consult the reference for a detailed
explanation of the permissible predicates passed to range.</p><p><code class="computeroutput"><span class="identifier">range</span></code> 只接受用于指定被查找区间的下界和上界的谓词。有关传递给 range 的可用谓词的详细解释，请看相关参考。 </p>
<p> One or both bounds can be omitted with the special unbounded
marker: </p>
<p> 单个或两个边界均可通过特定的 unbounder 符号来省略：</p>
<p> </p>
<pre class="programlisting"><span class="identifier">r</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">range</span><span class="special">(</span> <span class="number">20</span> <span class="special">&lt;=</span> <span class="identifier">_key</span><span class="special">,</span> <span class="identifier">unbounded</span> <span class="special">);</span> <span class="comment">// [20,inf)<br></span><br><span class="identifier">r</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">range</span><span class="special">(</span> <span class="identifier">unbounded</span> <span class="special">,</span> <span class="identifier">_key</span> <span class="special">&lt;</span> <span class="number">50</span> <span class="special">);</span> <span class="comment">// (-inf,50)<br></span><br><span class="line_callout_bug"><a class="co" name="boost_bimap13co" href="useful_functions.html#boost_bimap13"><img src="../../images/callouts/1.png" alt="1" border="0"></a></span><span class="identifier">r</span> <span class="special">=</span> <span class="identifier">bm</span><span class="special">.</span><span class="identifier">left</span><span class="special">.</span><span class="identifier">range</span><span class="special">(</span> <span class="identifier">unbounded</span> <span class="special">,</span> <span class="identifier">unbounded</span> <span class="special">);</span> <span class="comment">// (-inf,inf)<br></span></pre>
<p> </p>
<p> </p>
<p> </p>
<div class="calloutlist">
<table summary="Callout list" border="0">
<tbody>
<tr>
<td align="left" valign="top" width="5%">
<p><a name="boost_bimap13"></a><a href="#boost_bimap13co"><img src="../../images/callouts/1.png" alt="1" border="0"></a>
</p>
</td>
<td align="left" valign="top">
<p> This is equivalent to std::make_pair(s.begin(),s.end())</p><p> 等价于 std::make_pair(s.begin(),s.end())
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p> <a href="../../../../example/tutorial_range.cpp" target="_top">Go to source code 察看源代码</a> </p>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%">
<tbody>
<tr>
<td align="left"></td>
<td align="right">
<div class="copyright-footer">Copyright © 2006 -2007
Matias Capeletto
<p> Distributed under the Boost Software License, Version
1.0. (See accompanying file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
</p>
</div>
</td>
</tr>
</tbody>
</table>
<hr>
<div class="spirit-nav"><a accesskey="p" href="differences_with_standard_maps.html"><img src="../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../the_tutorial.html"><img src="../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="bimaps_with_user_defined_names.html"><img src="../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body></html>