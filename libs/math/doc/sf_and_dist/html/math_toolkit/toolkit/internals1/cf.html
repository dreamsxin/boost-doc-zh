<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Continued Fraction Evaluation</title><link rel="stylesheet" href="../../../../../../../../doc/html/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_2006-12-17_0120">
<link rel="start" href="../../../index.html" title="Math Toolkit">
<link rel="up" href="../internals1.html" title="Reused Utilities">
<link rel="prev" href="series_evaluation.html" title="Series Evaluation">
<link rel="next" href="rational.html" title="Polynomial and Rational Function Evaluation"></head>
<body alink="#0000ff" bgcolor="white" link="#0000ff" text="black" vlink="#840084">
<table cellpadding="2" width="100%"><tbody><tr>
<td valign="top"><img alt="Boost C++ Libraries" src="../../../../../../../../boost.png" height="86" width="277"></td>
<td align="center"><a href="../../../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../../../more/index.htm">More</a></td>
</tr></tbody></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="series_evaluation.html"><img src="../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../internals1.html"><img src="../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="rational.html"><img src="../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div>
  <h4 class="title">
<a name="math_toolkit.toolkit.internals1.cf"></a><a href="cf.html" title="Continued Fraction Evaluation"> 连分数计算(Continued Fraction
        Evaluation)</a>
</h4>
</div></div></div>
<a name="math_toolkit.toolkit.internals1.cf.synopsis"></a>
<h5>
<a name="id775234"></a>
          <a href="cf.html#math_toolkit.toolkit.internals1.cf.synopsis">概要</a>
  </h5>
<p>
          
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">math</span><span class="special">/</span><span class="identifier">tools</span><span class="special">/</span><span class="identifier">fraction</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
  </p>
<pre class="programlisting"><span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">{</span> <span class="keyword">namespace</span> <span class="identifier">math</span><span class="special">{</span> <span class="keyword">namespace</span> <span class="identifier">tools</span><span class="special">{</span><br><br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">U</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_b</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">U</span><span class="special">&amp;</span> <span class="identifier">tolerance</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">uintmax_t</span><span class="special">&amp;</span> <span class="identifier">max_terms</span><span class="special">)</span><br><br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">U</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_b</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">U</span><span class="special">&amp;</span> <span class="identifier">tolerance</span><span class="special">)</span><br><br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">U</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_a</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">U</span><span class="special">&amp;</span> <span class="identifier">tolerance</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">uintmax_t</span><span class="special">&amp;</span> <span class="identifier">max_terms</span><span class="special">)</span><br><br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">,</span> <span class="keyword">class</span> <span class="identifier">U</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_a</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">U</span><span class="special">&amp;</span> <span class="identifier">tolerance</span><span class="special">)</span><br><br><span class="comment">//<br></span><span class="comment">// These interfaces are present for legacy reasons, and are now deprecated:<br></span><span class="comment">//<br></span><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_b</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">bits</span><span class="special">);</span><br><br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_b</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">bits</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">uintmax_t</span><span class="special">&amp;</span> <span class="identifier">max_terms</span><span class="special">);</span><br><br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_a</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">bits</span><span class="special">);</span><br>   <br><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">Gen</span><span class="special">&gt;</span><br><span class="keyword">typename</span> <span class="identifier">detail</span><span class="special">::</span><span class="identifier">fraction_traits</span><span class="special">&lt;</span><span class="identifier">Gen</span><span class="special">&gt;::</span><span class="identifier">result_type</span> <br>   <span class="identifier">continued_fraction_a</span><span class="special">(</span><span class="identifier">Gen</span><span class="special">&amp;</span> <span class="identifier">g</span><span class="special">,</span> <span class="keyword">int</span> <span class="identifier">bits</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">uintmax_t</span><span class="special">&amp;</span> <span class="identifier">max_terms</span><span class="special">);</span><br>   <br><span class="special">}}}</span> <span class="comment">// namespaces</span><span class="comment"><br></span></pre>
<a name="math_toolkit.toolkit.internals1.cf.description"></a>
<h5>
<a name="id775955"></a>
          <a href="cf.html#math_toolkit.toolkit.internals1.cf.description">说明</a>
  </h5>
<p>
          <a href="http://en.wikipedia.org/wiki/Continued_fraction" target="_top">连分数是逼近的一种常见方法. </a> 这些函数都计算用<span class="emphasis"><em>generator</em></span>
          类型参数描述的连分数。带有"_a" 后缀的函数计算下面的分数(fraction)：</p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/fraction2.png"></span>
  </p>
<p>
          带有"_b" 后缀的函数计算下面的分数(fraction)：</p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/fraction1.png"></span>
  </p>
<p>
          后一种形式更自然一些，因为它对应于连分数一般的定义，但请注意由生成器(generator)返回的第一个<span class="emphasis"><em>a</em></span>
  值被忽略了。另外，在连分数中开始的<span class="emphasis"><em> a</em></span> 和 <span class="emphasis"><em>b</em></span> 值对于剩余的项具有不同的定义方程，这使得具有“_a”后缀的形式更加合适。</p>
<p>
  生成器(generator)的类型应当是满足下列操作的函数对象：</p>
<div class="informaltable"><table class="table">
<colgroup><col><col></colgroup>
<thead><tr>
<th>
                <p>
                  表达式</p>
          </th>
<th>
                <p>
                  说明</p>
          </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  Gen::result_type
                </p>
          </td>
<td>
                <p>
                  这个类型是调用 operator()的返回值的类型。这可以是一个算术类型，也可以是一个算术类型的 std::pair&lt;&gt; 。 </p>
          </td>
</tr>
<tr>
<td>
                <p>
                  g()
                </p>
          </td>
<td>
                <p>
                  返回一个 Gen::result_type类型的对象。</p>
                <p>
                  每次调用这个操作符，返回下一对a和b值。或者，如果 result_type
                是一个算术类型，那么返回下一个b值，且所有的a值假定为1。</p>
          </td>
</tr>
</tbody>
</table></div><p>在所有的连分数计算函数中，参数 <span class="emphasis"><em>tolerance</em></span><span class="emphasis"><em></em></span>
  是结果中的精度，连分数的计算持续到结果的相对误差小于 <span class="emphasis"><em>tolerance</em></span>&nbsp;为止。旧的接口在此接受一个精度位数，在内部，它们只是将此转换为一个tolerance并前转调用。</p>
<p> 如果指定了可选的参数<span class="emphasis"><em>max_terms</em></span> ，那么不会进行超过<span class="emphasis"><em>max_terms</em></span> 次对生成器(generator)的调用，并且在输出的时候，<span class="emphasis"><em>max_terms</em></span> 将被设置为实际调用的次数。这个特性在为连分数的收敛绘图时很有用。</p>
<a name="math_toolkit.toolkit.internals1.cf.implementation"></a>
<h5>
<a name="id776231"></a>
          <a href="cf.html#math_toolkit.toolkit.internals1.cf.implementation">实现</a>
  </h5>
<p>
          在内部实现中，这些算法将会使用修正的 Lentz algorithm：参考 Numeric Recipes in C++, W. H. Press et all, chapter 5, (especially 5.2
          Evaluation of continued fractions, p 175 - 179)了解更多信息，以及参考 W.J. 1976, Applied Optics, vol. 15, pp. 668-671。</p>
<a name="math_toolkit.toolkit.internals1.cf.examples"></a>
<h5>
<a name="id776265"></a>
          <a href="cf.html#math_toolkit.toolkit.internals1.cf.examples">例子</a>
  </h5>
<p>          <a href="http://en.wikipedia.org/wiki/Golden_ratio" target="_top">golden ratio
  phi = 1.618033989...</a> 可以使用最简单的连分数来计算：</p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/fraction3.png"></span>
  </p>
<p>
          我们开始定义生成函数(generator function)：</p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="keyword">struct</span> <span class="identifier">golden_ratio_fraction</span>
<span class="special">{</span>
   <span class="keyword">typedef</span> <span class="identifier">T</span> <span class="identifier">result_type</span><span class="special">;</span>
   
   <span class="identifier">result_type</span> <span class="keyword">operator</span><span class="special">()</span>
   <span class="special">{</span>
      <span class="keyword">return</span> <span class="number">1</span><span class="special">;</span>
   <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
          黄金分割点(golden ratio) 可以使用下面的方法计算到double精度： </p>
<pre class="programlisting"><span class="identifier">continued_fraction_a</span><span class="special">(</span>
   <span class="identifier">golden_ratio_fraction</span><span class="special">&lt;</span><span class="keyword">double</span><span class="special">&gt;(),</span><br>   <span class="identifier">std</span><span class="special">::</span><span class="identifier">numeric_limits</span><span class="special">&lt;</span><span class="keyword">double</span><span class="special">&gt;::</span><span class="identifier">epsilon</span><span class="special">());</span><span class="special"></span>
</pre>
<p>
          当通过连分数来计算特殊函数的时候，定义a和b是很有常见的。 例如 tan 函数定义为：</p>
<p>
          <span class="inlinemediaobject"><img src="../../../../equations/fraction4.png"></span>
  </p>
<p>
  因此，生成函数(generator function)可能像下面这样：</p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="keyword">struct</span> <span class="identifier">tan_fraction</span>
<span class="special">{</span>
<span class="keyword">private</span><span class="special">:</span>
   <span class="identifier">T</span> <span class="identifier">a</span><span class="special">,</span> <span class="identifier">b</span><span class="special">;</span>
<span class="keyword">public</span><span class="special">:</span>
   <span class="identifier">tan_fraction</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">v</span><span class="special">)</span>
      <span class="special">:</span> <span class="identifier">a</span><span class="special">(-</span><span class="identifier">v</span><span class="special">*</span><span class="identifier">v</span><span class="special">),</span> <span class="identifier">b</span><span class="special">(-</span><span class="number">1</span><span class="special">)</span>
   <span class="special">{}</span>

   <span class="keyword">typedef</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="identifier">result_type</span><span class="special">;</span>

   <span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="keyword">operator</span><span class="special">()()</span>
   <span class="special">{</span>
      <span class="identifier">b</span> <span class="special">+=</span> <span class="number">2</span><span class="special">;</span>
      <span class="keyword">return</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_pair</span><span class="special">(</span><span class="identifier">a</span><span class="special">,</span> <span class="identifier">b</span><span class="special">);</span>
   <span class="special">}</span>
<span class="special">};</span>
</pre>
<p>
  注意，如果连续从b项中减去，也就是这里的情况，那么由这个生成器函数(generator function)返回的所有的a项都是负数。tangent 函数现在可以通过下面的方法计算：</p>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span><br><span class="identifier">T</span> <span class="identifier">tan</span><span class="special">(</span><span class="identifier">T</span> <span class="identifier">a</span><span class="special">)</span><br><span class="special">{</span><br>   <span class="identifier">tan_fraction</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="identifier">fract</span><span class="special">(</span><span class="identifier">a</span><span class="special">);</span><br>   <span class="keyword">return</span> <span class="identifier">a</span> <span class="special">/</span> <span class="identifier">continued_fraction_b</span><span class="special">(</span><span class="identifier">fract</span><span class="special">,</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">numeric_limits</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">epsilon</span><span class="special">());</span><br><span class="special">}</span><span class="special"></span>
</pre>
<p>
  注意，这一次我们使用带有"_b" 后缀版本的计算函数：因为它与所有的其它项都不同，所以在计算的过程中我们删除了前导的a项。</p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tbody><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright ?2006 , 2007, 2008 John Maddock, Paul A. Bristow, Hubert
      Holin, Xiaogang Zhang and Bruno Lalande<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></tbody></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="series_evaluation.html"><img src="../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../internals1.html"><img src="../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../index.html"><img src="../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="rational.html"><img src="../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body></html>