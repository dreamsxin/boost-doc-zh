<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Negative Binomial Sales Quota Example.</title><link rel="stylesheet" href="../../../../../../../../../../doc/html/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot_2006-12-17_0120">
<link rel="start" href="../../../../../index.html" title="Math Toolkit">
<link rel="up" href="../neg_binom_eg.html" title="Negative Binomial Distribution Examples">
<link rel="prev" href="neg_binom_size_eg.html" title="Estimating Sample Sizes for the Negative Binomial.">
<link rel="next" href="negative_binomial_example2.html" title="Negative Binomial Table Printing Example."></head>
<body alink="#0000ff" bgcolor="white" link="#0000ff" text="black" vlink="#840084">
<table cellpadding="2" width="100%"><tbody><tr>
<td valign="top"><img alt="Boost C++ Libraries" src="../../../../../../../../../../boost.png" height="86" width="277"></td>
<td align="center"><a href="../../../../../../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../../../../../../more/index.htm">More</a></td>
</tr></tbody></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="neg_binom_size_eg.html"><img src="../../../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../neg_binom_eg.html"><img src="../../../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../../../index.html"><img src="../../../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="negative_binomial_example2.html"><img src="../../../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div>
  <h5 class="title">
<a name="math_toolkit.dist.stat_tut.weg.neg_binom_eg.negative_binomial_example1"></a><a href="negative_binomial_example1.html" title="Negative Binomial Sales Quota Example.">
            负二项销售限额(Negative Binomial Sales Quota)实例.</a>
</h5>
</div></div></div>
<p>
              例子程序<a href="../../../../../../../../example/negative_binomial_example1.cpp" target="_top">negative_binomial_example1.cpp
            (完整代码)</a> 例举了一个计算满足一定销售限额(sales quota)的概率的简单例子。</p>
<p>
  </p>
<p>
                基于<a href="http://en.wikipedia.org/wiki/Negative_binomial_distribution" target="_top">a
                problem by Dr. Diane Evans, Professor of Mathematics at Rose-Hulman
                Institute of Technology</a>.
  </p>
<p>
  </p>
<p> Pat 被要求去卖糖果棒(candy bars)来为六年级的field
trip赚钱。一共有30家邻居，并且在没有卖出5个糖果棒之前，假定Pat不会回家。所以Pat一家接一家地去卖糖果棒。在每一家，卖出一个糖果棒的概
率为0.4(40%)，而没有卖出糖果棒的概率为0.6(60%)。</p>
<p>
  </p>
<p>
  在第n家卖出最后一个(第五个)糖果棒的概率质量(密度)函数是多少？</p>
<p>
  </p>
<p>
                负二项分布(Negative Binomial(r, p) distribution)描述在最后一次试验为成功的k+r次伯努利试验(Bernoulli Trial)中有k次失败以及r次成功的概率。(<a href="http://en.wikipedia.org/wiki/Bernoulli_distribution" target="_top">伯努利试验(Bernoulli
                trial)</a> 是一个只有两个试验结果的试验，成功和失败，成功的概率为p)。参考：<a href="../../../../../" target="_top">http://en.wikipedia.org/wiki/Bernoulli_distribution
                Bernoulli distribution</a> 以及 <a href="http://www.math.uah.edu/stat/bernoulli/Introduction.xhtml" target="_top">Bernoulli
                applications</a>.
  </p>
<p>
  </p>
<p>
  在这个例子中，我们将有意进行多种计算和输出来举例说明如何使用这个库来实现负二项分布：并且也有意地进行了大量注释。</p>
<p>
  </p>
<p>
                首先我们需要 #define 宏来控制错误和离散处理策略。对于这个简单的例子，我们想要避免抛出异常(缺省策略)并仅仅是返回无限值。我们将这个离散的负二项分布当作连续分布来看待，因此我们选择一个real类型的
                discrete_quantile 策略，而不是缺省的策略
                integer_round_outwards。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="preprocessor">#define</span> <span class="identifier">BOOST_MATH_OVERFLOW_ERROR_POLICY</span> <span class="identifier">ignore_error</span>
<span class="preprocessor">#define</span> <span class="identifier">BOOST_MATH_DISCRETE_QUANTILE_POLICY</span> <span class="identifier">real</span></pre>
<p>
  </p>
<p>
  </p>
<p>
                在这之后，我们需要包含一些头文件来简化对负二项分布的访问： negative
                binomial distribution。</p>
<p>
  </p>
<div class="caution"><table summary="Caution" border="0">
<tbody><tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="../../../../../../../../../../doc/html/images/caution.png"></td>
<th align="left">注意</th>
</tr>
<tr><td align="left" valign="top"><p>
                  在上面的#define<span class="bold"><strong> 后面</strong></span> #include distributions 是非常重要的</p></td></tr>
</tbody></table></div>
<p>
  </p>
<p>
  并且，当然，我们需要一些标准输入输出。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">math</span><span class="special">/</span><span class="identifier">distributions</span><span class="special">/</span><span class="identifier">negative_binomial</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
  <span class="comment">//  为了使用negative_binomial_distribution<br></span>  <span class="keyword">using</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">negative_binomial</span><span class="special">;</span> <span class="comment">// typedef provides default type is double.<br></span>  <span class="keyword">using</span>  <span class="special">::</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">pdf</span><span class="special">;</span> <span class="comment">// 概率质量函数(Probability mass function).<br></span>  <span class="keyword">using</span>  <span class="special">::</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">cdf</span><span class="special">;</span> <span class="comment">// 累积分布函数(Cumulative density function).<br></span>  <span class="keyword">using</span>  <span class="special">::</span><span class="identifier">boost</span><span class="special">::</span><span class="identifier">math</span><span class="special">::</span><span class="identifier">quantile</span><span class="special">;</span>

<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>
  <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span><span class="special">;</span> <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">noshowpoint</span><span class="special">;</span> <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">fixed</span><span class="special">;</span> <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">right</span><span class="special">;</span> <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">left</span><span class="special">;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iomanip</span><span class="special">&gt;</span>
  <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">setprecision</span><span class="special">;</span> <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">setw</span><span class="special">;</span> <br><br><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">limits</span><span class="special">&gt;</span>
  <span class="keyword">using</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">numeric_limits</span><span class="special">;</span>
</pre>
<p>
  </p>
<p>
  </p>
<p>
  使用 try 和 catch 永远都是有意义的，因为在出现任何错误时，缺省的策略是抛出异常。</p>
<p>
  </p>
<p>
  一个简单的catch 代码块 (参见下面)将会确保你得到有用的出错信息而不是程序的意外退出。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="keyword">try</span>
<span class="special">{</span></pre>
<p>
  </p>
<p>
  </p>
<p>
                卖出5个糖果棒意味着要获得5次成功，因此试验成功数r = 5。总的试验数是(n， 在这种情况下， 是已经访问过的房子)
                 = 成功次数 + 失败次数 或者 k + r = k + 5。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="keyword">double</span> <span class="identifier">sales_quota</span> <span class="special">=</span> <span class="number">5</span><span class="special">;</span> <span class="comment">// Pat's 销售限额(sales quota) - successes (r).</span></pre>
<p>
  </p>
<p>
  </p>
<p>
  在每一家，卖出糖果棒的概率为 0.4 (40%) ，而没有卖出的概率为0.6(60%)。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="keyword">double</span> <span class="identifier">success_fraction</span> <span class="special">=</span> <span class="number">0.4</span><span class="special">;</span> <span class="comment">// success_fraction (p) - 因此 failure_fraction is 0.6.</span></pre>
<p>
  </p>
<p>
  </p>
<p>
                负二项分布(Negative Binomial(r, p) distribution)描述在最后一次试验为成功的k+r次伯努利试验(Bernoulli Trial)中有k次失败以及r次成功的概率。(<a href="http://en.wikipedia.org/wiki/Bernoulli_distribution" target="_top">伯努利试验(Bernoulli trial)</a> 是一个只有两个试验结果的试验，成功和失败，成功的概率为p)。</p>
<p>
  </p>
<p>
  因此我们以使用参数sales_quota (要求的成功次数)和成功的概率来构造一个负二项分布(negative binomial distribution)开始。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">negative_binomial</span> <span class="identifier">nb</span><span class="special">(</span><span class="identifier">sales_quota</span><span class="special">,</span> <span class="identifier">success_fraction</span><span class="special">);</span> <span class="comment">// 缺省为double类型.</span></pre>
<p>
  </p>
<p>
  </p>
<p>
  为了进一步证实，打印参数 success_fraction &amp; 分布的成功参数。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Pat has a sales per house success rate of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">success_fraction</span>
  <span class="special">&lt;&lt;</span> <span class="string">".\nTherefore he would, on average, sell "</span> <span class="special">&lt;&lt;</span> <span class="identifier">nb</span><span class="special">.</span><span class="identifier">success_fraction</span><span class="special">()</span> <span class="special">*</span> <span class="number">100</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars after trying 100 houses."</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">all_houses</span> <span class="special">=</span> <span class="number">30</span><span class="special">;</span> <span class="comment">// 在这个住宅区中的家庭数量.<br></span>
<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"With a success rate of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">nb</span><span class="special">.</span><span class="identifier">success_fraction</span><span class="special">()</span> <br>  <span class="special">&lt;&lt;</span> <span class="string">", he might expect, on average,\n"</span>
    <span class="string">"to need to visit about "</span> <span class="special">&lt;&lt;</span> <span class="identifier">success_fraction</span> <span class="special">*</span> <span class="identifier">all_houses</span>
    <span class="special">&lt;&lt;</span> <span class="string">" houses in order to sell all "</span> <span class="special">&lt;&lt;</span> <span class="identifier">nb</span><span class="special">.</span><span class="identifier">successes</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" bars. "</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Pat has a sales per house success rate of 0.4.<br>Therefore he would, on average, sell 40 bars after trying 100 houses.<br>With a success rate of 0.4, he might expect, on average,<br>to need to visit about 12 houses in order to sell all 5 bars. <br></pre>
<p>
  </p>
<p>
  随机变量是卖出5个糖果棒所必须访问的家庭数量，因此 将 k = n - 5 代入到 negative_binomial(5, 0.4)中并获得需要访问的房子数分布的<a href="../../../dist_ref/nmp.html#math.dist.pdf">概率质量(密度)函数 (pdf 或 pmf)</a> 。显然，最好的可能情况是Pat在最开始的5个家庭中卖出所有的糖果棒。</p>
<p>
  </p>
<p>
                我们使用函数 pdf 来计算： </p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes on the "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="string">"th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">5</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span> <span class="comment">// == pdf(nb, 0)</span></pre>
<p>
  </p>
<p>
  </p>
<p>
  当然，他不可能在少于5个家庭中卖出所有的糖果棒，因为他必须卖出5个糖果棒。因此第五个家庭是他可能卖出所有的糖果的第一个可能。</p>
<p>
  </p>
<p>
  为了在第八个家庭或在第八个家庭之前卖出所有的糖果棒，Pat必须在第5个，第6个，第7个，或第8个家庭卖出所有的糖果棒。他在某个家庭卖出所有的糖果棒的可能性是概率密度函数pdf。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes on the 6th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">6</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes on the 7th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">7</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes on the 8th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">8</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability that Pat finishes on the 6th house is 0.03072<br>Probability that Pat finishes on the 7th house is 0.055296<br>Probability that Pat finishes on the 8th house is 0.077414<br></pre>
<p>
  </p>
<p>
                在这些家庭中卖出所有的糖果棒的概率的和是累积分布函数(Cumulative Distribution
                Function)cdf。我们可以将单独的概率累加起来求得。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes on or before the 8th house is sum "</span>
  <span class="string">"\n"</span> <span class="special">&lt;&lt;</span> <span class="string">"pdf(sales_quota) + pdf(6) + pdf(7) + pdf(8) = "</span>
  <span class="comment">// Sum each of the mass/density probabilities for houses sales_quota = 5, 6, 7, &amp; 8.<br></span>  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">5</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="comment">// 0 failures.<br></span>    <span class="special">+</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">6</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="comment">// 1 failure.<br></span>    <span class="special">+</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">7</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="comment">// 2 failures.<br></span>    <span class="special">+</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">8</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="comment">// 3 failures.<br></span>  <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">pdf(sales_quota) + pdf(6) + pdf(7) + pdf(8) = 0.17367<br></pre>
<p>
  </p>
<p>
                或者，通常更好的方法，通过使用负二项分布累积函数( negative binomial <span class="bold"><strong>cumulative</strong></span>
                distribution function)。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability of selling his quota of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars\non or before the "</span> <span class="special">&lt;&lt;</span> <span class="number">8</span> <span class="special">&lt;&lt;</span> <span class="string">"th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">8</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability of selling his quota of 5 bars on or before the 8th house is 0.17367<br></pre>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability that Pat finishes exactly on the 10th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">10</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability of selling his quota of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars\non or before the "</span> <span class="special">&lt;&lt;</span> <span class="number">10</span> <span class="special">&lt;&lt;</span> <span class="string">"th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">10</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability that Pat finishes exactly on the 10th house is 0.10033<br>Probability of selling his quota of 5 bars on or before the 10th house is 0.3669<br></pre>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes exactly on the 11th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">11</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability of selling his quota of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars\non or before the "</span> <span class="special">&lt;&lt;</span> <span class="number">11</span> <span class="special">&lt;&lt;</span> <span class="string">"th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">11</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability that Pat finishes on the 11th house is 0.10033<br>Probability of selling his quota of 5 candy bars<br>on or before the 11th house is 0.46723<br></pre>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes exactly on the 12th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">12</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>

<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability of selling his quota of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars\non or before the "</span> <span class="special">&lt;&lt;</span> <span class="number">12</span> <span class="special">&lt;&lt;</span> <span class="string">"th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">12</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability that Pat finishes on the 12th house is 0.094596<br>Probability of selling his quota of 5 candy bars<br>on or before the 12th house is 0.56182<br></pre>
<p>
  </p>
<p>
  最后，考虑，在访问所有的家庭之后，Pat还是没能卖出所有的糖果棒的概率。计算他在最后一个家庭或最后一个家庭之前卖出所有的糖果棒的概率：计算他刚好在最后一个家庭卖出第五个糖果棒的概率。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability that Pat finishes on the "</span> <span class="special">&lt;&lt;</span> <span class="identifier">all_houses</span>
  <span class="special">&lt;&lt;</span> <span class="string">" house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">all_houses</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
  </p>
<p>
  在第30个家庭卖出第5个糖果棒的概率为：</p>
<p>
              
</p>
<pre class="programlisting">Probability that Pat finishes on the 30 house is 0.00069145<br></pre>
<p>
  </p>
<p>
  仅当他实在是太不走运的情况下!</p>
<p>当Pat已经访问了所有的30个家庭但是<span class="bold"><strong>仍然没有</strong></span> 卖出5个糖果棒的概率?</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability of selling his quota of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars\non or before the "</span> <span class="special">&lt;&lt;</span> <span class="identifier">all_houses</span> <span class="special">&lt;&lt;</span> <span class="string">"th house is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">all_houses</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability of selling his quota of 5 bars<br>on or before the 30th house is 0.99849<br></pre>
<p>
  </p>
<p>
                /*因此在访问了所有的家庭之后仍然没有卖出所有的糖果棒的概率为：<code class="computeroutput"><span class="number">1</span> <span class="special">-</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">all_houses</span> <span class="special">-</span> <span class="identifier">sales_quota)</span></code>，当使用这种方法时可能产生严重的不精确性，所能最好使用函数cdf的补集：因此在第31个家庭(不存在)或在第31个家庭之后还没有卖出所有的糖果棒的概率为<code class="computeroutput"><span class="programlisting"><span class="identifier">cdf</span><span class="special">(</span><span class="identifier">complement</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">all_houses</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">))</span></span></code>。<a href="../../overview/complements.html#why_complements">为什么有补集(Why complements)?</a>
  </p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nProbability of failing to sell his quota of "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span>
  <span class="special">&lt;&lt;</span> <span class="string">" bars\neven after visiting all "</span> <span class="special">&lt;&lt;</span> <span class="identifier">all_houses</span> <span class="special">&lt;&lt;</span> <span class="string">" houses is "</span>
  <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">complement</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">all_houses</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">))</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability of failing to sell his quota of 5 bars<br>even after visiting all 30 houses is 0.0015101<br></pre>
<p>
  </p>
<p>
                我们也可以计算分位点(quantile)，函数cdf的反函数，来预测Pat将会在哪个家庭卖出最后一个糖果棒。因此对于第8个家庭：</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="keyword">double</span> <span class="identifier">p</span> <span class="special">=</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="special">(</span><span class="number">8</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">));</span> <br><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Probability of meeting sales quota on or before 8th house is "</span><span class="special">&lt;&lt;</span> <span class="identifier">p</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">Probability of meeting sales quota on or before 8th house is 0.174<br></pre>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If the confidence of meeting sales quota is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">p</span>
    <span class="special">&lt;&lt;</span> <span class="string">", then the finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">p</span><span class="special">)</span> <span class="special">+</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>

<span class="identifier">cout</span><span class="special">&lt;&lt;</span> <span class="string">" quantile(nb, p) = "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">p</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">If the confidence of meeting sales quota is 0.17367, then the finishing house is 8<br></pre>
<p>
  </p>
<p>
  5个糖果棒都被卖出的严格绝对可能性(Demanding absolute certainty)，暗示着试验的总次数为无穷次。(当然，在这个住宅区仅有30个家庭，他甚至不能确定他可以卖出他的销售限额)。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If the confidence of meeting sales quota is "</span> <span class="special">&lt;&lt;</span> <span class="number">1.</span>
    <span class="special">&lt;&lt;</span> <span class="string">", then the finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">1</span><span class="special">)</span> <span class="special">+</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="comment">//  1.#INF == infinity.</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">If the confidence of meeting sales quota is 1, then the finishing house is 1.#INF<br></pre>
<p>
  </p>
<p>
  而且对于其它的相似情况的概率：</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If the confidence of meeting sales quota is "</span> <span class="special">&lt;&lt;</span> <span class="number">0.</span>
    <span class="special">&lt;&lt;</span> <span class="string">", then the finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">0.</span><span class="special">)</span> <span class="special">+</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>

<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If the confidence of meeting sales quota is "</span> <span class="special">&lt;&lt;</span> <span class="number">0.5</span>
    <span class="special">&lt;&lt;</span> <span class="string">", then the finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">0.5</span><span class="special">)</span> <span class="special">+</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>

<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If the confidence of meeting sales quota is "</span> <span class="special">&lt;&lt;</span> <span class="number">1</span> <span class="special">-</span> <span class="number">0.00151</span> <span class="comment">// 30 th<br></span>    <span class="special">&lt;&lt;</span> <span class="string">", then the finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="number">1</span> <span class="special">-</span> <span class="number">0.00151</span><span class="special">)</span> <span class="special">+</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">If the confidence of meeting sales quota is 0, then the finishing house is 5<br>If the confidence of meeting sales quota is 0.5, then the finishing house is 11.337<br>If the confidence of meeting sales quota is 0.99849, then the finishing house is 30<br></pre>
<p>
  </p>
<p>
  因为我们选择的是实数离散分位点策略(discrete quantile policy of real)，结果可能是一个“不真实”数值为小数的家庭数。</p>
<p>
  </p>
<p>
                如果假设的反面为真，我们不想假定任何把握( assume any confidence)，那么这就等价于所有的最开始的 sales_quota
  次试验都是成功的试验。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If confidence of meeting quota is zero\n(we assume all houses are successful sales)"</span> <br>  <span class="string">", then finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">If confidence of meeting quota is zero (we assume all houses are successful sales), then finishing house is 5<br>If confidence of meeting quota is 0, then finishing house is 5<br></pre>
<p>
  </p>
<p>
  我们可以列举一些概率的分位点(quantile)：</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"> <span class="keyword">double</span> <span class="identifier">ps</span><span class="special">[]</span> <span class="special">=</span> <span class="special">{</span><span class="number">0.</span><span class="special">,</span> <span class="number">0.001</span><span class="special">,</span> <span class="number">0.01</span><span class="special">,</span> <span class="number">0.05</span><span class="special">,</span> <span class="number">0.1</span><span class="special">,</span> <span class="number">0.5</span><span class="special">,</span> <span class="number">0.9</span><span class="special">,</span> <span class="number">0.95</span><span class="special">,</span> <span class="number">0.99</span><span class="special">,</span> <span class="number">0.999</span><span class="special">,</span> <span class="number">1.</span><span class="special">};</span>
 <span class="comment">// 把握为(Confidence) fraction = 1-alpha, as percent =  100 * (1-alpha[i]) %<br></span> <span class="identifier">cout</span><span class="special">.</span><span class="identifier">precision</span><span class="special">(</span><span class="number">3</span><span class="special">);</span>
 <span class="keyword">for</span> <span class="special">(</span><span class="keyword">int</span> <span class="identifier">i</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span> <span class="identifier">i</span> <span class="special">&lt;</span> <span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">ps</span><span class="special">)/</span><span class="keyword">sizeof</span><span class="special">(</span><span class="identifier">ps</span><span class="special">[</span><span class="number">0</span><span class="special">]);</span> <span class="identifier">i</span><span class="special">++)</span>
 <span class="special">{</span>
   <span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"If confidence of meeting quota is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">ps</span><span class="special">[</span><span class="identifier">i</span><span class="special">]</span>
     <span class="special">&lt;&lt;</span> <span class="string">", then finishing house is "</span> <span class="special">&lt;&lt;</span> <span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">ps</span><span class="special">[</span><span class="identifier">i</span><span class="special">])</span> <span class="special">+</span> <span class="identifier">sales_quota</span>
     <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">If confidence of meeting quota is 0, then finishing house is 5<br>If confidence of meeting quota is 0.001, then finishing house is 5<br>If confidence of meeting quota is 0.01, then finishing house is 5<br>If confidence of meeting quota is 0.05, then finishing house is 6.2<br>If confidence of meeting quota is 0.1, then finishing house is 7.06<br>If confidence of meeting quota is 0.5, then finishing house is 11.3<br>If confidence of meeting quota is 0.9, then finishing house is 17.8<br>If confidence of meeting quota is 0.95, then finishing house is 20.1<br>If confidence of meeting quota is 0.99, then finishing house is 24.8<br>If confidence of meeting quota is 0.999, then finishing house is 31.1<br>If confidence of meeting quota is 1, then finishing house is 1.#INF<br></pre>
<p>
  </p>
<p>
  我们使用一个向上舍入的函数来获得一个“最坏情况”下数值为整数的家庭数。</p>
<pre class="programlisting"><span class="identifier">ceil</span><span class="special">(</span><span class="identifier">quantile</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">ps</span><span class="special">[</span><span class="identifier">i</span><span class="special">]))</span></pre>
<p>
  </p>
<p>
  </p>
<p>
                如果我们通过省略下面的#define，我们就在使用缺省的离散分位点策略 integer_outside：</p>
<pre class="programlisting"><span class="preprocessor">#define</span> <span class="identifier">BOOST_MATH_DISCRETE_QUANTILE_POLICY</span> <span class="identifier">real</span></pre>
<p>
  我们也可以达到相同的效果。</p>
<p>
  </p>
<p>实际结果给出了最可能在哪个家庭卖出所有的糖果棒。例如，在具有95%把握(95% confidence)的条件下比较real和inter_outside。</p>
<p>
              
</p>
<pre class="programlisting">If confidence of meeting quota is 0.95, then finishing house is 20.1<br>If confidence of meeting quota is 0.95, then finishing house is 21<br></pre>
<p>
  </p>
<p>
                真实值为 20.1，比21相比更接近于20，因此 integer_outside
                的计算是悲观的( pessimistic)。我们也可以使用 integer_round_nearest 来建议 20 可能更有可能。</p>
<p>
  </p>
<p>
  最后，我们可以将在每个家庭刚好卖出最后一个糖果棒的概率制表。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nHouse for "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sales_quota</span> <span class="special">&lt;&lt;</span> <span class="string">"th (last) sale.  Probability (%)"</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="identifier">cout</span><span class="special">.</span><span class="identifier">precision</span><span class="special">(</span><span class="number">5</span><span class="special">);</span>
<span class="keyword">for</span> <span class="special">(</span><span class="keyword">int</span> <span class="identifier">i</span> <span class="special">=</span> <span class="special">(</span><span class="keyword">int</span><span class="special">)</span><span class="identifier">sales_quota</span><span class="special">;</span> <span class="identifier">i</span> <span class="special">&lt;</span> <span class="identifier">all_houses</span><span class="special">+</span><span class="number">1</span><span class="special">;</span> <span class="identifier">i</span><span class="special">++)</span>
<span class="special">{</span>
  <span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">left</span> <span class="special">&lt;&lt;</span> <span class="identifier">setw</span><span class="special">(</span><span class="number">3</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">i</span> <span class="special">&lt;&lt;</span> <span class="string">"                             "</span> <span class="special">&lt;&lt;</span> <span class="identifier">setw</span><span class="special">(</span><span class="number">8</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">cdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="identifier">i</span> <span class="special">-</span> <span class="identifier">sales_quota</span><span class="special">)</span>  <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
<span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
              
</p>
<pre class="programlisting">House for 5 th (last) sale.  Probability (%)<br>5                               0.01024 <br>6                               0.04096 <br>7                               0.096256<br>8                               0.17367 <br>9                               0.26657 <br>10                              0.3669  <br>11                              0.46723 <br>12                              0.56182 <br>13                              0.64696 <br>14                              0.72074 <br>15                              0.78272 <br>16                              0.83343 <br>17                              0.874   <br>18                              0.90583 <br>19                              0.93039 <br>20                              0.94905 <br>21                              0.96304 <br>22                              0.97342 <br>23                              0.98103 <br>24                              0.98655 <br>25                              0.99053 <br>26                              0.99337 <br>27                              0.99539 <br>28                              0.99681 <br>29                              0.9978  <br>30                              0.99849<br></pre>
<p>
  </p>
<p>
  就像上面提到的那样，使用catch 语句永远都是一个好主意，即使你不想使用它。</p>
<p>
  </p>
<p>
                
</p>
<pre class="programlisting"><span class="special">}</span>
<span class="keyword">catch</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">exception</span><span class="special">&amp;</span> <span class="identifier">e</span><span class="special">)</span>
<span class="special">{</span> <span class="comment">// 因为我们已经将溢出策略(overflow policy)设置为 ignore_error,<br></span>  <span class="comment">// 永远都不可能抛出溢出异常(overflow exception).<br></span>   <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\nMessage from thrown exception was:\n "</span> <span class="special">&lt;&lt;</span> <span class="identifier">e</span><span class="special">.</span><span class="identifier">what</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span></pre>
<p>
  </p>
<p>
  </p>
<p>
  例如，在没有忽略定义域错误的策略的情况下，如果我们调用：</p>
<pre class="programlisting"><span class="identifier">pdf</span><span class="special">(</span><span class="identifier">nb</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">)</span></pre>
<p>
                例如，我们将会到得下面的出错信息：</p>
<p>
              
</p>
<pre class="programlisting">Message from thrown exception was:<br> Error in function boost::math::pdf(const negative_binomial_distribution&lt;double&gt;&amp;, double):<br> Number of failures argument is -1, but must be &gt;= 0 !<br></pre>
<p>
  </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tbody><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright ?2006 , 2007, 2008 John Maddock, Paul A. Bristow, Hubert
      Holin, Xiaogang Zhang and Bruno Lalande<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></tbody></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="neg_binom_size_eg.html"><img src="../../../../../../../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../neg_binom_eg.html"><img src="../../../../../../../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../../../../index.html"><img src="../../../../../../../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="negative_binomial_example2.html"><img src="../../../../../../../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body></html>