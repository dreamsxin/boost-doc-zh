<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Reference &#21442;&#32771;&#25163;&#20876;</title>
<link rel="stylesheet" href="../../../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.75.2">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">
<link rel="prev" href="conf.html" title="Configuration &#37197;&#32622;">
<link rel="next" href="acknowledge.html" title="Acknowledge &#40483;&#35874;">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../../boost.png"></td>
<td align="center"><a href="../../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="conf.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="acknowledge.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="scope_exit.ref"></a> Reference &#21442;&#32771;&#25163;&#20876;</h2></div></div></div>
<a name="ref.boost_scope_exit"></a><h4>
<a name="id5098941"></a>
      BOOST_SCOPE_EXIT
    </h4>
<p>
      A <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> declaration has the following
      synopsis:<br> &#19968;&#20010; <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> &#22768;&#26126;&#20855;&#26377;&#20197;&#19979;&#35821;&#27861;&#65306;
    </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">scope_exit</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="identifier">BOOST_SCOPE_EXIT</span> <span class="special">(</span> <span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span> <span class="special">)</span>
    <span class="identifier">function</span><span class="special">-</span><span class="identifier">body</span>
<span class="identifier">BOOST_SCOPE_EXIT_END</span>
</pre>
<p>
      where<br> &#20854;&#20013;
    </p>
<pre class="programlisting"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span><span class="special">:</span>
    <span class="special">(</span> <span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span> <span class="special">)</span>
    <span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span> <span class="special">(</span> <span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span> <span class="special">)</span>

<span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">:</span>
    <span class="identifier">identifier</span>
    <span class="special">&amp;</span><span class="identifier">identifier</span>
</pre>
<p>
      The <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> declaration schedules an execution
      of <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>
      at the end of the current scope. The <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code> statements are executed in the reverse
      order of <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> declarations in the given
      scope. The scope must be local.<br> <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a>
      &#22768;&#26126;&#23558; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>
      &#30340;&#25191;&#34892;&#26102;&#38388;&#20998;&#37197;&#33267;&#24403;&#21069;&#20316;&#29992;&#22495;&#30340;&#32467;&#26463;&#22788;&#12290; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code> &#35821;&#21477;&#25353;&#32473;&#20316;&#29992;&#22495;&#20013;&#30340; <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a>
      &#22768;&#26126;&#30340;&#30456;&#21453;&#39034;&#24207;&#26469;&#25191;&#34892;&#12290;&#20316;&#29992;&#22495;&#24517;&#39035;&#26159;&#23616;&#37096;&#30340;&#12290;
    </p>
<p>
      Each <code class="computeroutput"><span class="identifier">identifier</span></code> in <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code> must
      be a valid name in enclosing scope and it must appear exactly once in the list.
      If a <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span></code>
      starts with the ampersand sign <code class="computeroutput"><span class="special">&amp;</span></code>,
      the corresponding <code class="computeroutput"><span class="identifier">identifier</span></code>
      will be available inside <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>; otherwise, a copy of it will be made
      at the point of <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> declaration and
      that copy will be available inside <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>. In the latter case, the <code class="computeroutput"><span class="identifier">idenitifer</span></code> must be <code class="computeroutput"><span class="identifier">CopyConstructible</span></code>.<br>
      &#22312; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code> &#20013;&#30340;&#27599;&#19968;&#20010;
      <code class="computeroutput"><span class="identifier">identifier</span></code> &#24517;&#39035;&#26159;&#20854;&#25152;&#22312;&#20316;&#29992;&#22495;&#20013;&#30340;&#19968;&#20010;&#26377;&#25928;&#21517;&#23383;&#65292;&#19988;&#24517;&#39035;&#21482;&#22312;&#21015;&#34920;&#20013;&#20986;&#29616;&#21018;&#22909;&#19968;&#27425;&#12290;
      &#22914;&#26524;&#19968;&#20010; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span></code>
      &#26159;&#20197; <code class="computeroutput"><span class="special">&amp;</span></code> &#31526;&#21495;&#25171;&#22836;&#30340;&#65292;&#21017;&#30456;&#23545;&#24212;&#30340;
      <code class="computeroutput"><span class="identifier">identifier</span></code> &#22312; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code> &#20013;&#26159;&#21487;&#29992;&#30340;&#65307;
      &#21542;&#21017;&#65292;&#23601;&#22312; <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> &#22768;&#26126;&#22788;&#21019;&#24314;&#19968;&#20221;&#25335;&#36125;&#65292;&#24182;&#22312;
      <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>
      &#20013;&#20351;&#29992;&#35813;&#25335;&#36125;&#12290; &#22312;&#21518;&#19968;&#31181;&#24773;&#20917;&#19979;&#65292;<code class="computeroutput"><span class="identifier">idenitifer</span></code>
      &#24517;&#39035;&#26159; <code class="computeroutput"><span class="identifier">CopyConstructible</span></code>
      &#30340;&#12290;
    </p>
<p>
      Only identifiers listed in <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code>, static variables, <code class="computeroutput"><span class="keyword">extern</span></code>
      variables and functions, and enumerations from the enclosing scope can be used
      inside the <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>.<br>
      &#21482;&#26377;&#22312; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code> &#20013;&#21015;&#20986;&#30340;&#26631;&#35782;&#31526;&#12289;&#38745;&#24577;&#21464;&#37327;&#12289;<code class="computeroutput"><span class="keyword">extern</span></code> &#21464;&#37327;&#21644;&#20989;&#25968;&#65292;&#20197;&#21450;&#25152;&#22312;&#20316;&#29992;&#22495;&#20013;&#30340;&#26522;&#20030;&#20540;&#65292;&#21487;&#20197;&#22312;
      <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">body</span></code>
      &#20013;&#20351;&#29992;&#12290;
    </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        <code class="computeroutput"><span class="keyword">this</span></code> pointer is not an identifier
        and cannot be passed to <code class="computeroutput"> <span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code>.<br> <code class="computeroutput"><span class="keyword">this</span></code>
        &#25351;&#38024;&#19981;&#26159;&#26631;&#35782;&#31526;&#65292;&#19981;&#33021;&#34987;&#20256;&#36882;&#32473; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code>.
      </p></td></tr>
</table></div>
<p>
      The <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> uses <a href="../../../../../libs/typeof/index.html" target="_top">Boost.Typeof</a>
      to determine types of <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code> elements. In order to compile code in
      <a href="../../../../../libs/typeof/index.html" target="_top">typeof emulation</a> mode,
      all types should be registered with <a href="../../../../../doc/html/typeof/refe.html#typeof.regtype" target="_top">BOOST_TYPEOF_REGISTER_TYPE</a>
      or <a href="../../../../../doc/html/typeof/refe.html#typeof.regtemp" target="_top">BOOST_TYPEOF_REGISTER_TEMPLATE</a>
      macros, or appropriate <a href="../../../../../libs/typeof/index.html" target="_top">Boost.Typeof</a>
      headers should be included.<br> <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a>
      &#20351;&#29992;&#20102; <a href="../../../../../libs/typeof/index.html" target="_top">Boost.Typeof</a>
      &#26469;&#21028;&#26029; <code class="computeroutput"><span class="identifier">scope</span><span class="special">-</span><span class="identifier">exit</span><span class="special">-</span><span class="identifier">capture</span><span class="special">-</span><span class="identifier">list</span></code> &#20803;&#32032;&#30340;&#31867;&#22411;&#12290;
      &#20026;&#20102;&#21487;&#20197;&#22312; <a href="../../../../../libs/typeof/index.html" target="_top">typeof emulation</a>
      &#27169;&#24335;&#19979;&#32534;&#35793;&#20195;&#30721;&#65292;&#25152;&#26377;&#31867;&#22411;&#37117;&#35201;&#29992; <code class="computeroutput"><span class="identifier">BOOST_TYPEOF_REGISTER_TYPE</span></code>
      &#25110; <code class="computeroutput"><span class="identifier">BOOST_TYPEOF_REGISTER_TEMPLATE</span></code>
      &#23439;&#26469;&#27880;&#20876;&#65292;&#25110;&#32773;&#21253;&#21547;&#27491;&#30830;&#30340; <a href="../../../../../libs/typeof/index.html" target="_top">Boost.Typeof</a>
      &#22836;&#25991;&#20214;&#12290;
    </p>
<a name="ref.boost_scope_exit_tpl"></a><h4>
<a name="id5100144"></a>
      BOOST_SCOPE_EXIT_TPL
    </h4>
<p>
      This macro is a workaround for various versions of gcc. These compilers don't
      compile <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> declaration inside function
      templates. As a workaround, the <code class="computeroutput"><span class="identifier">_TPL</span></code>
      suffix should be appended to <code class="computeroutput"><span class="identifier">BOOST_SCOPE_EXIT</span></code>.<br>
      &#36825;&#20010;&#23439;&#26159;&#22810;&#20010; gcc &#29256;&#26412;&#30340;&#21464;&#36890;&#26041;&#27861;&#12290;&#36825;&#20123;&#32534;&#35793;&#22120;&#19981;&#33021;&#32534;&#35793;&#22312;&#20989;&#25968;&#27169;&#26495;&#20869;&#37096;&#30340;
      <a class="link" href="../index.html" title="Chapter&#160;1.&#160;Boost.ScopeExit">ScopeExit</a> &#22768;&#26126;&#12290; &#20316;&#20026;&#21464;&#36890;&#30340;&#21150;&#27861;&#65292;&#23558;
      <code class="computeroutput"><span class="identifier">_TPL</span></code> &#21518;&#32512;&#28155;&#21152;&#21040; <code class="computeroutput"><span class="identifier">BOOST_SCOPE_EXIT</span></code> &#19978;&#12290;
    </p>
<p>
      The problem boils down to the following code:<br> &#36825;&#20010;&#38382;&#39064;&#21487;&#20197;&#24402;&#32467;&#33267;&#20197;&#19979;&#20195;&#30721;&#65306;
    </p>
<pre class="programlisting"><span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span> <span class="keyword">void</span> <span class="identifier">foo</span><span class="special">(</span><span class="identifier">T</span> <span class="keyword">const</span><span class="special">&amp;</span> <span class="identifier">t</span><span class="special">)</span> <span class="special">{</span>
    <span class="keyword">int</span> <span class="identifier">i</span> <span class="special">=</span> <span class="number">0</span><span class="special">;</span>
    <span class="keyword">struct</span> <span class="identifier">Local</span> <span class="special">{</span>
        <span class="keyword">typedef</span> <span class="identifier">__typeof__</span><span class="special">(</span><span class="identifier">i</span><span class="special">)</span> <span class="identifier">typeof_i</span><span class="special">;</span>
        <span class="keyword">typedef</span> <span class="identifier">__typeof__</span><span class="special">(</span><span class="identifier">t</span><span class="special">)</span> <span class="identifier">typeof_t</span><span class="special">;</span>
    <span class="special">};</span>
    <span class="keyword">typedef</span> <span class="identifier">Local</span><span class="special">::</span><span class="identifier">typeof_i</span> <span class="identifier">i_type</span><span class="special">;</span>
    <span class="keyword">typedef</span> <span class="identifier">Local</span><span class="special">::</span><span class="identifier">typeof_t</span> <span class="identifier">t_type</span><span class="special">;</span>
<span class="special">}</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span> <span class="identifier">foo</span><span class="special">(</span><span class="number">0</span><span class="special">);</span> <span class="special">}</span>
</pre>
<p>
      This can be fixed by adding <code class="computeroutput"><span class="keyword">typename</span></code>
      in front of <code class="computeroutput"><span class="identifier">Local</span><span class="special">::</span><span class="identifier">typeof_i</span></code> and <code class="computeroutput"><span class="identifier">Local</span><span class="special">::</span><span class="identifier">typeof_t</span></code>.<br>
      &#36825;&#21487;&#20197;&#36890;&#36807;&#22312; <code class="computeroutput"><span class="identifier">Local</span><span class="special">::</span><span class="identifier">typeof_i</span></code> &#21644; <code class="computeroutput"><span class="identifier">Local</span><span class="special">::</span><span class="identifier">typeof_t</span></code>
      &#21069;&#38754;&#22686;&#21152; <code class="computeroutput"><span class="keyword">typename</span></code> &#26469;&#35299;&#20915;&#12290;
    </p>
<p>
      See also <a href="http://gcc.gnu.org/bugzilla/show_bug.cgi?id=37920" target="_top">GCC
      bug 37920</a>.<br> &#21442;&#35265; <a href="http://gcc.gnu.org/bugzilla/show_bug.cgi?id=37920" target="_top">GCC
      bug 37920</a>.
    </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        Although <code class="computeroutput"><span class="identifier">BOOST_SCOPE_EXIT_TPL</span></code>
        has the same suffix as the <code class="computeroutput"><span class="identifier">BOOST_TYPEOF_TPL</span></code>,
        it doesn't follow a convention of the <a href="../../../../../libs/typeof/index.html" target="_top">Boost.Typeof</a>.<br>
        &#34429;&#28982; <code class="computeroutput"><span class="identifier">BOOST_SCOPE_EXIT_TPL</span></code>
        &#20855;&#26377;&#19982; <code class="computeroutput"><span class="identifier">BOOST_TYPEOF_TPL</span></code>
        &#30456;&#21516;&#30340;&#21518;&#32512;&#65292;&#19981;&#36807;&#23427;&#24182;&#19981;&#36981;&#24490; <a href="../../../../../libs/typeof/index.html" target="_top">Boost.Typeof</a>
        &#30340;&#21327;&#23450;&#12290;
      </p></td></tr>
</table></div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2006 -2009 Alexander Nasonov<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at &lt;ulink url="http://www.boost.org/LICENSE_1_0.txt"&gt;
        http://www.boost.org/LICENSE_1_0.txt &lt;/ulink&gt;)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="conf.html"><img src="../../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="acknowledge.html"><img src="../../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
