<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0.1 Transitional//EN">
<html>
<head>



  
  
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">




  
  
  
  
  <title>Boost.Flyweight Documentation - Locking policies reference</title>
  <link rel="stylesheet" href="../style.css" type="text/css">



  
  
  <link rel="start" href="../index.html">



  
  
  <link rel="prev" href="factories.html">



  
  
  <link rel="up" href="index.html">



  
  
  <link rel="next" href="tracking.html">
</head>


<body>



<h1><img src="../../../../boost.png" alt="Boost logo" align="middle" height="86" width="277">Boost.Flyweight
Locking policies reference</h1>




<div class="prev_link"><a href="holders.html"><img src="../prev.gif" alt="holders" border="0"><br>



Holders
</a></div>



<div class="up_link"><a href="index.html"><img src="../up.gif" alt="Boost.Flyweight reference" border="0"><br>



Boost.Flyweight reference
</a></div>



<div class="next_link"><a href="tracking.html"><img src="../next.gif" alt="tracking policies" border="0"><br>



Tracking policies
</a></div>


<br style="" clear="all">




<hr>

<h2>Contents &nbsp;&#30446;&#24405;</h2>




<ul>



  <li><a href="#preliminary">Preliminary concepts</a></li>



  <li><a href="#locking">Locking policies</a></li>



  <li><a href="#locking_tag_synopsis">Header
    <code>"boost/flyweight/locking_tag.hpp"</code> synopsis</a>
    
    
    
    <ul>



      <li><a href="#is_locking">Class template <code>is_locking</code></a></li>



      <li><a href="#locking_construct">Class template <code>locking</code></a></li>



    
    
    
    </ul>


    
  </li>



  <li><a href="#simple_locking_fwd_synopsis">Header
    <code>"boost/flyweight/simple_locking_fwd.hpp"</code> synopsis</a>
  </li>



  <li><a href="#simple_locking_synopsis">Header
    <code>"boost/flyweight/simple_locking.hpp"</code> synopsis</a>
    
    
    
    <ul>



      <li><a href="#simple_locking">Class <code>simple_locking</code></a></li>



    
    
    
    </ul>


    
  </li>



  <li><a href="#no_locking_fwd_synopsis">Header
    <code>"boost/flyweight/no_locking_fwd.hpp"</code> synopsis</a>
  </li>



  <li><a href="#no_locking_synopsis">Header
    <code>"boost/flyweight/no_locking.hpp"</code> synopsis</a>
    
    
    
    <ul>



      <li><a href="#no_locking">Class <code>no_locking</code></a></li>



    
    
    
    </ul>


    
  </li>



</ul>




<h2><a name="preliminary">Preliminary concepts &nbsp;&#39044;&#22791;&#27010;&#24565;</a></h2>




<p>
A <i>mutex</i> is a type whose objects can be in either of two states, called
locked and unlocked, with the property that when a thread A has locked a
mutex <code>m</code> and a different thread B tries to lock <code>m</code>,
B is blocked until A unlocks <code>m</code>. Additionally, a mutex is said to 
support <i>recursive locking</i> if a thread can succesfully invoke the locking
operation for a mutex already locked by this same thread; in this case, it is
required that the thread execute as many unlock operations as lock
operations it has performed for the mutex to become effectively unlocked.
A <i>scoped lock</i> is a
type associated to some mutex type whose objects do the locking/unlocking
of a mutex on construction/destruction time.</p>

<p><big><i>mutex</i></big>&#31867;&#22411;&#30340;&#23545;&#35937;&#21482;&#33021;&#22788;&#22312;2&#31181;&#29366;&#24577;&#20043;&#19968;&#65292;&#38145;&#23450;&#25110;&#32773;&#26410;&#38145;&#23450;&#65292;&#36825;&#31181;&#23545;&#35937;&#30340;&#29305;&#24615;&#26159;&#65306;&#24403;&#32447;&#31243;A&#24050;&#32463;&#38145;&#23450;&#20102;&#20114;&#26021;&#20307;<big><code>m</code></big>&#32780;&#21478;&#22806;&#19968;&#20010;&#32447;&#31243;B&#23581;&#35797;&#38145;&#23450;<big><code>m</code></big>&#26102;&#65292;B&#20250;&#34987;&#38459;&#22622;&#30452;&#21040;A&#35299;&#38145;<big><code>m</code></big>&#12290; &#21478;&#22806;&#65292;&#22914;&#26524;&#19968;&#20010;&#32447;&#31243;&#21487;&#20197;&#22312;&#23427;&#24050;&#32463;&#38145;&#23450;&#30340;&#20114;&#26021;&#20307;&#19978;&#25104;&#21151;&#35843;&#29992;&#38145;&#23450;&#25805;&#20316;&#65292;&#35813;&#20114;&#26021;&#20307;&#23601;&#34987;&#35828;&#25104;&#26159;&#25903;&#25345;<span style="font-style: italic;">&#36882;&#24402;&#38145;&#23450;</span>&#30340;&#65307;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#32447;&#31243;&#22312;&#20114;&#26021;&#20307;&#19978;&#25191;&#34892;&#20102;&#22810;&#23569;&#38145;&#23450;&#25805;&#20316;&#23601;&#35201;&#25191;&#34892;&#21516;&#26679;&#22810;&#30340;&#35299;&#38145;&#25805;&#20316;&#25165;&#33021;&#35753;&#20114;&#26021;&#20307;&#25104;&#21151;&#35299;&#38145;&#12290;<span style="font-style: italic;">&#33539;&#22260;&#38145;</span>&#26159;&#19982;&#26576;&#20010;&#20114;&#26021;&#31867;&#22411;&#30456;&#20851;&#30340;&#31867;&#22411;&#65292;&#35813;&#31867;&#22411;&#30340;&#23545;&#35937;&#22312;&#26500;&#36896;/&#26512;&#26500;&#30340;&#26102;&#20505;&#23545;&#19968;&#20010;&#20114;&#26021;&#20307;&#36827;&#34892;&#38145;&#23450;/&#35299;&#38145;&#12290;
</p>




<p>
In the following table, <code>Mutex</code> is a mutex type, <code>m</code>
is an object of type <code>Mutex</code>, <code>Lock</code> is a scoped lock
associated to <code>Mutex</code> and <code>lk</code> is a value of
<code>Lock</code>.

</p>


<p style="text-align: left;">
&#22312;&#19979;&#38754;&#36825;&#20010;&#34920;&#26684;&#37324;&#65292;<big><code>Mutex</code></big>&#26159;&#19968;&#20010;&#20114;&#26021;&#20307;&#31867;&#22411;&#65292;<big><code>m</code></big>&#26159;&#19968;&#20010;<big><code>Mutex</code></big>&#31867;&#22411;&#30340;&#23545;&#35937;&#65292;<big><code>Lock</code></big>&#26159;&#20851;&#32852;&#21040;<big><code>Mutex</code></big>&#30340;&#19968;&#20010;&#33539;&#22260;&#38145;&#65292;<big><code>lk</code></big>&#26159;<big><code>Lock</code></big>&#31867;&#22411;&#30340;&#19968;&#20010;&#20540;&#12290;</p>


<table cellspacing="0">



  <caption><b>Mutex and Scoped Lock requirements.</b></caption>
  <tbody>


    <tr>



  <th align="center">expression</th>



  <th align="center">return type</th>



  <th align="center">assertion/note<br>


pre/post-condition</th>



    </tr>



    <tr>



  <td><code>Mutex m;</code></td>



  <td>&nbsp;</td>



  <td>Post: <code>m</code> is unlocked.
  </td>



    </tr>



    <tr class="odd_tr">



  <td><code>(&amp;m)-&gt;~Mutex();</code></td>



  <td><code>void</code></td>



  <td>Pre: <code>m</code> is unlocked.</td>



    </tr>



    <tr>



  <td><code>Lock lk(m);</code></td>



  <td>&nbsp;</td>



  <td>Associates <code>m</code> to <code>lk</code> and locks <code>m</code>.</td>



    </tr>



    <tr class="odd_tr">



  <td><code>(&amp;lk)-&gt;~Lock();</code></td>



  <td><code>void</code></td>



  <td>Unlocks the mutex associated to <code>lk</code>.</td>



    </tr>



  
  
  </tbody>
</table>





<p>
These concepts are very similar, but not entirely equivalent, to
the homonym ones described in the
<a href="../../../../doc/html/thread/synchronization.html#thread.synchronization.mutex_concepts">Boost Thread
Library</a>.</p>


<p>&#36825;&#20123;&#27010;&#24565;&#21516;<a href="../../../../doc/html/thread/synchronization.html#thread.synchronization.mutex_concepts">Boost Thread
Library</a>&#37324;&#25551;&#36848;&#30340;&#21516;&#21517;&#27010;&#24565;&#38750;&#24120;&#30456;&#20284;&#65292;&#20294;&#19981;&#23436;&#20840;&#31561;&#21516;&#12290;
</p>




<h2><a name="locking">Locking policies &nbsp;&#38145;&#23450;&#31574;&#30053;</a></h2>




<p>
<i>Locking policies</i> describe a mutex type and an associated
scoped lock type.
<a href="flyweight.html#flyweight"><code>flyweight</code></a> uses a given locking
policy to synchronize the access to its internal
<a href="factories.html#factory">factory</a>.</p>


<p><span style="font-style: italic;">&#38145;&#23450;&#31574;&#30053;</span>&#25551;&#36848;&#20102;&#19968;&#20010;&#20114;&#26021;&#20307;&#31867;&#22411;&#21644;&#23427;&#30456;&#20851;&#30340;&#33539;&#22260;&#38145;&#31867;&#22411;&#12290;<big><a href="flyweight.html#flyweight"><code>flyweight</code></a></big>&#20351;&#29992;&#19968;&#31181;&#32473;&#23450;&#30340;&#38145;&#23450;&#31574;&#30053;&#26469;&#21516;&#27493;&#21040;&#23427;&#30340;&#20869;&#37096;<a href="factories.html#factory">factory</a>&#30340;&#35775;&#38382;&#12290;
</p>




<p>
A type <code>Locking</code> is a locking policy if: &nbsp;&#31867;&#22411;<code>Locking</code>&#26159;&#19968;&#31181;&#38145;&#23450;&#31574;&#30053;&#22914;&#26524;&#65306;
</p>


<ul>



  <li>One of the following conditions is satisfied: &nbsp;&#28385;&#36275;&#20197;&#19979;&#26465;&#20214;&#20043;&#19968;&#65306;
    
    
    
    <ol type="a">



      <li><a href="#is_locking"><code>is_locking&lt;Locking&gt;::type</code></a> is
      <a href="../../../mpl/doc/refmanual/bool.html"><code>boost::mpl::true_</code></a>, &nbsp; &nbsp;<a href="locking.html#is_locking"><code>is_locking&lt;Locking&gt;::type</code></a>&#26159;<a href="../../../mpl/doc/refmanual/bool.html"><code>boost::mpl::true_</code></a></li>



      <li><code>Locking</code> is of the form
      <a href="#tracking_construct"><code>locking&lt;Locking'&gt;</code></a>. &nbsp;<code>Locking</code>&#30340;&#26684;&#24335;&#26159;<a href="locking.html#tracking_construct"><code>locking&lt;Locking'&gt;</code></a></li>



    
    
    
    </ol>



  </li>



  <li>The type <code>Locking::mutex_type</code> (or 
    <code>Locking'::mutex_type</code> if (b) applies) is a
    model of <a href="#preliminary"><code>Mutex</code></a>
    and supports recursive locking.</li>

</ul>

<div style="text-align: left; margin-left: 40px;">&#31867;&#22411;<code>Locking::mutex_type</code>&#65288;&#22312;&#26465;&#20214;b&#26102;&#26159;<code>Locking'::mutex_type</code>&#65289;&#26159;<a href="#preliminary">&#20114;&#26021;&#20307;</a>&#30340;&#19968;&#20010;&#27169;&#22411;&#24182;&#19988;&#25903;&#25345;&#36882;&#24402;&#38145;&#23450;</div>

<ul>



  <li>The type <code>Locking::lock_type</code> (or 
    <code>Locking'::lock_type</code> if (b) applies) is a
    <a href="#preliminary"><code>Scoped Lock</code></a> of
    the mutex referred to above.</li>



</ul>

<div style="margin-left: 40px;">&#31867;&#22411;<code>Locking::lock_type</code>&#65288;&#22312;&#26465;&#20214;b&#26102;&#26159;<code>Locking'::lock_type</code>&#65289;&#26159;&#19968;&#20010;&#19978;&#25991;&#25552;&#21040;&#30340;&#20114;&#26021;&#20307;&#30340;<a href="#preliminary">&#33539;&#22260;&#38145;</a></div>

<h2><a name="locking_tag_synopsis">Header
</a><a href="../../../../boost/flyweight/locking_tag.hpp"><code>"boost/flyweight/locking_tag.hpp"</code></a> synopsis &nbsp;</h2>
<h2>&#22836;&#25991;&#20214;<a href="../../../../boost/flyweight/locking_tag.hpp"><code>"boost/flyweight/locking_tag.hpp"</code></a>&#22823;&#24847;</h2>




<blockquote>
  
  
  <pre><span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">{</span>

<span class="keyword">namespace</span> <span class="identifier">flyweights</span><span class="special">{</span>

<span class="keyword">struct</span> <span class="identifier">locking_marker</span><span class="special">;</span>

<span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="keyword">struct</span> <span class="identifier">is_locking</span>

<span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="keyword">struct</span> <span class="identifier">locking</span><span class="special">;</span>

<span class="special">}</span> <span class="comment">// namespace boost::flyweights</span>

<span class="special">}</span> <span class="comment">// namespace boost</span>  </pre>


</blockquote>




<h3><a name="is_locking">Class template <code>is_locking &nbsp;&#31867;&#27169;&#26495; is_locking</code></a></h3>




<p>
Unless specialized by the user, <code>is_locking&lt;T&gt;::type</code> is
<a href="../../../mpl/doc/refmanual/bool.html"><code>boost::mpl::true_</code></a>
if <code>T</code> is derived from <code>locking_marker</code>, and it is
<a href="../../../mpl/doc/refmanual/bool.html"><code>boost::mpl::false_</code></a>
otherwise.</p>


<p>&#38500;&#38750;&#29992;&#25143;&#36827;&#34892;&#20102;&#19987;&#38376;&#21270;&#65292;&#22914;&#26524;<big><code>T</code></big>&#22914;&#26159;&#20174;<big><code>locking_marker</code></big>&#27966;&#29983;&#30340;&#65292;<big><code>is_locking&lt;T&gt;::type</code></big>&#26159;<big><a href="../../../mpl/doc/refmanual/bool.html"><code>boost::mpl::true_</code></a></big>&#65292;&#21542;&#21017;&#26159;<big><a href="../../../mpl/doc/refmanual/bool.html"><code>boost::mpl::false_</code></a></big>&#12290;
</p>




<h3><a name="locking_construct">Class template <code>locking &nbsp;&#31867;&#27169;&#26495; locking</code></a></h3>




<p>
<code>locking&lt;T&gt;</code> is a syntactic construct meant to indicate
that <code>T</code> is a locking policy without resorting to the
mechanisms provided by the <code>is_locking</code> class template.</p>


<p><big><code>locking&lt;T&gt;</code></big> &#26159;&#19968;&#31181;&#29992;&#20110;&#34920;&#26126;<code>T</code>&#26159;&#19968;&#31181;&#38145;&#23450;&#31574;&#30053;&#30340;&#35821;&#27861;&#26426;&#21046;&#65292; &#27492;&#26102;&#19981;&#38656;&#35201;&#20511;&#21161;<big><code>is_locking</code></big>&#31867;&#27169;&#26495;&#25552;&#20379;&#30340;&#26426;&#21046;&#12290;
</p>




<h2><a name="simple_locking_fwd_synopsis">Header
</a><a href="../../../../boost/flyweight/simple_locking_fwd.hpp"><code>"boost/flyweight/simple_locking_fwd.hpp"</code></a> synopsis &nbsp;</h2>

<h2>&nbsp; &nbsp; &#22836;&#25991;&#20214;<a href="file:///boost/flyweight/simple_locking_fwd.hpp"><code>"boost/flyweight/simple_locking_fwd.hpp"</code></a>&#22823;&#24847;</h2>




<blockquote>
  
  
  <pre><span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">{</span>

<span class="keyword">namespace</span> <span class="identifier">flyweights</span><span class="special">{</span>

<span class="keyword">struct</span> <span class="identifier">simple_locking</span><span class="special">;</span>

<span class="special">}</span> <span class="comment">// namespace boost::flyweights</span>

<span class="special">}</span> <span class="comment">// namespace boost</span>  </pre>


</blockquote>




<p>
<code>simple_locking_fwd.hpp</code> forward declares the class
<a href="#simple_locking"><code>simple_locking</code></a>.</p>


<p><big><code>simple_locking_fwd.hpp</code></big>&#21069;&#32622;&#22768;&#26126;&#31867;<big><a href="locking.html#simple_locking"><code>simple_locking</code></a></big>&nbsp;
</p>




<h2><a name="simple_locking_synopsis">Header
</a><a href="../../../../boost/flyweight/simple_locking.hpp"><code>"boost/flyweight/simple_locking.hpp"</code></a> synopsis &nbsp;</h2>

<h2>&nbsp; &nbsp; &#22836;&#25991;&#20214;<a href="file:///boost/flyweight/simple_locking.hpp"><code>"boost/flyweight/simple_locking.hpp"</code></a>&#22823;&#24847;</h2>




<h3><a name="simple_locking">Class <code>simple_locking &#31867; simple_locking</code></a></h3>





<p>
<a href="#locking"><code>Locking Policy</code></a> that specifies a basic
mutex type based on the simplest synchronization mechanisms provided by
the environment; When no threading capabilities are available,
<code>simple_locking</code> specifies a dummy type without actual
synchronization capabilities.<a href="locking.html#locking"><code></code></a></p>

<p><a href="locking.html#locking"><code></code></a>&#36825;&#31181;<a href="#locking">&#38145;&#23450;&#31574;&#30053;</a>&#25351;&#23450;&#30340;&#22522;&#26412;&#20114;&#26021;&#23545;&#35937;&#22522;&#20110;&#29615;&#22659;&#25152;&#33021;&#25552;&#20379;&#30340;&#26368;&#31616;&#21333;&#30340;&#21516;&#27493;&#26426;&#21046;&#12290;&#24403;&#32447;&#31243;&#21151;&#33021;&#19981;&#21487;&#29992;&#26102;&#65292;<code>simple_locking</code>&#25551;&#36848;&#30340;&#26159;&#19968;&#20010;&#27809;&#26377;&#23454;&#38469;&#21516;&#27493;&#33021;&#21147;&#30340;&#31354;&#31867;&#22411;&#12290;
</p>




<h2><a name="no_locking_fwd_synopsis">Header
</a><a href="../../../../boost/flyweight/no_locking_fwd.hpp"><code>"boost/flyweight/no_locking_fwd.hpp"</code></a> synopsis &nbsp;</h2>

<h2>&nbsp; &nbsp; &#22836;&#25991;&#20214;<a href="file:///boost/flyweight/no_locking_fwd.hpp"><code>"boost/flyweight/no_locking_fwd.hpp"</code></a>&#22823;&#24847;</h2>




<blockquote>
  
  
  <pre><span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">{</span>

<span class="keyword">namespace</span> <span class="identifier">flyweights</span><span class="special">{</span>

<span class="keyword">struct</span> <span class="identifier">no_locking</span><span class="special">;</span>

<span class="special">}</span> <span class="comment">// namespace boost::flyweights</span>

<span class="special">}</span> <span class="comment">// namespace boost</span>  </pre>


</blockquote>




<p>
<code>no_locking_fwd.hpp</code> forward declares the class
<a href="#no_locking"><code>no_locking</code></a>.</p>


<p><big><code>no_locking_fwd.hpp</code></big>&#21069;&#32622;&#30003;&#26126;&#31867;<big><a href="locking.html#no_locking"><code>no_locking</code></a></big>&#12290;
</p>




<h2><a name="no_locking_synopsis">Header
</a><a href="../../../../boost/flyweight/no_locking.hpp"><code>"boost/flyweight/no_locking.hpp"</code></a> synopsis &nbsp;</h2>

<h2>&nbsp; &nbsp; &#22836;&#25991;&#20214;<a href="file:///boost/flyweight/no_locking.hpp"><code>"boost/flyweight/no_locking.hpp"</code></a>&#22823;&#24847;</h2>




<h3><a name="no_locking">Class&nbsp;<code>no_locking &nbsp;&#31867; no_locking</code></a></h3>




<p>
Null <a href="#locking"><code>Locking Policy</code></a>: it specifies a dummy
type that satisfies the formal requirements for the
<a href="#preliminary"><code>Mutex</code></a> concept but does not perform
thread blocking. <code>no_locking</code> should only be used in single-threaded
environments.</p>


<p>&#31354;&#30340;<a href="#locking">&#38145;&#23450;&#31574;&#30053;</a><span style="font-family: monospace;"><span style="text-decoration: underline;"></span></span><a href="locking.html#locking"><code></code></a>&#65306;&#23427;&#25551;&#36848;&#30340;&#31354;&#31867;&#22411;&#28385;&#36275;&#20102;<a href="locking.html#preliminary"><code>Mutex</code></a>&#27010;&#24565;&#24418;&#24335;&#19978;&#30340;&#35201;&#27714;&#21364;&#19981;&#38459;&#22622;&#32447;&#31243;&#12290;<big><code>no_locking</code></big>&#21482;&#24212;&#35813;&#22312;&#21333;&#32447;&#31243;&#29615;&#22659;&#19979;&#20351;&#29992;&#12290;
</p>




<hr>

<div class="prev_link"><a href="holders.html"><img src="../prev.gif" alt="holders" border="0"><br>



Holders
</a></div>



<div class="up_link"><a href="index.html"><img src="../up.gif" alt="Boost.Flyweight reference" border="0"><br>



Boost.Flyweight reference
</a></div>



<div class="next_link"><a href="tracking.html"><img src="../next.gif" alt="tracking policies" border="0"><br>



Tracking policies
</a></div>


<br style="" clear="all">




<br>




<p>Revised January 27th 2009</p>




<p>&copy; Copyright 2006-2009 Joaqu&iacute;n M L&oacute;pez Mu&ntilde;oz.
Distributed under the Boost Software 
License, Version 1.0. (See accompanying file <a href="../../../../LICENSE_1_0.txt">
LICENSE_1_0.txt</a> or copy at <a href="http://www.boost.org/LICENSE_1_0.txt">
http://www.boost.org/LICENSE_1_0.txt</a>)
</p>




</body>
</html>
