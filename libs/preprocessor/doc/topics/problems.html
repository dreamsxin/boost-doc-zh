<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>


  
  
  <meta content="text/html; charset=UTF-8" http-equiv="content-type">



	
	
  
  
  
  
  <title>problems.html</title>
  <link rel="stylesheet" type="text/css" href="../styles.css">
</head>


<body>



<h4>已知的C/C++预处理器问题</h4>



<div>预处理器元编程经常受到热烈的讨论。部分的原因是由于对这个危险技巧的不好的经验，如使用宏来定义内联函数。作为一个基本经验，如果你可以找一个不需要预处理器的干净且可管理的方法来做某件事，那么你就应该用那个方法来做。
</div>



<div>我们来重温一下预处理器的一些著名问题，使用问题/解决方法的格式。
</div>



<h4>问题 #1</h4>



<div>预处理器不遵守作用域，因此宏有时会意外地替换掉代码而不提示。
</div>



<div>
	<b>解决方法 A</b>
	
<div>对宏且只对宏使用全大写的标识符。这样可以部分地消除某些代码意外地被宏所替换掉的意外。
	</div>



</div>



<div>
	<b>解决方法 B</b>
	
<div>使用局部宏的惯用法：
	</div>



<div class="code">
<pre>#define MACRO ...<br>// use MACRO<br>#undef MACRO<br></pre>


</div>



	
<div>这样就确保了宏不会在局部作用域以外意外地替换掉其它代码。
	</div>



	
<div>这个解决方法的不足是不能自动添加 #undef，有可能会忘掉。有经验的程序员通常会在编写宏的定义之前或之后立即写上 #undef.
	</div>



</div>



<div>
	<b>解决方法 C</b>
	
<div>
		使用单一宏前缀的惯用法。
	</div>



<div class="code">
<pre>#define UMP_MACRO<br>// use UMP_MACRO<br></pre>


</div>



	
<div>这使得出现意外的替换或冲突的可能非常低。该方法的不足在于：
	</div>



	
<ul>



		<li>在一个大的项目中依然可能存在名字冲突。</li>



		<li>宏依然会污染全局名字空间。</li>



	
</ul>



	<i>尽可能组合以上解决方法，可以最大限度避免作用域的问题。</i>
</div>



<h4>问题 #2</h4>



<div>预处理器的代码难于阅读。它要求你清楚一些基本的操作过程，包括预处理器如何递归地扩展宏、如何查找宏的定义，以及在心中对宏的参数进行替换。
</div>



<div>
	<b>解决方法</b>
	
<div>任意一种编程都要求对代码如何执行有基本的了解。任何参数化技术，包括普通函数和模板，都要求查找定义并进行参数替换。
	</div>



	
<div>但是，了解以下技巧是有用的：
	</div>



	
<ul>



		<li>尽理使用局部宏，可以避免多数查找过程。</li>



		<li>代码浏览器和文本查找工具有助于查找定义。</li>



		<li>编译器可用于生成预处理后的源代码，以查找 bugs.</li>



		<li>在对某个东西采用预处理器元编程之前，首先实现一个小规模的不使用预处理器的版本。再由底而上地使用预处理器替换手工编写的结构。这种方法可以让你递增地测试代码。有经验的程序员常常跳过一些步骤，但是如果某个东西过于复杂难以直接编写，它总是可以回到这种递增的方法。
		</li>



		<li>如果你在预处理器代码中要换行的地方插入一个特殊符号，那么预处理后的代码更易于阅读，也更易于使用查找和替换工具。
		</li>



	
</ul>



	<i>一件特别要记住的事情是，将对预处理器的使用限制在结构化、可理解和安全的方式下。结构有助于理解复杂的系统<a href="../bibliography.html#mcconnell">[McConnell]</a>。</i>
</div>



<h4>问题 #3</h4>



<div>
	"我宁愿看到Cpp被废除。" - <i>Bjarne Stroustrup</i> in <a href="../bibliography.html#stroustrup">[Stroustrup]</a>.
</div>



<div>
	<b>解决方法</b>
	
<div>C/C++预处理器还将存在很长一段时间。
	</div>



	<i>实际上，预处理器元编程远比模板元编程简单和可移植<a href="../bibliography.html#czarnecki">[Czarnecki]</a>。</i>
</div>



<hr size="1">
<div style="margin-left: 0px;">
	<i>&copy; Copyright <a href="http://www.housemarque.com" target="_top">Housemarque Oy</a> 2002</i>
</div>



<div style="margin-left: 0px;">Permission to copy, use, modify, sell
and distribute this document is granted provided this copyright notice
appears in all copies.&nbsp;
This document is provided "as is" without express or implied warranty
and with no claim as to its suitability for any purpose.
</div>



	
<hr size="1">
	
<div style="margin-left: 0px;">
		<i>&copy; Copyright <a href="http://www.housemarque.com" target="_top">Housemarque Oy</a> 2002</i>
		<br>


<i>&copy; Copyright Paul Mensonides 2002</i>
	</div>



	
<div style="margin-left: 0px;">
		
<p><small>Distributed under the Boost Software License, Version 1.0. (See
		accompanying file <a href="../../../../LICENSE_1_0.txt">LICENSE_1_0.txt</a> or
		copy at <a href="http://www.boost.org/LICENSE_1_0.txt">www.boost.org/LICENSE_1_0.txt</a>)</small></p>



	</div>



</body>
</html>
