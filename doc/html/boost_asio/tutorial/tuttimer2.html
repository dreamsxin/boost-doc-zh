<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Timer.2 - Using a timer asynchronously</title>
<link rel="stylesheet" href="../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="../../boost_asio.html" title="Boost.Asio">
<link rel="up" href="../tutorial.html" title="Tutorial">
<link rel="prev" href="tuttimer1/src.html" title="Source listing for Timer.1">
<link rel="next" href="tuttimer2/src.html" title="Source listing for Timer.2">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../boost.png"></td>
<td align="center"><a href="../../../../index.html">Home</a></td>
<td align="center"><a href="../../libraries.html">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/people/people.htm">People</a></td>
<td align="center"><a href="http://www.boost.org/more/faq.htm">FAQ</a></td>
<td align="center"><a href="../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tuttimer1/src.html"><img src="../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../tutorial.html"><img src="../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../boost_asio.html"><img src="../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="tuttimer2/src.html"><img src="../../../../doc/html/images/next.png" alt="Next"></a>
</div>
<div class="section" lang="en">
<div class="titlepage"><div><div>
  <h3 class="title">
<a name="boost_asio.tutorial.tuttimer2"></a><a class="link" href="tuttimer2.html" title="Timer.2 - Using a timer asynchronously"> Timer.2 - Using a timer
      asynchronously</a></h3>
  <h3 class="title"><a class="link" href="tuttimer2.html" title="Timer.2 - Using a timer asynchronously"><a name="boost_asio.tutorial.tuttimer2"></a>&#23450;&#26102;&#22120;.2-&#20351;&#29992;&#24322;&#27493;&#23450;&#26102;&#22120;</a></h3>
</div>
</div></div>
<p>
        This tutorial program demonstrates how to use asio's asynchronous callback
        functionality by modifying the program from tutorial Timer.1 to perform an
        asynchronous wait on the timer.
      &#36825;&#20010;&#20837;&#38376;&#31243;&#24207;&#28436;&#31034;&#20102;&#22914;&#20309;&#20351;&#29992;asio&#30340;&#24322;&#27493;&#22238;&#35843;&#21151;&#33021;,&#36890;&#36807;&#20462;&#25913;&#20837;&#38376;&#20363;&#31243; &#23450;&#26102;&#22120;.1 &#26469;&#22312;&#23450;&#26102;&#22120;&#19978;&#25191;&#34892;&#24322;&#27493;&#22320;&#31561;&#24453;.</p>
<pre class="programlisting">
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">asio</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">date_time</span><span class="special">/</span><span class="identifier">posix_time</span><span class="special">/</span><span class="identifier">posix_time</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
</pre>
<p>
        Using asio's asynchronous functionality means having a callback function
        that will be called when an asynchronous operation completes. In this program
        we define a function called <code class="computeroutput"><span class="identifier">print</span></code>
      to be called when the asynchronous wait finishes.</p>
<p>&#20351;&#29992;asio&#30340;&#24322;&#27493;&#24322;&#27493;&#24847;&#21619;&#30528;&#26377;&#19968;&#20010;&#22238;&#35843;&#20989;&#25968;&#23558;&#20250;&#22312;&#24322;&#27493;&#25805;&#20316;&#23436;&#25104;&#26102;&#34987;&#35843;&#29992;.&#22312;&#36825;&#20010;&#31243;&#24207;&#20013;,&#25105;&#20204;&#23450;&#20041;&#19968;&#20010;&#21483; <code class="computeroutput"><span class="identifier">print</span></code> &#30340;&#20989;&#25968;,&#23427;&#23558;&#20250;&#22312;&#24322;&#27493;&#31561;&#24453;&#23436;&#25104;&#26102;&#34987;&#35843;&#29992;. </p>
<pre class="programlisting">
<span class="keyword">void</span> <span class="identifier">print</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">system</span><span class="special">::</span><span class="identifier">error_code</span><span class="special">&amp;</span> <span class="comment">/*e*/</span><span class="special">)</span>
<span class="special">{</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Hello, world!\n"</span><span class="special">;</span>
<span class="special">}</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
  <span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">io_service</span> <span class="identifier">io</span><span class="special">;</span>

  <span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">deadline_timer</span> <span class="identifier">t</span><span class="special">(</span><span class="identifier">io</span><span class="special">,</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">posix_time</span><span class="special">::</span><span class="identifier">seconds</span><span class="special">(</span><span class="number">5</span><span class="special">));</span>
</pre>
<p>
        Next, instead of doing a blocking wait as in tutorial Timer.1, we call the
        boost::asio::deadline_timer::async_wait() function to perform an asynchronous
        wait. When calling this function we pass the <code class="computeroutput"><span class="identifier">print</span></code>
        callback handler that was defined above.  </p>
<p>&#25509;&#30528;,&#19981;&#21516;&#20110;&#20837;&#38376;&#20363;&#31243; &#23450;&#26102;&#22120;.1 &#20013;&#37027;&#26679;&#25191;&#34892;&#19968;&#20010;&#38459;&#22622;&#30340;&#31561;&#24453;. &#25105;&#20204;&#35843;&#29992;boost::asio::deadline_timer::async_wait()&#20989;&#25968;&#26469;&#25191;&#34892;&#24322;&#27493;&#31561;&#24453;.&#24403;&#35843;&#29992;&#36825;&#20010;&#20989;&#25968;&#26102;,&#25105;&#20204;&#25226;&#19978;&#38754;&#23450;&#20041;&#30340;<code class="computeroutput"><span class="identifier">print</span></code>&#20989;&#25968;&#20316;&#20026;&#22238;&#35843;&#20989;&#25968;&#20256;&#20837;.</p>
<pre class="programlisting">
  <span class="identifier">t</span><span class="special">.</span><span class="identifier">async_wait</span><span class="special">(</span><span class="identifier">print</span><span class="special">);</span>
</pre>
<p>
        Finally, we must call the boost::asio::io_service::run() member function
        on the io_service object.</p>
<p>&#26368;&#21518;,&#25105;&#20204;&#24517;&#39035;&#35843;&#29992;io_service&#23545;&#35937;&#30340;&#25104;&#21592;&#20989;&#25968;boost::asio::io_service::run() . </p>
<p>
        The asio library provides a guarantee that callback handlers will only be
        called from threads that are currently calling boost::asio::io_service::run().
        Therefore unless the boost::asio::io_service::run() function is called the
        callback for the asynchronous wait completion will never be invoked.  </p>
<p>asio&#24211;&#25552;&#20379;&#20102;&#19968;&#20010;&#20445;&#35777;:&#21363;&#22238;&#35843;&#22788;&#29702;&#20989;&#25968;&#21482;&#20250;&#22312;&#24403;&#21069;&#36816;&#34892;boost::asio::io_service::run()&#30340;&#32447;&#31243;&#20013;&#35843;&#29992;.&#25152;&#20197;&#38500;&#38750;boost::asio::io_service::run() &#34987;&#35843;&#29992;,&#21542;&#21017;&#25152;&#26377;&#30340;&#24322;&#27493;&#31561;&#24453;&#23436;&#25104;&#20363;&#31243;&#37117;&#19981;&#20250;&#34987;&#35843;&#29992;.</p>
<p>
        The boost::asio::io_service::run() function will also continue to run while
        there is still "work" to do. In this example, the work is the asynchronous
        wait on the timer, so the call will not return until the timer has expired
        and the callback has completed.  </p>
<p>&#22914;&#26524;&#36824;&#26377;&#24037;&#20316;&#21487;&#20570;,boost::asio::io_service::run()&#23558;&#20250;&#19968;&#30452;&#36816;&#34892;.&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;,&#24037;&#20316;&#23601;&#26159;&#22312;&#23450;&#26102;&#22120;&#19978;&#30340;&#24322;&#27493;&#31561;&#24453;,&#25152;&#20197;&#36825;&#20010;&#35843;&#29992;&#19981;&#20250;&#36820;&#22238;,&#30452;&#21040;&#23450;&#26102;&#22120;&#36229;&#26102;&#21644;&#22238;&#35843;&#20989;&#25968;&#34987;&#25191;&#34892;&#23436;&#27605;.</p>
<p>
        It is important to remember to give the io_service some work to do before
        calling boost::asio::io_service::run(). For example, if we had omitted the
        above call to boost::asio::deadline_timer::async_wait(), the io_service would
        not have had any work to do, and consequently boost::asio::io_service::run()
  would have returned immediately.</p>
<p>所以记得在调用boost::asio::io_service::run()之前给io_service一些工作做是很重要的.比如,如果我们忘记了上面这个调用boost::asio::deadline_timer::async_wait(),那io_service 将不会有任何工作可做,结果 boost::asio::io_service::run()会立即返回.</p>
<pre class="programlisting">
  <span class="identifier">io</span><span class="special">.</span><span class="identifier">run</span><span class="special">();</span>

  <span class="keyword">return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
        See the <a class="link" href="tuttimer2/src.html" title="Source listing for Timer.2">full source listing</a>  </p>
<p>&#26597;&#30475; <a class="link" href="tuttimer2/src.html" title="Source listing for Timer.2">&#23436;&#25972;&#20195;&#30721;&#21015;&#34920;</a></p>
<p>Return to the <a class="link" href="../tutorial.html" title="Tutorial">tutorial index</a></p>
<p>
        &#36820;&#22238;&#21040; <a class="link" href="../tutorial.html" title="Tutorial">&#20837;&#38376;&#25351;&#23548;&#30446;&#24405;</a>
  </p>
<p>
        Previous: <a class="link" href="tuttimer1.html" title="Timer.1 - Using a timer synchronously">Timer.1 - Using a
        timer synchronously</a>  </p>
<p>&#19978;&#19968;&#39029;: <a class="link" href="tuttimer1.html" title="Timer.1 - Using a timer synchronously">&#23450;&#26102;&#22120;.1 - &#20351;&#29992;&#21516;&#27493;&#23450;&#26102;&#22120;</a></p>
<p>
        Next: <a class="link" href="tuttimer3.html" title="Timer.3 - Binding arguments to a handler">Timer.3 - Binding arguments
        to a handler</a>  </p>
<p>&#19979;&#19968;&#39029;: <a class="link" href="tuttimer3.html" title="Timer.3 - Binding arguments to a handler">&#23450;&#26102;&#22120;.3 - &#32465;&#23450;&#21442;&#25968;&#21040;&#22788;&#29702;&#20363;&#31243;</a></p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright © 2003 - 2008 Christopher M. Kohlhoff<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="tuttimer1/src.html"><img src="../../../../doc/html/images/prev.png" alt="Prev"></a><a accesskey="u" href="../tutorial.html"><img src="../../../../doc/html/images/up.png" alt="Up"></a><a accesskey="h" href="../../boost_asio.html"><img src="../../../../doc/html/images/home.png" alt="Home"></a><a accesskey="n" href="tuttimer2/src.html"><img src="../../../../doc/html/images/next.png" alt="Next"></a>
</div>
</body>
</html>
