<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>











  
  
  
  
  
  
  
  
  
  
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">












  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <title>Local Time</title>
  <link rel="stylesheet" href="../boostbook.css" type="text/css">











  
  
  
  
  
  
  
  
  
  
  <meta name="generator" content="DocBook XSL Stylesheets V1.68.1">











  
  
  
  
  
  
  
  
  
  
  <link rel="start" href="../index.html" title="The Boost C++ Libraries BoostBook Documentation Subset">











  
  
  
  
  
  
  
  
  
  
  <link rel="up" href="../date_time.html" title="Chapter&nbsp;4.&nbsp;Boost.Date_Time">











  
  
  
  
  
  
  
  
  
  
  <link rel="prev" href="posix_time.html" title="Posix Time">











  
  
  
  
  
  
  
  
  
  
  <link rel="next" href="date_time_io.html" title="Date Time Input/Output">
</head>


<body alink="#0000ff" bgcolor="white" link="#0000ff" text="black" vlink="#840084">











<table cellpadding="2" width="100%">











  <tbody>










    <tr>










      <td valign="top"><img alt="Boost C++ Libraries" src="../../../boost.png" height="86" width="277"></td>











      <td align="center"><a href="../../../index.htm">Home</a></td>











      <td align="center"><a href="../../../libs/libraries.htm">Libraries</a></td>











      <td align="center"><a href="../../../people/people.htm">People</a></td>











      <td align="center"><a href="../../../more/faq.htm">FAQ</a></td>











      <td align="center"><a href="../../../more/index.htm">More</a></td>











    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>











<hr>
<div class="spirit-nav">
<a accesskey="p" href="posix_time.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../date_time.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="date_time_io.html"><img src="../images/next.png" alt="Next"></a>
</div>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both;">
<a name="date_time.local_time"></a>本地时间</h2>










</div>










</div>










</div>











<div class="toc">
<dl>











  <dt><span class="section"><a href="local_time.html#date_time.local_time.time_zone_base">时区(抽象)</a></span></dt>











  <dt><span class="section"><a href="local_time.html#date_time.local_time.posix_time_zone">Posix 时区</a></span></dt>











  <dt><span class="section"><a href="local_time.html#date_time.local_time.tz_database">时区数据库</a></span></dt>











  <dt><span class="section"><a href="local_time.html#date_time.local_time.custom_time_zone">定制时区</a></span></dt>











  <dt><span class="section"><a href="local_time.html#date_time.local_time.local_date_time">本地日期时间</a></span></dt>











  <dt><span class="section"><a href="local_time.html#date_time.local_time.local_time_period">本地时间段</a></span></dt>











</dl>










</div>











<h2>
<a name="id974837"></a>本地时间系统</h2>











<p>
    <a href="local_time.html#local_intro">简介</a> -- 
    <a href="local_time.html#local_ex">用例</a>
  </p>











<a name="local_intro"></a>
<h3>
<a name="id974867"></a>简介</h3>











<p>
    本库支持4种对本地时间管理的主要扩展。它们包括： 
    </p>











<table class="simplelist" summary="Simple list" border="0">











  <tbody>










    <tr>










      <td>local_date_time -- 本地调整后的时间点</td>










    </tr>











    <tr>










      <td>posix_time_zone -- 由 posix 字符串(如："EST10EDT,M10.5.0,M3.5.0/03")定义的时区</td>










    </tr>











    <tr>










      <td>time_zone_database -- 按地区从 .csv 文件(如：America/New York)取出时区</td>










    </tr>











    <tr>










      <td>time_zone -- 抽象的时区接口</td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>











<p>
  </p>











<p>以上扩展一起定义了一个经调整的时间系统来记录与特定地理位置相关的时间。该时间系统使用了 posix_time 时间的所有特性和优点(详情请参见 <a href="posix_time.html" title="Posix Time">posix_time</a>)。它使用一个 time_zone 对象来保存按不同时区进行调整所需的数据/规则。这个 time_zone 对象被用在 date_time 中，通过一个
boost::shared_ptr&lt;boost::local_time::time_zone&gt; 来处理。 </p>











<p>术语 "wall-clock" 表示在特定时区、特定时间点的时钟所显示的时间。Local_time
使用一个 time zone
对象来区分不同的时区以及夏令时的调整。例如：澳大利亚悉尼的2004年10月10日下午5:00相当于美国纽约的2004年10月10日上午3:00,
在两个
wall-clock 时间之间有14个小时的差距。但是，一天以后的同一个时间点将由于两个时区不同的夏令时调整而导致两个 wall-clock
时间之间的差距变为16个小时。local_time 系统可以依靠保存在UTC中的时间点来跟踪这些，而 time_zone 对象则包含了正确计算
wall-clock 时间所需的所有数据。 </p>











<a name="local_ex"></a>
<h3>
<a name="id974915"></a>用例</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th>例子</th>











    <th>说明</th>











  </tr>










  </thead>
  <tbody>











    <tr>











      <td><a href="examples.html#date_time.examples.simple_time_zone" title="Simple Time Zones">简单的时区</a></td>











      <td>多个使用时区的方法的例子。包括 <span class="type">custom_time_zone</span> 和 <span class="type">posix_time_zone</span> 的示范。</td>











    </tr>











    <tr>











      <td><a href="examples.html#date_time.examples.calc_rules" title="Daylight Savings Calc Rules">夏令时计算规则</a></td>











      <td>示范创建所有五个 <span class="type">dst_calc_rule</span> 类型的简单例子。</td>











    </tr>











    <tr>











      <td><a href="examples.html#date_time.examples.seconds_since_epoch" title="Seconds Since Epoch">由 Epoch 起计的秒数</a></td>











      <td>使用 local_date_time 计算自  epoch (1970-Jan-01)起的总秒数的例子。</td>











    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.local_time.time_zone_base"></a>时区(抽象)</h3>










</div>










</div>










</div>











<a href="local_time.html#time_zone_base_intro">简介</a> --
  <a href="local_time.html#time_zone_base_header">头文件</a> --
  <a href="local_time.html#time_zone_base_constr">构造</a> --
  <a href="local_time.html#time_zone_base_accessors">访问器</a><a name="time_zone_base_intro"></a>
<h3>
<a name="id975083"></a>简介</h3>











<p>time_zone_base 类是一个表示时区的抽象基类模板。时间是一组数据和规则，它提供了关于时区的信息。date_time 库用一个 boost::shared_ptr&lt;time_zone_base&gt; 来处理
time_zones. 要在 date_time 库中使用的定制时区类要使用这个 shared_ptr. </p>











<p>为方便使用，time_zone_base 类被 typedef 为
time_zone. 本文档中的所有对 time_zone 引用均表示这个 typedef. </p>











<a name="time_zone_base_header"></a>
<h3>
<a name="id975104"></a>头文件</h3>











<p>time_zone_base 类定义在头文件：
    </p>











<pre class="programlisting">#include "boost/date_time/time_zone_base.hpp"<br>    </pre>











<p>
  </p>











<a name="time_zone_base_constr"></a>
<h3>
<a name="id975126"></a>构造</h3>











<p>在 time_zone_base 类中提供了一个缺省构造函数。在该基类中没有私有数据成员需要初始化。 </p>











<p>模板参数为 time_type (如 posix_time::ptime) 和 CharT (缺省为 char)。
  </p>











<a name="time_zone_base_accessors"></a>
<h3>
<a name="id975149"></a>访问器</h3>











<p>下表所列的所有访问器均为纯虚拟函数。
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th>语法</th>











    <th>说明</th>











  </tr>










  </thead>
  <tbody>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">string_type dst_zone_abbrev();</pre>










      </td>











      <td>返回被表示时区的夏令时缩写。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">string_type std_zone_abbrev();</pre>










      </td>











      <td>返回被表示时区的标准缩写。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">string_type dst_zone_name();</pre>










      </td>











      <td>返回被表示时区的夏令时名字。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">string_type std_zone_name();</pre>










      </td>











      <td>返回被表示时区的标准名字。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool has_dst();</pre>










      </td>











      <td>返回 true 如果该时区没有夏令时偏移。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_type dst_local_start_time(year_type);</pre>










      </td>











      <td>给定年份的夏令时开始日期和时间。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_type dst_local_end_time(year_type);</pre>










      </td>











      <td valign="top">给定年份的夏令时结束日期和时间。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_duration_type base_utc_offset();</pre>










      </td>











      <td>距UTC的时间偏移量(通常为小时数).</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_duration_type dst_offset();</pre>










      </td>











      <td>夏令时的时间偏移量。</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string to_posix_string();</pre>










      </td>











      <td>返回表示该
time_zone_base 对象的 posix 时区字符串。有关 posix 时区字符串的详细说明请见 <a href="local_time.html#date_time.local_time.posix_time_zone" title="Posix Time Zone">posix_time_zone</a>.</td>











    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











</div>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.local_time.posix_time_zone"></a>Posix 时区</h3>










</div>










</div>










</div>











<a href="local_time.html#posix_time_zone_intro">简介</a> --
  <a href="local_time.html#posix_time_zone_notes">重要说明</a> --
  <a href="local_time.html#posix_time_zone_header">头文件</a> --
  <a href="local_time.html#posix_time_zone_constr">构造</a> --
  <a href="local_time.html#posix_time_zone_accessors">访问器</a><a name="posix_time_zone_intro"></a>
<h3>
<a name="id975424"></a>简介</h3>











<p>posix_time_zone 对象是一组数据和规则，它提供了与时区有关的信息。这些信息包括：距UTC的偏移、时区的名字和缩写，以及被称为 <a href="local_time.html#date_time.local_time.dst_calc_rules">dst_calc_rules</a> 的夏令时规则<a href="local_time.html#date_time.local_time.dst_calc_rules"></a>。这些规则被保存为一个 boost::shared_ptr&lt;dst_calc_rules&gt;.
  </p>











<p>为方便使用，系统为 shared_ptr&lt;dst_calc_rules&gt; 提供了一个 typedef.
    </p>











<pre class="programlisting">typedef boost::shared_ptr&lt;dst_calc_rules&gt; local_time::dst_calc_rule_ptr;</pre>











<p>
  </p>











<p>posix_time_zone 是唯一的，因为该对象创建自一个
Posix 时区字符串(IEEE Std 1003.1)。POSIX 时区字符串的格式如下： </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"std&nbsp;offset&nbsp;dst&nbsp;[offset],start[/time],end[/time]"&nbsp;(可带或不带空格)。</p>










</div>











<p>'std' 给出时区的缩写。'offset' 为距UTC的偏移。'dst' 给出时区在夏令时的缩写。第二个 offset 表示在DST时要改变的小时数。'start' 和 'end' 为开始(和结束)DST的日期。'offset' 的格式如下： </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[+|-]hh[:mm[:ss]]&nbsp;{h=0-23,&nbsp;m/s=0-59}</p>










</div>











<p>'time' 和 'offset' 具有相同的格式。'start' 和 'end' 可以是以下三种格式之一： 
    </p>











<div class="literallayout">
<p><br>









&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mm.w.d&nbsp;{month=1-12,&nbsp;week=1-5&nbsp;(5总是表示最后一周),&nbsp;day=0-6}&nbsp;<br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jn&nbsp;{n=1-365&nbsp;Feb29不被计算}&nbsp;<br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;{n=0-365&nbsp;Feb29 在闰年时被计算}</p>










</div>











<p>
  </p>











<p>在以下条件下将抛出异常： 
    </p>











<div class="itemizedlist">
<ul type="disc">











  <li>无效的日期表示(请见 <a href="gregorian.html#date_time.gregorian.date_class" title="Date">date 类</a>)会抛出异常。</li>











  <li>以下情况会抛出 boost::local_time::bad_offset 异常：</li>











  <li>DST开始或结束的偏移量为负或大于24小时。</li>











  <li>UTC时区大于 +12 或小于 -12 小时。</li>











  <li>DST调整量为24小时或更多(正的或负的)时将抛出 boost::local_time::bad_adjustment 异常。</li>











</ul>










</div>











<p>
  </p>











<p>如上所述，字符串的 'offset' 和 '/time' 部分不是必须的。如果没有给出这些部分，则缺省的 'offset' 为 01:00，两次 '/time' 均为 02:00。 </p>











<p>举例如下：
    </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PST-8PDT01:00:00,M4.1.0/02:00:00,M10.1.0/02:00:00"<br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PST-8PDT,M4.1.0,M10.1.0"</p>










</div>











<p>这两个字符串其实是相同的表示(第二个字符串中使用了缺省值)。该时区位于GMT以西8小时，且在夏令时要向前调整1个小时。该时区的夏令时开始于4月第一个星期天的2am, 结束于10月第一个星期天的2am. </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"MST-7"</p>










</div>











<p>这个时区非常简单。它位于GMT以西7个小时且没有夏令时。
    </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"EST10EDT,M10.5.0,M3.5.0/03"</p>










</div>











<p>该字符串表示了澳大利亚悉尼的时区。它位于GMT以东10个小时，其夏令时要向前调整1个小时。由于它位于南半球，所以夏令时开始于10月最后一个星期天的2am，结束于3月最后一个星期天的3am. </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"FST+3FDT02:00,J60/00,J304/02"</p>










</div>











<p>它表示了一个位于GMT以东3个小时的假想的时区。其夏令时要向前调整2个小时，开始于3月1日的午夜，结束于10月31日的2am.
其中的 'J' 指明 start/end 的表示从1起计且不计2月29日。 </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"FST+3FDT,59,304"</p>










</div>











<p>这个表示中的'59'尤其重要。在 start 和 end 日期的表示中没有
'J', 表示天数的计数从0起计且结束于365. 如果你算一下，可以算出总天数为366天。如果是闰年这没有问题，但是在非闰年就不存在 '59'
(Feb-29) 这天。所以，它将构造一个有效的 posix_time_zone 对象，但是如果在非闰年访问 '59' 这天将会抛出异常。如：
</p>











<pre class="programlisting">posix_time_zone leap_day(std::string("FST+3FDT,59,304"));<br>leap_day.dst_local_start_time(2004); // ok<br>leap_day.dst_local_start_time(2003); // 抛出异常</pre>











<p>
  </p>











<p> posix_time_zone 对象是通过一个
boost::shared_ptr&lt;local_time::time_zone_base&gt; 被使用的。为方便使用，系统提供了对
boost::shared_ptr&lt;local_time::time_zone_base&gt; 的 typedef: </p>











<pre class="programlisting">typedef boost::shared_ptr&lt;time_zone_base&gt; local_time::time_zone_ptr;</pre>











<p>
  </p>











<p>有关 time_zone 和 posix_time_zone 的用法的例子，请见 <a href="examples.html#date_time.examples.simple_time_zone" title="Simple Time Zones">简单的时区</a>。
  </p>











<a name="posix_time_zone_notes"></a>
<h3>
<a name="id975661"></a>重要说明</h3>











<div class="itemizedlist">
<ul type="disc">











  <li>posix_time_zone 对象使用标准的和夏令时的缩写来代替全称(请见后面的 <a href="local_time.html#posix_time_zone_accessors">访问器</a>)。</li>











  <li>'Jn' 和 'n' 日期表示法不能在一个字符串中混用。如："FST+3FDT,59,J304" </li>











  <li>'n' 日期表示法中的 59 表示 Feb-29. 不要在非闰年时访问它，否则将抛出异常。</li>











</ul>










</div>











<a name="posix_time_zone_header"></a>
<h3>
<a name="id975698"></a>头文件</h3>











<p>包含单个头文件即可引入所有 boost::local_time 类型、函数和 IO 操作符。
    </p>











<pre class="programlisting">#include "boost/date_time/local_time/local_time.hpp"</pre>











<p>
  </p>











<a name="posix_time_zone_constr"></a>
<h3>
<a name="id975721"></a>构造</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th>语法</th>











    <th>例子</th>











  </tr>










  </thead>
  <tbody>










    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">posix_time_zone(std::string)</pre>










      </td>











      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string nyc("EST-5EDT,M4.1.0,M10.5.0");<br>time_zone_ptr zone(new posix_time_zone(nyc));</pre>











            </td>











    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="posix_time_zone_accessors"></a>
<h3>
<a name="id975784"></a>访问器</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string dst_zone_abbrev()</pre>










      </td>











      <td>返回被表示时区的夏令时缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_zone_abbrev(); // "EDT"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string std_zone_abbrev()</pre>










      </td>











      <td>返回被表示时区的标准缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;std_zone_abbrev(); // "EST"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string dst_zone_name()</pre>










      </td>











      <td>返回被表示时区的夏令时缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_zone_name(); // "EDT"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string std_zone_name()</pre>










      </td>











      <td>返回被表示时区的标准缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;std_zone_name(); // "EST"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool has_dst()</pre>










      </td>











      <td>返回 true 如果 time_zone 中指向 dst_calc_rules 的 shared_ptr 非空。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;has_dst(); // true<br>phx_zone_sh_ptr-&gt;has_dst(); // false</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ptime dst_local_start_time(greg_year)</pre>










      </td>











      <td>给定年份的夏令时开始日期和时间。如果该时区没有夏令时，则返回 not_a_date_time.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_local_start_time(2004);<br>// 2004-Apr-04 02:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ptime dst_local_end_time(greg_year)</pre>










      </td>











      <td>给定年份的夏令时结束日期和时间。如果该时区没有夏令时，则返回 not_a_date_time.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_local_end_time(2004);<br>// 2004-Oct-31 02:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_duration base_utc_offset()</pre>










      </td>











      <td>距UTC的偏移量(通常以小时数表示)。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;base_utc_offset(); // -05:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">posix_time::time_duration dst_offset()</pre>










      </td>











      <td>夏令时的时间偏移量。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_offset(); // 01:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string to_posix_string()</pre>










      </td>











      <td>返回该
time_zone_base 对象的 posix 时区字符串表示。取决于 time_zone
对象是如何创建的，返回的字符串的日期表示格式可能是 'M' 格式或 'n' 格式。每个可以用 'J' 格式来表示的日期都可以表示为 'n'
格式。反之则不然，所以在这些日期表示法中只使用了 'n' 格式。有关 posix 时区字符串的详细描述，请见 <a href="local_time.html#date_time.local_time.posix_time_zone" title="Posix Time Zone">posix_time_zone</a>.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;to_posix_string();<br>// "EST-05EDT+01,M4.1.0/02:00,M10.5.0/02:00"<br>phx_zone_sh_ptr-&gt;to_posix_string();<br>// "MST-07"<br>            </pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











</div>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.local_time.tz_database"></a>时区数据库</h3>










</div>










</div>










</div>











<a href="local_time.html#tz_database_intro">简介</a> --
  <a href="local_time.html#tz_database_header">头文件</a> --
  <a href="local_time.html#tz_database_constr">构造</a> --
  <a href="local_time.html#tz_database_accessors">访问器</a> --
  <a href="local_time.html#tz_database_datafile">数据文件的细节</a><a name="tz_database_intro"></a>
<h3>
<a name="id976209"></a>简介</h3>











<p> local_time 系统依赖于保存时区信息的能力。我们的时区数据库(tz_database)就是一个永久保存这些数据的方法。它提供了多个(目前为377个)时间的描述。这些描述基于在 <a href="http://www.twinsun.com/tz/tz-link.htm" target="_top">zoneinfo 数据库</a> 中的数据。这些描述保存在文件：</p>











<pre class="screen">libs/date_time/data/date_time_zonespec.csv</pre>











<p>中。该文件已包含了多个时区的描述；用户可以对它进行修改，增加(或删除)一些时区来适应它们的应用程序。 请参看 <a href="local_time.html#tz_database_datafile">数据文件的细节</a>，学习如何完成这一工作。
  </p>











<a name="tz_database_header"></a>
<h3>
<a name="id976254"></a>头文件</h3>











<p>包含单个头文件就可以引入所有 boost::local_time 类型、函数和 IO 操作符。
    </p>











<pre class="programlisting">#include "boost/date_time/local_time/local_time.hpp"<br>    </pre>











<p>
  </p>











<a name="tz_database_constr"></a>
<h3>
<a name="id976277"></a>构造</h3>











<p>只有一个构造函数，不带参数，它创建一个空的数据库。由用户来组装该数据库。典型的方法是导入所需的数据文件，不过也可以通过 <code class="computeroutput">add_record(...)</code> 函数来完成(请见 <a href="local_time.html#tz_database_accessors">访问器表</a>)。如果给定的时区规格文件无法找到，将抛出 <code class="computeroutput">local_time::data_not_accessible</code> 异常。如果给定文件的字段数不正确，则抛出 <code class="computeroutput">local_time::bad_field_count</code> 异常。
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>










  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">tz_database()</pre>










      </td>











      <td>构造函数，创建一个空的数据库。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">tz_database tz_db;</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool load_from_file(std::string)</pre>










      </td>











      <td>参数为一个时区规格 csv 文件(有关该文件的内容细节请见 <a href="local_time.html#tz_database_datafile">数据文件的细节</a>)的路径。该函数以时区规格文件中的时区记录来组装数据库。如果给定的时区规格文件无法找到，将抛出 <code class="computeroutput">local_time::data_not_accessible</code> 异常。如果给定文件的字段数不正确，则抛出 <code class="computeroutput">local_time::bad_field_count</code> 异常。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">tz_database tz_db;<br>tz_db.load_from_file("./date_time_zonespec.csv");</pre>











            </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="tz_database_accessors"></a>
<h3>
<a name="id976440"></a>访问器</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool tz_db.add_record(std::string id, <br>                      <a href="local_time.html#date_time.local_time.custom_time_zone_ptr">time_zone_ptr</a> tz);</pre>










      </td>











      <td>增加一个 time_zone, 或一个 posix_time_zone, 到数据库中。ID 为该时区的区域名(如： "America/Phoenix")。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr zone(<br>  new posix_time_zone("PST-8PDT,M4.1.0,M10.1.0")<br>);<br>std::string id("America/West_Coast");<br>tz_db.add_record(id, zone);</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  tz_db.time_zone_from_region(string id);</pre>










      </td>











      <td>通过 time_zone_ptr 返回一个 time_zone, 它与数据文件所列的区域名相匹配。如果没有找到匹配项，则返回空指针。 </td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr nyc =<br>  tz_db.time_zone_from_region("America/New_York");</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">vector&lt;string&gt; tz_db.region_list();</pre>










      </td>











      <td>返回一个字符串 vector，其中保存了来自数据库的所有区域 ID 字符串。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::vector&lt;std::string&gt; regions;<br>regions = tz_db.region_list();</pre>











            </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="tz_database_datafile"></a>
<h3>
<a name="id976598"></a>数据文件的细节</h3>











<a href="local_time.html#tz_database_fields">字段描述/细节</a>
<p>存放被
boost::local_time::tz_database 使用的 zone_specs 数据的 csv 文件可以由库用户进行定制。在定制该文件(或创建你自己的文件)时，必须遵循特定的格式。 </p>











<p>第一行要包含列头，而且这行不会被 tz_database 处理。
  </p>











<p>每个记录(即每行)必须有11个字段。其中有些字段可以为空。每个字段(即使是空的)必须用双引号括起来。 </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 例如：<br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"America/Phoenix"&nbsp;&lt;- 带引号的字符串<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;-
空字段<br>











&nbsp;&nbsp;&nbsp;&nbsp;</p>










</div>











<p>
  </p>











<p>有的字段用于表示时间的长度。这些字段的格式必须是：
    </p>











<div class="literallayout">
<p><br>











&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"{+|-}hh:mm[:ss]"&nbsp;&lt;- 时间长度的格式<br>











&nbsp;&nbsp;&nbsp;&nbsp;</p>










</div>











<p>其中加号或减号是必须的，而秒数是可选的。
  </p>











<p>因为有些时区不使用夏令时，所以不是 zone_spec 的每个字段都必须包含有值。所有
zone_specs 必须至少有一个 ID 和 GMT 偏移量。使用夏令时的时区必须走填写所有字段，除了：STD ABBR, STD
NAME, DST NAME. 你要留意，对于使用夏令时的时区，DST ABBR 是必须的(更多详情请见字段描述)。 </p>











<a name="tz_database_fields"></a>
<h3>
<a name="id976674"></a>字段描述/细节</h3>











<p>
    </p>











<div class="itemizedlist">
<ul type="disc">











  <li>
        ID
        
    
    
    
    
    
    
    
    
    
    
    <p>包含 zone_spec 的标识字符串。可以是任意字符串，只要它是唯一的。不能有两个ID相同。 </p>











  </li>











  <li>
        STD ABBR
      </li>











  <li>
        STD NAME
      </li>











  <li>
        DST ABBR
      </li>











  <li>
        DST NAME
        
    
    
    
    
    
    
    
    
    
    
    <p>这四项是时区所用的名字和缩写。因为这些字段可以为任意字符串，你必须要小心。这些字段的字符串将被用于多个 local_time 类的输出中。 </p>











  </li>











  <li>
        GMT 偏移量
        
    
    
    
    
    
    
    
    
    
    
    <p>这是一个小时数，当被加到UTC上后，可以得到未进行夏令时调整前的本地时间。以下是一些例子：美国/纽约的偏移量为-5小时，而非洲/开罗的偏移量则为+2小时。它的格式必须遵循前面所说的时间长度格式。 </p>











  </li>











  <li>
        DST 调整量
        
    
    
    
    
    
    
    
    
    
    
    <p>这是使用夏令时时要加到 gmt_offset 上的时间数量。其格式必须遵循前面所说的时间长度格式。 </p>











    
    
    
    
    
    
    
    
    
    
    <p>注：需要更多的表示规则的能力 - tz_database 的这部分不够完善。
        </p>











  </li>











  <li>
        DST 开始日期规则
        
    
    
    
    
    
    
    
    
    
    
    <p>这是一个特定格式的字符串，表示每天哪一天进行夏令时转换。它本身包含三个字段，由分号分隔。 </p>











    
    
    
    
    
    
    
    
    
    
    <div class="orderedlist">
    
    
    
    
    
    
    
    
    
    
    <ol type="1">











      <li> 第一个字段表示当月中的第n个周日。可取的值为：1(第一周)，2(第二周)，3(第三周)，4(第四周)，5(第五周)，和 -1(最后一周)。 </li>











      <li>第二个字段表示周中的第几天，从0到6(星期天=0)。
            </li>











      <li>第三个字段表示第几月，从1到12(一月=1)。
            </li>











    
    
    
    
    
    
    
    
    
    
    </ol>










    </div>











    
    
    
    
    
    
    
    
    
    
    <p>例如："-1;5;9"="九月最后一个星期五"，"2;1;3"="三月第二个星期一"
        </p>











  </li>











  <li>开始时间
        
    
    
    
    
    
    
    
    
    
    
    <p>开始时间为开始夏令时转换当天午夜后的小时数。表示该天中开始进行转换的时间点(以24小时格式表示)。格式必须遵循前文所说的时间长度格式，且必须为正。 </p>











  </li>











  <li>
        DST 结束日期规则
        
    
    
    
    
    
    
    
    
    
    
    <p>请见 DST 开始日期规则。不同的是，本项表示的是夏令时结束的日期(转换为 STD)。
        </p>











  </li>











  <li>结束时间
        
    
    
    
    
    
    
    
    
    
    
    <p>与开始时间相同。
        </p>











  </li>











</ul>










</div>











<p>
  </p>











</div>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.local_time.custom_time_zone"></a>定制时区</h3>










</div>










</div>










</div>











<a href="local_time.html#custom_time_zone_intro">简介</a> --
  <a href="local_time.html#custom_time_zone_header">头文件</a> --
  <a href="local_time.html#custom_time_zone_constr">构造</a> --
  <a href="local_time.html#custom_time_zone_accessors">访问器</a> --
  <a href="local_time.html#custom_time_zone_dependents">相关类型</a><a name="custom_time_zone_intro"></a>
<h3>
<a name="id976870"></a>简介</h3>











<p>custom_time_zone 对象是一组数据和规则，提供了关于时区的相关信息。这些信息包括有：与UTC的偏移量，时区的名字和缩写，被称为 <a href="local_time.html#date_time.local_time.dst_calc_rules">dst_calc_rules</a> 的夏令时规则。这些规则通过一个 boost::shared_ptr&lt;dst_calc_rules&gt; 来处理。不是所有时区都使用夏令时，因此，time_zone
对象可以带一个空赋值的 shared_ptr. </p>











<p>为方便使用，提供了对 shared_ptr&lt;dst_calc_rules&gt; 的一个 typedef.
    </p>











<pre class="programlisting">typedef boost::shared_ptr&lt;dst_calc_rules&gt; local_time::dst_calc_rule_ptr;</pre>











<p>
  </p>











<a name="date_time.local_time.custom_time_zone_ptr"></a>
<p>time_zone 对象通过一个
boost::shared_ptr&lt;local_time::time_zone&gt; 来使用。为方便起见，提供了对 boost::shared_ptr&lt;local_time::time_zone&gt; 的 typedef:
</p>











<pre class="programlisting">typedef boost::shared_ptr&lt;time_zone&gt; local_time::time_zone_ptr;</pre>











<p>
  </p>











<a name="custom_time_zone_header"></a>
<h3>
<a name="id976941"></a>头文件</h3>











<p>包含单个头文件即可引入所有 boost::local_time 类型、函数和 IO 操作符。
    </p>











<pre class="programlisting">#include "boost/date_time/local_time/local_time.hpp"</pre>











<p>
  </p>











<a name="custom_time_zone_constr"></a>
<h3>
<a name="id976964"></a>构造</h3>











<p>custom_time_zone 的构造依赖于四个对象：一个 
    <a href="posix_time.html#date_time.posix_time.time_duration" title="Time Duration">time_duration</a>, 一个 <a href="local_time.html#time_zone_names">time_zone_names</a>, 一个 <a href="local_time.html#dst_adjustment_offsets">dst_adjustment_offsets</a>, 和一个指向 <a href="local_time.html#date_time.local_time.dst_calc_rules">dst_calc_rule</a> 的 shared_ptr.
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th>语法</th>











    <th>例子</th>











  </tr>










  </thead>
  <tbody>










    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">custom_time_zone(...)<br>  Parameters:<br>    <a href="local_time.html#time_zone_names">names</a>, <br>    <a href="posix_time.html#date_time.posix_time.time_duration" title="Time Duration">gmt_offset</a>, <br>    <a href="local_time.html#dst_adjustment_offsets">dst_offsets</a>, <br>    <a href="local_time.html#date_time.local_time.dst_calc_rules">dst_rules</a> </pre>










      </td>











      <td>有关 time_zone 的用法请见 <a href="examples.html#date_time.examples.simple_time_zone" title="Simple Time Zones">简单的时区</a>。</td>











    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="custom_time_zone_accessors"></a>
<h3>
<a name="id977098"></a>访问器</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string dst_zone_abbrev()</pre>










      </td>











      <td>返回被表示时区的夏令时缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_zone_abbrev();<br>// "EDT"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string std_zone_abbrev()</pre>










      </td>











      <td>返回被表示时区的标准缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;std_zone_abbrev();<br>// "EST"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string dst_zone_name()</pre>










      </td>











      <td>返回被表示时区的夏令时名字。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_zone_name(); <br>// "Eastern Daylight Time"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string std_zone_name()</pre>










      </td>











      <td>返回被表示时区的标准名字。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;std_zone_name();<br>// "Eastern Standard Time"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool has_dst()</pre>










      </td>











      <td>返回 true 如果 custom_time_zone 中指向 dst_calc_rules 的 shared_ptr 为非空。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;has_dst();<br>// true<br>phx_zone_sh_ptr-&gt;has_dst();<br>// false</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">dst_local_start_time(...)<br>  Return Type:<br>    ptime<br>  Parameter:<br>    greg_year</pre>










      </td>











      <td>给定年份的夏令时开始日期和时间。如果该时区无夏令时则返回 not_a_date_time.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_ptr-&gt;dst_local_start_time(2004);<br>// 2004-Apr-04 02:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">dst_local_end_time(...)<br>  Return Type:<br>    ptime<br>  Parameter:<br>    greg_year</pre>










      </td>











      <td>给定年份的夏令时结束日期和时间。如果该时区无夏令时则返回 not_a_date_time.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_ptr-&gt;dst_local_end_time(2004);<br>// 2004-Oct-31 02:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_duration base_utc_offset()</pre>










      </td>











      <td>与UTC之间的时间偏移量(通常以小时表示)。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_ptr-&gt;base_utc_offset();<br>// -05:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_duration dst_offset()</pre>










      </td>











      <td>夏令时的调整时间数。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_zone_sh_ptr-&gt;dst_offset();<br>// 01:00</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string to_posix_string()</pre>










      </td>











      <td>返回表示该
time_zone 对象的 posix 时区字符串。取决于 time_zone
对象是如何创建的，返回的字符串的日期表示格式可能是 'M' 格式或 'n' 格式。每个可以用 'J' 格式来表示的日期都可以表示为 'n'
格式。反之则不然，所以在这些日期表示法中只使用了 'n' 格式。有关 posix 时区字符串的详细描述，请见 <a href="local_time.html#date_time.local_time.posix_time_zone" title="Posix Time Zone">posix_time_zone</a>.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_ptr-&gt;to_posix_string();<br>// "EST-05EDT+01,M4.1.0/02:00,M10.5.0/02:00"<br>phx_ptr-&gt;to_posix_string();<br>// "MST-07"<br>            </pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="custom_time_zone_dependents"></a>
<h3>
<a name="id977471"></a>相关类型</h3>











<a href="local_time.html#time_zone_names">时区名</a> --
  <a href="local_time.html#dst_adjustment_offsets">Dst 调整量</a> --
  <a href="local_time.html#date_time.local_time.dst_calc_rules">夏令时计算规则</a><a name="time_zone_names"></a>
<h3>
<a name="id977504"></a>时区名</h3>











<p> time_zone_names_base 类型是带四个字符串的不可变模板类。每个字符串分别为标准时和夏令时的全称和缩写。time_zone_names 类型是
time_zone_names_base&lt;char&gt; 的 typedef. </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_names(...)<br>  Parameters:<br>    string std_name<br>    string std_abbrev<br>    string dst_name<br>    string dst_abbrev</pre>










      </td>











      <td>唯一的构造函数，必须提供所有四个字符串。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">string sn("Eastern Standard Time");<br>string sa("EST");<br>string dn("Eastern Daylight Time");<br>string da("EDT");<br>time_zone_names nyc_names(sn, sa, <br>                          dn, da);</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string std_zone_name()</pre>










      </td>











      <td>返回标准的时区名。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_names.std_zone_name();<br>// "Eastern Standard Time"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string std_zone_abbrev()</pre>










      </td>











      <td>返回标准的时区缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_names.std_zone_abbrev();<br>// "EST"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string dst_zone_name()</pre>










      </td>











      <td>返回夏令时的时区名。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_names.std_zone_name();<br>// "Eastern Daylight Time"</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">std::string dst_zone_abbrev()</pre>










      </td>











      <td>返回夏令时的时区缩写。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nyc_names.std_zone_abbrev();<br>// "EDT"</pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="dst_adjustment_offsets"></a>
<h3>
<a name="id977513"></a>Dst 调整量</h3>











<p>dst_adjustment_offsets 类型是三个 <a href="posix_time.html#date_time.posix_time.time_duration" title="Time Duration">时间长度</a> 对象的集合。
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">dst_adjustment_offsets(...)<br>  Parameters:<br>    time_duration dst_adjust<br>    time_duration start_offset<br>    time_duration end_offset</pre>










      </td>











      <td>第一个 time_duration 是夏令时的调整量。第二个是在夏令时开始当天的夏令时开始时间。第三个为在夏令时结束当天的夏令时结束时间。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">dst_adjustment_offsets(hours(1), <br>                       hours(2), <br>                       hours(2));</pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="date_time.local_time.dst_calc_rules"></a>
<h3>
<a name="id977813"></a>夏令时计算规则</h3>











<p>夏令时计算规则，称为 dst_calc_rules, 是一系列对象，将多个合适的 <a href="gregorian.html#date_time.gregorian.date_algorithms" title="Date Generators/Algorithms">日期生成器</a> 组合起来以形成规则集。单个规则对象通过 dst_calc_rule_ptr 使用。
  </p>











<p>有关所有五个 dst_calc_rule 类型的完整例子，请见：<a href="examples.html#date_time.examples.calc_rules" title="Daylight Savings Calc Rules">计算规则举例</a>。
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th>语法</th>











    <th>说明</th>











  </tr>










  </thead>
  <tbody>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">partial_date_dst_rule(...)<br>  Parameters:<br>    start_rule<br>    end_rule</pre>










      </td>











      <td>开始和结束规则均为类型 gregorian::partial_date.</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">first_last_dst_rule(...)<br>  Parameters:<br>    start_rule<br>    end_rule</pre>










      </td>











      <td>DST 开始规则为类型
gregorian::first_day_of_the_week_in_month 而结束规则为类型
gregorian::last_day_of_the_week_in_month.</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">last_last_dst_rule(...)<br>  Parameters:<br>    start_rule<br>    end_rule</pre>










      </td>











      <td>开始和结束规则均为类型 gregorian::last_day_of_the_week_in_month.</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nth_last_dst_rule(...)<br>  Parameters:<br>    start_rule<br>    end_rule</pre>










      </td>











      <td>DST 开始规则为类型
gregorian::nth_day_of_the_week_in_month 而结束规则为类型
gregorian::last_day_of_the_week_in_month.</td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">nth_kday_dst_rule(...)<br>  Parameters:<br>    start_rule<br>    end_rule)<br>(see note* below)</pre>











            </td>











      <td>两个规则均为类型 gregorian::nth_day_of_the_week_in_month.</td>











    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
    </p>











<p> * 注：名字 "nth_kday_dst_rule" 有点模糊。所以使用了更为清晰的名字 "nth_day_of_the_week_in_month_dst_rule". </p>











<p>
  </p>











</div>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.local_time.local_date_time"></a>本地日期时间</h3>










</div>










</div>










</div>











<a href="local_time.html#local_date_time_intro">简介</a> --
  <a href="local_time.html#local_date_time_header">头文件</a> --
  <a href="local_time.html#local_date_time_clock_constr">从时钟构造</a> --
  <a href="local_time.html#local_date_time_constr">构造</a> --
  <a href="local_time.html#local_date_time_accessors">访问器</a> --
  <a href="local_time.html#local_date_time_operators">操作符</a> --
  <a href="local_time.html#local_date_time_tm_func">Struct tm 函数</a><a name="local_date_time_intro"></a>
<h3>
<a name="id978048"></a>简介</h3>











<p>local_date_time 对象是一个时间点加上一个相应时区。该时间在内部表示为 UTC.
  </p>











<a name="local_date_time_header"></a>
<h3>
<a name="id978065"></a>头文件</h3>











<p>包含单个头文件即可引入所有 boost::local_time 类型、函数和 IO 操作符。
    </p>











<pre class="programlisting">      #include "boost/date_time/local_time/local_time.hpp"<br>    </pre>











<p>
  </p>











<a name="local_date_time_clock_constr"></a>
<h3>
<a name="id978089"></a>从时钟构造</h3>











<p>从时钟创建一个 local_date_time 对象，精度可以是秒或次秒级。
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead><tr>











    <th>语法</th>











    <th>例子</th>











  </tr>










  </thead>
  <tbody>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_microsec_clock(...)<br>  Return Type:<br>    local_date_time<br>  Parameter:<br>    time_zone_ptr</pre>










      </td>











      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr zone(<br>  new posix_time_zone("MST-07")<br>);<br>local_date_time ldt = <br>  local_microsec_clock::local_time(<br>    zone);</pre>











            </td>











    </tr>











    <tr>











      <td valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_sec_clock(...)<br>  Return Type:<br>    local_date_time <br>  Parameter:<br>    time_zone_ptr</pre>










      </td>











      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr zone(<br>  new posix_time_zone("MST-07")<br>);<br>local_date_time ldt = <br>  local_sec_clock::local_time(zone);</pre>











            </td>











    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="local_date_time_constr"></a>
<h3>
<a name="id978181"></a>构造</h3>











<p>要构造一个 local_date_time 对象，可以用一个 ptime 加一个 time_zone_ptr 来构造，其中 ptime
表示 UTC 时间。从一个带有日期、time_duration 和 time_zone_ptr 的 wall-clock
表示进行构造，要解决以下复杂性。 </p>











<p>从一个 wall-clock
表示进行构造可能导致对某个时区进行不同的位移，这取决于该时区的夏令时规则。这意味着也可能会创建出一个不存在的或重复的，以UTC表示的
local_date_time. 这种情况会发生在刚好转入夏令时和从夏令时转出的时候。用户有两个选择来处理这种情况：用一个 bool
标志来表示该时间是否为夏令时，或者使用一个
enum 来表示遇到这种情形时要做什么。
</p>











<p>当给定的 time_zone 没有夏令时规则时，该 bool 标志将被忽略。当给定的时间标签的夏令时状态被计算出来并且与该标志不匹配时，将抛出一个 <code class="computeroutput">local_time::dst_not_valid</code> 异常。如果时间标签是无效的(即不存在)，则抛出 <code class="computeroutput">local_time::time_label_invalid</code> 异常。
  </p>











<p>在 <code class="computeroutput">local_date_time::DST_CALC_OPTIONS</code> enum 是有两个元素：<code class="computeroutput">EXCEPTION_ON_ERROR</code> 和 <code class="computeroutput">NOT_DATE_TIME_ON_ERROR</code>. 可能抛出的异常是 <code class="computeroutput">local_time::ambiguous_result</code> 或 <code class="computeroutput">local_time::time_label_invalid</code>. 如果时间标签无效或不明确时，<code class="computeroutput">NOT_DATE_TIME_ON_ERROR</code> 将时间值设为特定的 <code class="computeroutput">local_time::not_a_date_time</code>.
  </p>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time(...)<br>  Parameters:<br>    posix_time::ptime<br>    time_zone_ptr</pre>










      </td>











      <td>给定的时间应为 UTC. 因此给定时间将被根据时区的偏移量来调整。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 3am, 2004-Nov-05 本地时间<br>ptime pt(date(2004,Nov,5), <br>         hours(10));<br>time_zone_ptr zone(<br>  new posix_time_zone("MST-07"));<br>local_date_time az(pt, zone);</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time(...)<br>  Parameters:<br>    date<br>    time_duration <br>    time_zone_ptr<br>    bool</pre>










      </td>











      <td>传入的时间信息被理解为在被传入时区的时间。必须传入 DST 标志以表示该时间是否为夏令时。可能抛出 <code class="computeroutput">dst_not_valid</code> 或 <code class="computeroutput">time_label_invalid</code> 异常。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">date d(2004,Nov,5);<br>time_duration td(5,0,0,0);<br>string z("PST-8PDT,M4.1.0,M10.1.0")<br>time_zone_ptr zone(<br>  new posix_time_zone(z));<br>local_date_time nyc(d, td, <br>                    zone, false);</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time(...)<br>  Parameters:<br>    date<br>    time_duration<br>    time_zone_ptr<br>    DST_CALC_OPTIONS</pre>










      </td>











      <td>被传入的时间信息被理解为在被传入时区的时间。DST 标志会根据指定规则计算出来。可能抛出 <code class="computeroutput">ambiguous_result</code> 或 <code class="computeroutput">time_label_invalid</code> 异常。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">date d(2004,Nov,5);<br>time_duration td(5,0,0,0);<br>string z("PST-8PDT,M4.1.0,M10.1.0")<br>time_zone_ptr zone(<br>  new posix_time_zone(z));<br>local_date_time nyc(d, td, zone, <br>  NOT_DATE_TIME_ON_ERROR);</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time(local_date_time);</pre>










      </td>











      <td>复制构造函数。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time az_2(az);</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time(...)<br>  Parameters:<br>    special_values<br>    time_zone_ptr</pre>










      </td>











      <td>特殊值构造函数。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr zone(<br>  new posix_time_zone("MST-07")<br>);<br>local_date_time nadt(not_a_date_time, <br>                     zone);<br>// 缺省为 NULL time_zone_ptr<br>local_date_time nadt(pos_infin);</pre>











            </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="local_date_time_accessors"></a>
<h3>
<a name="id978500"></a>访问器</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr zone()</pre>










      </td>











      <td>通过一个 time_zone_ptr 返回相关联的 time_zone 对象。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen"></pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_dst()</pre>










      </td>











      <td>判断时间值是否在相关时区的DST中。</td>











    </tr>











    <tr>










      <td>&nbsp;</td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ptime utc_time()</pre>










      </td>











      <td>将本地时间转为UTC值。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ptime pt(date(2004,Nov,5), <br>         hours(10));<br>time_zone_ptr zone(<br>  new posix_time_zone("MST-07"));<br>local_date_time az(pt, zone);<br>az.utc_time(); // 10am 2004-Nov-5</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ptime local_time()</pre>










      </td>











      <td>返回该对象的本地时间(Wall-clock)。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ptime pt(date(2004,Nov,5), <br>         hours(10));<br>time_zone_ptr zone(<br>  new posix_time_zone("MST-07"));<br>local_date_time az(pt, zone);<br>az.utc_time(); // 10am 2004-Nov-5<br>az.local_time(); // 3am 2004-Nov-5</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_in(...)<br>  Return Type:<br>    local_date_time <br>  Parameters:<br>    time_zone_ptr<br>    time_duration</pre>










      </td>











      <td>给定某个时区，返回该时区与调用对象相同UTC时间的 local_date_time，可能会加上一段 time_duration.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time nyc = az.local_time_in(nyc_zone);<br>// nyc == 7am 2004-Nov-5</pre>











            </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_infinity() const</pre>










      </td>











      <td>返回 true 如果 local_date_time 为正无限或负无限。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time ldt(pos_infin); <br>ldt.is_infinity(); // --&gt; true</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_neg_infinity() const</pre>










      </td>











      <td>返回 true 如果 local_date_time 为负无限。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time ldt(neg_infin);<br>ldt.is_neg_infinity(); // --&gt; true</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_pos_infinity() const</pre>










      </td>











      <td>返回 true 如果 local_date_time 为正无限。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time ldt(neg_infin); <br>ldt.is_pos_infinity(); // --&gt; true</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_not_a_date_time() const</pre>










      </td>











      <td>返回 true 如果该值不是一个有效日期。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time ldt(not_a_date_time);<br>ldt.is_not_a_date_time(); // --&gt; true</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_special() const</pre>










      </td>











      <td>返回 true 如果 local_date_time 为任一 <code class="computeroutput">special_value</code>
      </td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time ldt(pos_infin); <br>local_date_time ldt2(not_a_date_time);<br>time_zone_ptr <br>  mst(new posix_time_zone("MST-07"));<br>local_date_time <br>  ldt3(local_sec_clock::local_time(mst));<br>ldt.is_special(); // --&gt; true<br>ldt2.is_special(); // --&gt; true<br>ldt3.is_special(); // --&gt; false</pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="local_date_time_operators"></a>
<h3>
<a name="id996315"></a>操作符</h3>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator&lt;&lt;</pre>










      </td>











      <td>流输出操作符。该操作符是 v1.33
中所增加的对 date_time 的 IO 的一部分。有关详情请见 <a href="date_time_io.html" title="Date Time Input/Output">日期时间 IO</a> 一节。缺省的输出请见下例。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr zone(new posix_time_zone("MST-07");<br>local_date_time ldt(date(2005,Jul,4),<br>                    hours(20), <br>                    false);<br>std::cout &lt;&lt; ldt &lt;&lt; std::endl;<br>// "2005-Jul-04 20:00:00 MST"<br>          </pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator&gt;&gt;</pre>










      </td>











      <td>流输入操作符。该操作符是 v1.33
中所增加的对 date_time 的 IO 的一部分。有关详情请见 <a href="date_time_io.html" title="Date Time Input/Output">日期时间 IO</a> 一节。当前 ，<code class="computeroutput">local_date_time</code>
对象只能使用 Posix 时区字符串进行流输入。有关 Posix 时区字符串的完整描述请见 <a href="local_time.html#posix_time_zone_intro">posix_time_zone</a> 类的相关文档。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">stringstream ss;<br>ss.str("2005-Jul-04 20:00:00 MST-07");<br>ss &gt;&gt; ldt;<br>          </pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator==, operator!=,<br>operator&gt;, operator&lt;,<br>operator&gt;=, operator&lt;=</pre>










      </td>











      <td>完整的比较操作符。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ldt1 == ldt2, 等等</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator+, operator+=,<br>operator-, operator-=</pre>










      </td>











      <td><code class="computeroutput">local_date_time</code> 和日期长度类型间的加法、减法以及相关简写操作符。日期长度类型包括有：<code class="computeroutput">days</code>, <code class="computeroutput">months</code>, 和 <code class="computeroutput">years</code>.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ldt + days(5), 等等</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator+, operator+=,<br>operator-, operator-=</pre>










      </td>











      <td><code class="computeroutput">local_date_time</code> 和 <code class="computeroutput">time_duration</code> 间的加法、减法以及相关简写操作符。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">ldt + hours(5), 等等</pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<a name="local_date_time_tm_func"></a>
<h3>
<a name="id996601"></a>Struct tm 函数</h3>











<p>系统提供了将 <code class="computeroutput">local_date_time</code> 对象转换为 <code class="computeroutput">tm</code> 结构的函数。</p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">tm to_tm(local_date_time)</pre>










      </td>











      <td>将 <code class="computeroutput">local_date_time</code> 对象转换为 <code class="computeroutput">tm</code> 结构的函数。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 6am, 2005-Jul-05 本地时间<br>std::string z("EST-05EDT,M4.1.0,M10.1.0");<br>ptime pt(date(2005,Jul,5), <br>         hours(10));<br>time_zone_ptr zone( new posix_time_zone(z));<br>local_date_time ldt(pt, zone);<br>tm ldt_tm = to_tm(ldt);<br>/* tm_year =&gt; 105<br>   tm_mon  =&gt; 6<br>   tm_mday =&gt; 5<br>   tm_wday =&gt; 2 (星期二)<br>   tm_yday =&gt; 185<br>   tm_hour =&gt; 6<br>   tm_min  =&gt; 0<br>   tm_sec  =&gt; 0<br>   tm_isddst =&gt; 1 */</pre>











	  </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











</div>











<div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="date_time.local_time.local_time_period"></a>本地时间段</h3>










</div>










</div>










</div>











<a href="local_time.html#local_time_period_intro">简介</a> --
  <a href="local_time.html#local_time_period_header">头文件</a> --
  <a href="local_time.html#local_time_period_constr">构造</a> --
  <a href="local_time.html#local_time_period_accessors">访问器</a> --
  <a href="local_time.html#local_time_period_operators">操作符</a><a name="local_time_period_intro"></a>
<h3>
<a name="id996767"></a>简介</h3>











<p>类&nbsp;<code class="computeroutput">boost::local_time::local_time_period</code>
提供了对两个本地时间之间的范围的直接表示。时间段可以通过简化程序的条件逻辑来简化一些计算类型。 </p>











<p>由相同的开始点与结束点，或者由开始点与长度为零的时间长度所构建的时间段，被称为零长度时间段。零长度时间段被认为是无效的时间段(但是构建一个无效时间段却是完全合法的)。对于这些时间段，<code class="computeroutput">last</code> 时间点总是比 <code class="computeroutput">begin</code> 时间点小一个时间单元。
  </p>











<a name="local_time_period_header"></a>
<h3>
<a name="id996812"></a>头文件</h3>











<p>
    </p>











<pre class="programlisting">#include "boost/date_time/local_time/local_time.hpp" //包含所有类型和 i/o<br>或<br>#include "boost/date_time/local_time/local_time_types.hpp" //只有类型没有 i/o</pre>











<p>
  </p>











<a name="local_time_period_constr"></a>
<h3>
<a name="id996834"></a>构造</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period(...)<br>  Parameters:<br>    local_date_time beginning<br>    local_date_time end</pre>










      </td>











      <td> 创建一个 [begin, end) 的时间段。如果 end &lt;= begin 则时间段被定义为无效时间段。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  beg(ptime(date(2005,Jan,1),hours(0)), zone);<br>local_date_time <br>  end(ptime(date(2005,Feb,1),hours(0)), zone);<br>// period for the entire month of Jan 2005<br>local_time_period ltp(beg, end);</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period(...)<br>  Parameters:<br>    local_date_time beginning<br>    time_duration length</pre>










      </td>











      <td>创建一个 [begin, begin+len) 时间段，其中 end 为
begin+len. 如果 len&nbsp;&lt;= 0 则时间段被定义为无效时间段。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  beg(ptime(date(2005,Jan,1),hours(0)), zone);<br>// period for the whole day of 2005-Jan-01<br>local_time_period ltp(beg, hours(24));</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period(local_time_period rhs)</pre>










      </td>











      <td>复制构造函数。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period ltp1(ltp);</pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="local_time_period_accessors"></a>
<h3>
<a name="id996988"></a>访问器</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time begin()</pre>










      </td>











      <td>返回该时间段的第一个 local_date_time.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  ldt((ptime(date(2005,Jan,1)),hours(0)), zone);<br>local_time_period ltp(ldt, hours(2));<br>ltp.begin(); // =&gt; 2005-Jan-01 00:00:00</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time last()</pre>










      </td>











      <td>返回该时间段的最后一个 local_date_time&nbsp;</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  ldt((ptime(date(2005,Jan,1),hours(0))), zone);<br>local_time_period ltp(ldt, hours(2));<br>ltp.last(); // =&gt; 2005-Jan-01 01:59:59.999999999</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time end()</pre>










      </td>











      <td>返回时间段的 last 之后的时间点</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  ldt((ptime(date(2005,Jan,1),hours(0))), zone);<br>local_time_period ltp(ldt, hours(2));<br>ltp.end(); // =&gt; 2005-Jan-01 02:00:00</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_duration length()</pre>










      </td>











      <td>返回时间段的长度。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  ldt((ptime(date(2005,Jan,1),hours(0))), zone);<br>local_time_period ltp(ldt, hours(2));<br>ltp.length(); // =&gt; 02:00:00</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool is_null()</pre>










      </td>











      <td>返回 True 如果时间段是无效的。例如：end 小于等于 begin.</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  beg((ptime(date(2005,Feb,1),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Jan,1),hours(0))), zone);<br>local_time_period ltp(beg, end);<br>ltp.is_null(); // =&gt; true</pre>











	    </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool contains(local_date_time)</pre>










      </td>











      <td>返回 True 如果 local_date_time 位于时间段内。零长度时间段不能包含任何时间点。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">time_zone_ptr <br>  zone(new posix_time_zone("MST-07"));<br>local_date_time <br>  beg((ptime(date(2005,Jan,1),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Feb,1),hours(0))), zone);<br>local_time_period jan_mst(beg, end);<br><br>local_date_time <br>ldt((ptime(date(2005,Jan,15),hours(12))), zone);<br>jan_mst.contains(ldt); // =&gt; true<br><br>local_time_period zero(beg, beg);<br>zero.contains(beg); // false</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool contains(local_time_period)</pre>










      </td>











      <td>返回 True 如果给定时间段位于本时间段内。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 使用前例中的 jan_mst 时间段<br><br>local_date_time <br>  beg((ptime(date(2005,Jan,7),hours(0))), zone);<br>local_time_period ltp(beg, hours(24));<br><br>jan_mst.contains(ltp); // =&gt; true</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">bool intersects(local_time_period)</pre>










      </td>











      <td>返回 True 如果两个时间段交叉。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 使用前例中的 jan_mst 时间段<br><br>local_date_time <br>  beg((ptime(date(2005,Jan,7),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Feb,7),hours(0))), zone);<br>local_time_period ltp(beg, end);<br><br>jan_mst.intersects(ltp); // =&gt; true</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period intersection(local_time_period)</pre>










      </td>











      <td>计算两个时间段的交集。如果不相交则返回空。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 使用前例中的 jan_mst 时间段<br><br>local_date_time <br>  beg((ptime(date(2005,Jan,7),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Feb,7),hours(0))), zone);<br>local_time_period ltp(beg, end);<br><br>local_time_period res(jan_mst.intersection(ltp));<br>// 结果 =&gt; 2005-Jan-07 00:00:00 至<br>// 2005-Jan-31 23:59:59.999999999 (包含)</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period merge(local_time_period)</pre>










      </td>











      <td>返回两个时间段的并集。如果不相交则返回空。</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 使用前例中的 jan_mst 时间段<br><br>local_date_time <br>  beg((ptime(date(2005,Jan,7),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Feb,7),hours(0))), zone);<br>local_time_period ltp(beg, end);<br><br>local_time_period res(jan_mst.merge(ltp));<br>// 结果 =&gt; 2005-Jan-07 00:00:00 至<br>// 2005-Feb-06 23:59:59.999999999 (包含)</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_time_period span(local_time_period)</pre>










      </td>











      <td>合并两个时间段及其间隔，即 begin = min(p1.begin, p2.begin) 且 end = max(p1.end , p2.end).</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">// 使用前例中的 jan_mst 时间段<br><br>local_date_time <br>  beg((ptime(date(2005,Mar,1),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Apr,1),hours(0))), zone);<br>local_time_period mar_mst(beg, end);<br><br>local_time_period res(jan_mst.span(mar_mst));<br>// 结果 =&gt; 2005-Jan-01 00:00:00 至<br>// 2005-Mar-31 23:59:59.999999999 (包含)</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">void shift(time_duration)</pre>










      </td>











      <td>为&nbsp;begin 和 end 同时加上一个时间长度</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">local_date_time <br>  beg((ptime(date(2005,Mar,1),hours(0))), zone);<br>local_date_time <br>  end((ptime(date(2005,Apr,1),hours(0))), zone);<br>local_time_period mar_mst(beg, end);<br><br>mar_mst.shift(hours(48));<br>// mar_mst =&gt; 2005-Mar-03 00:00:00 至<br>// 2005-Apr-02 23:59:59.999999999 (包含)</pre>










      </td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











<a name="local_time_period_operators"></a>
<h3>
<a name="id997417"></a>操作符</h3>











<p>
    </p>











<div class="informaltable">
<table class="table">











  <colgroup><col><col></colgroup>
  <thead>
  <tr>











    <th rowspan="2" valign="top">语法</th>











    <th>说明</th>











  </tr>











  <tr>










    <th>例子</th>










  </tr>











  </thead>
  <tbody>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator==, operator!=</pre>










      </td>











      <td>相等性比较操作符。两个时间段相等，如果 ltp1.begin == ltp2.begin &amp;&amp; ltp1.last == ltp2.last</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">if (ltp1 == ltp2) {...</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator&lt;</pre>










      </td>











      <td>无交叉的顺序比较。返回 True 如果 ltp1.end() 小于 ltp2.begin()</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">if (ltp1 &lt; ltp2) {...</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator&gt;</pre>










      </td>











      <td>无交叉的顺序比较。返回 True 如果 ltp1.begin() 大于 ltp2.end()</td>











    </tr>











    <tr>










      <td>
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">if (ltp1 &gt; ltp2) {... etc</pre>










      </td>










    </tr>











    <tr>











      <td rowspan="2" valign="top">
      
      
      
      
      
      
      
      
      
      
      <pre class="screen">operator&lt;=, operator&gt;=</pre>










      </td>











      <td>根据其它操作符定义。</td>











    </tr>











    <tr>










      <td>&nbsp;</td>










    </tr>











  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>










</div>











<p>
  </p>











</div>











</div>











<table width="100%">










  <tbody>










    <tr>











      <td align="left"></td>











      <td align="right"><small>Copyright &copy; 2001-2005 CrystalClear Software, Inc</small></td>











    </tr>










  
  
  
  
  
  
  
  
  
  
  </tbody>
</table>











<hr>
<div class="spirit-nav">
<a accesskey="p" href="posix_time.html"><img src="../images/prev.png" alt="Prev"></a><a accesskey="u" href="../date_time.html"><img src="../images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../images/home.png" alt="Home"></a><a accesskey="n" href="date_time_io.html"><img src="../images/next.png" alt="Next"></a>
</div>











</body>
</html>
